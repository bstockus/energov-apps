CREATE PROCEDURE [dbo].[PermitSubPermitsForPermitId]
	@PERMITID AS VARCHAR(36)
AS

SELECT
	p.PMPERMITID AS "SubPermitId",
	p.PMPERMITTYPEID AS "SubPermitTypeId",
	p.PMPERMITWORKCLASSID AS "SubPermitClassId"
FROM [$(EnerGovDatabase)].dbo.PMPERMIT p
WHERE p.PMPERMITPARENTID = @PERMITID

UNION

SELECT
	p.PMPERMITID AS "SubPermitId",
	p.PMPERMITTYPEID AS "SubPermitTypeId",
	p.PMPERMITWORKCLASSID AS "SubPermitClassId"
FROM [$(EnerGovDatabase)].dbo.PMPERMITACTIONREF par
INNER JOIN [$(EnerGovDatabase)].dbo.PMPERMITWFACTIONSTEP pwfas ON par.OBJECTID = pwfas.PMPERMITWFACTIONSTEPID
INNER JOIN [$(EnerGovDatabase)].dbo.PMPERMITWFSTEP pwfs ON pwfas.PMPERMITWFSTEPID = pwfs.PMPERMITWFSTEPID
INNER JOIN [$(EnerGovDatabase)].dbo.PMPERMIT p ON par.PMPERMITID = p.PMPERMITID
WHERE pwfs.PMPERMITID = @PERMITID