CREATE FUNCTION [laxreports].[CustomFieldAllTableRowNumbers]
(
	@PERMITID char(36),
	@MODULEID int
)
RETURNS @returntable TABLE
(
	RowNumber INT,
	TableId CHAR(36)
)
AS
BEGIN
	INSERT @returntable
	SELECT 
		x.ROWNUMBER AS "RowNumber",
		x.CUSTOMFIELDTABLEID AS "TableId"
	FROM (
		SELECT col.ROWNUMBER, colref.CUSTOMFIELDTABLEID FROM [$(EnerGovDatabase)].dbo.CUSTOMSAVERTBLCOL_BLN col INNER JOIN [$(EnerGovDatabase)].dbo.CUSTOMFIELDTABLECOLUMNREF colref ON col.CFTABLECOLUMNREFID = colref.CUSTOMFIELDTABLECOLUMNREFID WHERE col.OBJECTID = @PERMITID AND col.MODULEID = @MODULEID
		UNION SELECT col.ROWNUMBER, colref.CUSTOMFIELDTABLEID FROM [$(EnerGovDatabase)].dbo.CUSTOMSAVERTBLCOL_DATE col INNER JOIN [$(EnerGovDatabase)].dbo.CUSTOMFIELDTABLECOLUMNREF colref ON col.CFTABLECOLUMNREFID = colref.CUSTOMFIELDTABLECOLUMNREFID WHERE col.OBJECTID = @PERMITID AND col.MODULEID = @MODULEID
		UNION SELECT col.ROWNUMBER, colref.CUSTOMFIELDTABLEID FROM [$(EnerGovDatabase)].dbo.CUSTOMSAVERTBLCOL_FLT col INNER JOIN [$(EnerGovDatabase)].dbo.CUSTOMFIELDTABLECOLUMNREF colref ON col.CFTABLECOLUMNREFID = colref.CUSTOMFIELDTABLECOLUMNREFID WHERE col.OBJECTID = @PERMITID AND col.MODULEID = @MODULEID
		UNION SELECT col.ROWNUMBER, colref.CUSTOMFIELDTABLEID FROM [$(EnerGovDatabase)].dbo.CUSTOMSAVERTBLCOL_INT col INNER JOIN [$(EnerGovDatabase)].dbo.CUSTOMFIELDTABLECOLUMNREF colref ON col.CFTABLECOLUMNREFID = colref.CUSTOMFIELDTABLECOLUMNREFID WHERE col.OBJECTID = @PERMITID AND col.MODULEID = @MODULEID
		UNION SELECT col.ROWNUMBER, colref.CUSTOMFIELDTABLEID FROM [$(EnerGovDatabase)].dbo.CUSTOMSAVERTBLCOL_LST col INNER JOIN [$(EnerGovDatabase)].dbo.CUSTOMFIELDTABLECOLUMNREF colref ON col.CFTABLECOLUMNREFID = colref.CUSTOMFIELDTABLECOLUMNREFID WHERE col.OBJECTID = @PERMITID AND col.MODULEID = @MODULEID
		UNION SELECT col.ROWNUMBER, colref.CUSTOMFIELDTABLEID FROM [$(EnerGovDatabase)].dbo.CUSTOMSAVERTBLCOL_MEM col INNER JOIN [$(EnerGovDatabase)].dbo.CUSTOMFIELDTABLECOLUMNREF colref ON col.CFTABLECOLUMNREFID = colref.CUSTOMFIELDTABLECOLUMNREFID WHERE col.OBJECTID = @PERMITID AND col.MODULEID = @MODULEID
		UNION SELECT col.ROWNUMBER, colref.CUSTOMFIELDTABLEID FROM [$(EnerGovDatabase)].dbo.CUSTOMSAVERTBLCOL_MNY col INNER JOIN [$(EnerGovDatabase)].dbo.CUSTOMFIELDTABLECOLUMNREF colref ON col.CFTABLECOLUMNREFID = colref.CUSTOMFIELDTABLECOLUMNREFID WHERE col.OBJECTID = @PERMITID AND col.MODULEID = @MODULEID
		UNION SELECT col.ROWNUMBER, colref.CUSTOMFIELDTABLEID FROM [$(EnerGovDatabase)].dbo.CUSTOMSAVERTBLCOL_MNY col INNER JOIN [$(EnerGovDatabase)].dbo.CUSTOMFIELDTABLECOLUMNREF colref ON col.CFTABLECOLUMNREFID = colref.CUSTOMFIELDTABLECOLUMNREFID WHERE col.OBJECTID = @PERMITID AND col.MODULEID = @MODULEID) AS x
	GROUP BY x.CUSTOMFIELDTABLEID, x.ROWNUMBER
	ORDER BY x.CUSTOMFIELDTABLEID, x.ROWNUMBER

	RETURN
END
