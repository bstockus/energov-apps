CREATE PROCEDURE [dbo].[rpt_SpecialEventPermit_Reviews]
	@PLPLANID AS char(36)
AS
	SELECT
       'ITEM'   AS TYPE,
       PLPLAN.PLPLANID,
       PLPLAN.PLANNUMBER,
       PLPLAN.APPLICATIONDATE,
       PLPLAN.[EXPIREDATE],
       PLPLAN.[DESCRIPTION],
       PLPLAN.SQUAREFEET,
       PLPLAN.VALUE,
       PLITEMREVIEWTYPE.NAME          AS                                                     REVIEWITEM,
       PLITEMREVIEWSTATUS.NAME        AS                                                     STATUSNAME,
       PLITEMREVIEW.COMMENTS AS ItemComments,
       USERS.FNAME,
       USERS.LNAME,
       USERS.PHONE,
       USERS.EMAIL,
       USERS.TITLE,
       USERS.[CREDENTIALS],
       PLITEMREVIEWTYPE.[DESCRIPTION] AS                                                     ITEMREVIEWDESC,
       PLITEMREVIEW.PLITEMREVIEWID,
       PLITEMREVIEW.PLITEMREVIEWTYPEID,
       PLSUBMITTAL.PLSUBMITTALID,
       PLSUBMITTALTYPE.TYPENAME                                                              SUBMITTALTYPE,
       PLPLANWFACTIONSTEP.VERSIONNUMBER,
       NULL AS RecomendationId,
       NULL AS Recomendation,
       NULL AS RecomendationNumber
FROM [$(EnerGovDatabase)].[dbo].PLPLAN
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].PLITEMREVIEW ON PLPLAN.PLPLANID = PLITEMREVIEW.PLPLANID
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].PLITEMREVIEWSTATUS
                         ON PLITEMREVIEW.PLITEMREVIEWSTATUSID = PLITEMREVIEWSTATUS.PLITEMREVIEWSTATUSID
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].PLITEMREVIEWTYPE ON PLITEMREVIEW.PLITEMREVIEWTYPEID = PLITEMREVIEWTYPE.PLITEMREVIEWTYPEID
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].USERS ON PLITEMREVIEW.ASSIGNEDUSERID = USERS.SUSERGUID
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].PLSUBMITTAL ON PLITEMREVIEW.PLSUBMITTALID = PLSUBMITTAL.PLSUBMITTALID
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].PLSUBMITTALTYPE ON PLSUBMITTAL.PLSUBMITTALTYPEID = PLSUBMITTALTYPE.PLSUBMITTALTYPEID
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].PLPLANWFACTIONSTEP
                         ON PLSUBMITTAL.PLPLANWFACTIONSTEPID = PLPLANWFACTIONSTEP.PLPLANWFACTIONSTEPID

WHERE PLPLAN.PLPLANID = @PLPLANID

UNION ALL

SELECT
       'RECM'   AS TYPE,
       PLPLAN.PLPLANID,
       PLPLAN.PLANNUMBER,
       PLPLAN.APPLICATIONDATE,
       PLPLAN.[EXPIREDATE],
       PLPLAN.[DESCRIPTION],
       PLPLAN.SQUAREFEET,
       PLPLAN.VALUE,
       PLITEMREVIEWTYPE.NAME          AS                                                     REVIEWITEM,
       PLITEMREVIEWSTATUS.NAME        AS                                                     STATUSNAME,
       PLITEMREVIEW.COMMENTS AS ItemComments,
       USERS.FNAME,
       USERS.LNAME,
       USERS.PHONE,
       USERS.EMAIL,
       USERS.TITLE,
       USERS.[CREDENTIALS],
       PLITEMREVIEWTYPE.[DESCRIPTION] AS                                                     ITEMREVIEWDESC,
       PLITEMREVIEW.PLITEMREVIEWID,
       PLITEMREVIEW.PLITEMREVIEWTYPEID,
       PLSUBMITTAL.PLSUBMITTALID,
       PLSUBMITTALTYPE.TYPENAME                                                              SUBMITTALTYPE,
       PLPLANWFACTIONSTEP.VERSIONNUMBER,
       PR.PLPLANRECOMENDATIONID AS RecomendationId,
       PR.RECOMMENDATION AS Recomendation,
       PR.AUTONUMBER AS RecomendationNumber
FROM [$(EnerGovDatabase)].[dbo].PLPLAN
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].PLITEMREVIEW ON PLPLAN.PLPLANID = PLITEMREVIEW.PLPLANID
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].PLITEMREVIEWSTATUS
                         ON PLITEMREVIEW.PLITEMREVIEWSTATUSID = PLITEMREVIEWSTATUS.PLITEMREVIEWSTATUSID
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].PLITEMREVIEWTYPE ON PLITEMREVIEW.PLITEMREVIEWTYPEID = PLITEMREVIEWTYPE.PLITEMREVIEWTYPEID
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].USERS ON PLITEMREVIEW.ASSIGNEDUSERID = USERS.SUSERGUID
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].PLSUBMITTAL ON PLITEMREVIEW.PLSUBMITTALID = PLSUBMITTAL.PLSUBMITTALID
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].PLSUBMITTALTYPE ON PLSUBMITTAL.PLSUBMITTALTYPEID = PLSUBMITTALTYPE.PLSUBMITTALTYPEID
         LEFT OUTER JOIN [$(EnerGovDatabase)].[dbo].PLPLANWFACTIONSTEP
                         ON PLSUBMITTAL.PLPLANWFACTIONSTEPID = PLPLANWFACTIONSTEP.PLPLANWFACTIONSTEPID
        INNER JOIN [$(EnerGovDatabase)].[dbo].PLPLANRECOMMENDATION PR ON PLITEMREVIEW.PLITEMREVIEWID = PR.PLITEMREVIEWID
WHERE PLPLAN.PLPLANID = @PLPLANID;
GO
