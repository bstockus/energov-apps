CREATE PROCEDURE [holds].[USP_HOLDTYPESETUPS_GETBYMODULETYPEIDS]
(
	@SEARCH AS NVARCHAR(MAX) = '',
	@PAGE_NUMBER AS int = 1,
	@PAGE_SIZE AS int = 10,
	@IS_ASCENDING AS bit = 1,
	@MODULEIDS [dbo].[IntegerIds] READONLY
)
AS
BEGIN
WITH RAW_DATA
  AS (SELECT 
	[dbo].[HOLDTYPESETUPS].[HOLDSETUPID],
	[dbo].[HOLDTYPESETUPS].[NAME],
	[dbo].[HOLDTYPESETUPS].[DESCRIPTION],
	[dbo].[HOLDTYPESETUPS].[HOLDTYPEID],
	[dbo].[HOLDTYPE].[HOLDTYPENAME],
	[dbo].[HOLDTYPESETUPS].[MODULEID],
	[dbo].[HOLDTYPESETUPS].[ACTIVE],
	[dbo].[HOLDTYPESETUPS].[ALLOWHOLDOVERRIDES],
	CASE @IS_ASCENDING
		  WHEN 1 THEN ROW_NUMBER() OVER (ORDER BY [dbo].[HOLDTYPESETUPS].[NAME])
		  ELSE ROW_NUMBER() OVER (ORDER BY [dbo].[HOLDTYPESETUPS].[NAME] DESC)
		END AS RowNumber,
	COUNT(1) OVER() AS TotalRows
FROM [dbo].[HOLDTYPESETUPS]
JOIN [dbo].[HOLDTYPE] ON [HOLDTYPE].HOLDTYPEID=[HOLDTYPESETUPS].HOLDTYPEID
WHERE [dbo].[HOLDTYPESETUPS].[MODULEID] IN (SELECT ID FROM @MODULEIDS) AND [dbo].[HOLDTYPESETUPS].[NAME] LIKE '%'+@SEARCH+'%'
)

SELECT
	*
FROM RAW_DATA  
  WHERE RowNumber > @PAGE_SIZE * (@PAGE_NUMBER - 1)
  AND RowNumber <= @PAGE_SIZE * @PAGE_NUMBER
  ORDER BY RowNumber

END