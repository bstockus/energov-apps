CREATE PROCEDURE [examsitting].[USP_RECENTEXAMSITTING_GETBYIDS]
(
	@EXAMSITTINGLIST RecordIDs READONLY,
	@USERID AS CHAR(36) = NULL
)
AS
BEGIN

SELECT
	EXAMSITTING.EXAMSITTINGID,
	EXAMSITTING.SITTINGNUMBER,
	EXAMSITTING.LOCATIONDETAILS,
	EXAMSITTING.LINKNUMBER,
	EXAMSITTING.SCHEDULEDDATE,
	EXAMSITTING.SPECIALSITTING,
	EXAMSITTING.ROWVERSION,
	EXAMFORMATTYPE.NAME FORMATTYPENAME,
	EXAMLINK.NAME LINKTYPE,
	EXAMTYPE.NAME TYPENAME,
	EXAMLOCATION.NAME LOCATIONNAME,
	EXAMTIMESLOT.NAME TIMESLOTNAME,
	USERS.FNAME,
    USERS.LNAME
FROM EXAMSITTING
INNER JOIN EXAMLINK ON EXAMLINK.EXAMLINKID = EXAMSITTING.EXAMLINKID
INNER JOIN EXAMTYPE ON EXAMTYPE.EXAMTYPEID = EXAMSITTING.EXAMTYPEID
INNER JOIN EXAMLOCATION ON EXAMLOCATION.EXAMLOCATIONID = EXAMSITTING.EXAMLOCATIONID
INNER JOIN EXAMFORMATTYPE ON EXAMFORMATTYPE.EXAMFORMATTYPEID = EXAMSITTING.EXAMFORMATTYPEID
INNER JOIN EXAMTIMESLOT ON EXAMTIMESLOT.EXAMTIMESLOTID = EXAMSITTING.EXAMTIMESLOTID
INNER JOIN @EXAMSITTINGLIST EXAMSITTINGLIST ON EXAMSITTING.EXAMSITTINGID = EXAMSITTINGLIST.RECORDID
LEFT OUTER JOIN RECENTHISTORYEXAMSITTING ON RECENTHISTORYEXAMSITTING.EXAMSITTINGID = EXAMSITTING.EXAMSITTINGID AND RECENTHISTORYEXAMSITTING.USERID = @USERID
LEFT OUTER JOIN USERS ON RECENTHISTORYEXAMSITTING.USERID = USERS.SUSERGUID AND RECENTHISTORYEXAMSITTING.USERID = @USERID
ORDER BY RECENTHISTORYEXAMSITTING.LOGGEDDATETIME DESC

END