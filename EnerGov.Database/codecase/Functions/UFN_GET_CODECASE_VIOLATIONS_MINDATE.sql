CREATE FUNCTION [codecase].[UFN_GET_CODECASE_VIOLATIONS_MINDATE]
(
	@ENTITYID char(36)
)
RETURNS DATETIME
AS
BEGIN
	DECLARE @MINDATE AS DATETIME, @MAXDATE AS DATETIME = MAX(GETDATE())
	SELECT @MINDATE = MIN(ISNULL([dbo].[CMVIOLATION].[CITATIONISSUEDATE],@MAXDATE))
	FROM [dbo].[CMCODEWFSTEP] 
	INNER JOIN [dbo].[CMVIOLATION] ON [dbo].[CMCODEWFSTEP].[CMCODEWFSTEPID] = [dbo].[CMVIOLATION].[CMCODEWFSTEPID]	
	WHERE [dbo].[CMCODEWFSTEP].[CMCODECASEID] = @ENTITYID
	RETURN @MINDATE;
END