CREATE PROCEDURE [energovnotifications].[USP_ASSOCIATECASES_BYIDS]
(
	@OBJECTLIST RecordIDs READONLY
)
AS
BEGIN
SET NOCOUNT ON;

SELECT DISTINCT PMPERMIT.PMPERMITID AS CaseID, PMPERMIT.PERMITNUMBER AS CaseNumber, PMPERMITTYPE.NAME  AS CaseTypeName,
	PMPERMITWORKCLASS.NAME AS CaseWorkClassName, PMPERMITSTATUS.NAME StatusName,
	ISNULL(PRPROJECT.NAME,'') AS ProjectName, 1 as ModuleId,
	ISNULL(USERS.FNAME,'') AS AssignFNAME, ISNULL(USERS.LNAME,'') AS AssignLNAME
FROM PMPERMIT INNER JOIN PMPERMITWFSTEP
ON PMPERMIT.PMPERMITID = PMPERMITWFSTEP.PMPERMITID
INNER JOIN PMPERMITWFACTIONSTEP ON PMPERMITWFSTEP.PMPERMITWFSTEPID = PMPERMITWFACTIONSTEP.PMPERMITWFSTEPID
INNER JOIN PMPERMITTYPE ON PMPERMIT.PMPERMITTYPEID = PMPERMITTYPE.PMPERMITTYPEID
INNER JOIN PMPERMITWORKCLASS ON PMPERMIT.PMPERMITWORKCLASSID = PMPERMITWORKCLASS.PMPERMITWORKCLASSID
INNER JOIN PMPERMITSTATUS ON PMPERMIT.PMPERMITSTATUSID = PMPERMITSTATUS.PMPERMITSTATUSID
LEFT JOIN USERS ON PMPERMIT.ASSIGNEDTO = USERS.SUSERGUID
LEFT JOIN PRPROJECTPERMIT ON PMPERMIT.PMPERMITID = PRPROJECTPERMIT.PMPERMITID
LEFT JOIN PRPROJECT PRPROJECT ON PRPROJECTPERMIT.PRPROJECTID = PRPROJECT.PRPROJECTID
INNER JOIN @OBJECTLIST OBJECTLIST ON PMPERMITWFACTIONSTEP.PMPERMITWFACTIONSTEPID = OBJECTLIST.RECORDID

UNION ALL

SELECT DISTINCT PLPLAN.PLPLANID AS CaseID, PLPLAN.PLANNUMBER AS CaseNumber, PLPLANTYPE.PLANNAME  AS CaseTypeName,
	PLPLANWORKCLASS.NAME AS CaseWorkClassName, PLPLANSTATUS.NAME StatusName,
	ISNULL(PRPROJECT.NAME,'') AS ProjectName, 2 as ModuleId,
	ISNULL(USERS.FNAME,'') AS AssignFNAME, ISNULL(USERS.LNAME,'') AS AssignLNAME
FROM PLPLAN INNER JOIN PLPLANWFSTEP
ON PLPLAN.PLPLANID = PLPLANWFSTEP.PLPLANID
inner join PLPLANWFACTIONSTEP ON PLPLANWFSTEP.PLPLANWFSTEPID = PLPLANWFACTIONSTEP.PLPLANWFSTEPID
INNER JOIN PLPLANTYPE ON PLPLAN.PLPLANTYPEID = PLPLANTYPE.PLPLANTYPEID
INNER JOIN PLPLANWORKCLASS ON PLPLAN.PLPLANWORKCLASSID = PLPLANWORKCLASS.PLPLANWORKCLASSID
INNER JOIN PLPLANSTATUS ON PLPLAN.PLPLANSTATUSID = PLPLANSTATUS.PLPLANSTATUSID
LEFT JOIN USERS ON PLPLAN.ASSIGNEDTO = USERS.SUSERGUID
LEFT JOIN PRPROJECTPLAN ON PLPLAN.PLPLANID = PRPROJECTPLAN.PLPLANID
LEFT JOIN PRPROJECT PRPROJECT ON PRPROJECTPLAN.PRPROJECTID = PRPROJECT.PRPROJECTID
INNER JOIN @OBJECTLIST OBJECTLIST ON PLPLANWFACTIONSTEP.PLPLANWFACTIONSTEPID = OBJECTLIST.RECORDID

UNION ALL

SELECT DISTINCT CMCODECASE.CMCODECASEID AS CaseID, CMCODECASE.CASENUMBER AS CaseNumber, CMCASETYPE.NAME  AS CaseTypeName,
	'' AS CaseWorkClassName, CMCODECASESTATUS.NAME StatusName,
	ISNULL(PRPROJECT.NAME,'') AS ProjectName, 7 as ModuleId,
	'' AS AssignFNAME, '' AS AssignLNAME
FROM CMCODECASE INNER JOIN CMCODEWFSTEP
ON CMCODECASE.CMCODECASEID = CMCODEWFSTEP.CMCODECASEID
inner join CMCODEWFACTIONSTEP ON CMCODEWFSTEP.CMCODEWFSTEPID = CMCODEWFACTIONSTEP.CMCODEWFSTEPID
INNER JOIN CMCASETYPE ON CMCODECASE.CMCASETYPEID = CMCASETYPE.CMCASETYPEID
INNER JOIN CMCODECASESTATUS ON CMCODECASE.CMCODECASESTATUSID = CMCODECASESTATUS.CMCODECASESTATUSID
LEFT JOIN PRPROJECTCODECASE ON CMCODECASE.CMCODECASEID = PRPROJECTCODECASE.CMCODECASEID
LEFT JOIN PRPROJECT PRPROJECT ON PRPROJECTCODECASE.PRPROJECTID = PRPROJECT.PRPROJECTID
INNER JOIN @OBJECTLIST OBJECTLIST ON CMCODEWFACTIONSTEP.CMCODEWFACTIONSTEPID = OBJECTLIST.RECORDID

UNION ALL

SELECT DISTINCT BLLICENSE.BLLICENSEID AS CaseID, BLLICENSE.LICENSENUMBER AS CaseNumber, BLLICENSETYPE.NAME  AS CaseTypeName,
	BLLICENSECLASS.NAME AS CaseWorkClassName, BLLICENSESTATUS.NAME StatusName,
	'' AS ProjectName, 8 as ModuleId,
	ISNULL(USERS.FNAME,'') AS AssignFNAME, ISNULL(USERS.LNAME,'') AS AssignLNAME
FROM BLLICENSE INNER JOIN BLLICENSEWFSTEP
ON BLLICENSE.BLLICENSEID = BLLICENSEWFSTEP.BLLICENSEID
inner join BLLICENSEWFACTIONSTEP ON BLLICENSEWFSTEP.BLLICENSEWFSTEPID = BLLICENSEWFACTIONSTEP.BLLICENSEWFSTEPID
INNER JOIN BLLICENSETYPE ON BLLICENSE.BLLICENSETYPEID = BLLICENSETYPE.BLLICENSETYPEID
INNER JOIN BLLICENSECLASS ON BLLICENSE.BLLICENSECLASSID = BLLICENSECLASS.BLLICENSECLASSID
INNER JOIN BLLICENSESTATUS ON BLLICENSE.BLLICENSESTATUSID = BLLICENSESTATUS.BLLICENSESTATUSID
LEFT JOIN USERS ON BLLICENSE.ISSUEDBY = USERS.SUSERGUID
INNER JOIN @OBJECTLIST OBJECTLIST ON BLLICENSEWFACTIONSTEP.BLLICENSEWFACTIONSTEPID = OBJECTLIST.RECORDID

UNION ALL

SELECT DISTINCT ILLICENSE.ILLICENSEID AS CaseID, ILLICENSE.LICENSENUMBER AS CaseNumber, ILLICENSETYPE.NAME  AS CaseTypeName,
	ILLICENSECLASSIFICATION.NAME AS CaseWorkClassName, ILLICENSESTATUS.NAME StatusName,
	'' AS ProjectName, 11 as ModuleId,
	ISNULL(USERS.FNAME,'') AS AssignFNAME, ISNULL(USERS.LNAME,'') AS AssignLNAME
FROM ILLICENSE INNER JOIN ILLICENSEWFSTEP
ON ILLICENSE.ILLICENSEID = ILLICENSEWFSTEP.ILLICENSEID
inner join ILLICENSEWFACTIONSTEP ON ILLICENSEWFSTEP.ILLICENSEWFSTEPID = ILLICENSEWFACTIONSTEP.ILLICENSEWFSTEPID
INNER JOIN ILLICENSETYPE ON ILLICENSE.ILLICENSETYPEID = ILLICENSETYPE.ILLICENSETYPEID
INNER JOIN ILLICENSECLASSIFICATION ON ILLICENSE.ILLICENSECLASSIFICATIONID = ILLICENSECLASSIFICATION.ILLICENSECLASSIFICATIONID
INNER JOIN ILLICENSESTATUS ON ILLICENSE.ILLICENSESTATUSID = ILLICENSESTATUS.ILLICENSESTATUSID
LEFT JOIN USERS ON ILLICENSE.ISSUEDBY = USERS.SUSERGUID
INNER JOIN @OBJECTLIST OBJECTLIST ON ILLICENSEWFACTIONSTEP.ILLICENSEWFACTIONSTEPID = OBJECTLIST.RECORDID

END