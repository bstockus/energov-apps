CREATE PROCEDURE [managecontacts].[USP_INVOICES_DUE_GETBY_GLOBALENTITYID]
(@GLOBALENTITYID CHAR(36))          
AS          
BEGIN          
	SET NOCOUNT ON;    
   
	SELECT    
	[CAINVOICE].[CAINVOICEID],  
	[CAINVOICE].[INVOICENUMBER],
	[CAINVOICE].[INVOICEDESCRIPTION],
	[CASTATUS].[NAME] [INVOICESTATUSNAME],
	[CAINVOICE].[INVOICEDATE],
	[CAINVOICE].[INVOICEDUEDATE],
	[CAINVOICE].[INVOICETOTAL],
	[GLOBALENTITY].[FIRSTNAME],
	[GLOBALENTITY].[MIDDLENAME],
	[GLOBALENTITY].[LASTNAME],
	[GLOBALENTITY].[GLOBALENTITYNAME],
	[GLOBALENTITY].[HOMEPHONE],
	[GLOBALENTITY].[BUSINESSPHONE],
	[GLOBALENTITY].[MOBILEPHONE],
	[GLOBALENTITY].[OTHERPHONE]
	FROM    
	[dbo].[CAINVOICECONTACT]
	JOIN [dbo].[GLOBALENTITY] ON [CAINVOICECONTACT].[GLOBALENTITYID] = [GLOBALENTITY].[GLOBALENTITYID]
	JOIN [dbo].[CAINVOICE] ON [CAINVOICECONTACT].[CAINVOICEID] = [CAINVOICE].[CAINVOICEID]
	JOIN [dbo].[CASTATUS] ON [CAINVOICE].[CASTATUSID] = [CASTATUS].[CASTATUSID]   
	WHERE [CAINVOICECONTACT].[GLOBALENTITYID] = @GLOBALENTITYID 
	AND [CAINVOICECONTACT].[ISACTIVE] = 1
	AND [CAINVOICE].[CASTATUSID] NOT IN (4, 5, 9, 10)
     
	EXEC [managecontacts].[USP_INVOICES_DUE_FEE_CHILDREN] @GLOBALENTITYID
	EXEC [managecontacts].[USP_INVOICES_DUE_ADDRESS_CHILDREN] @GLOBALENTITYID
    
END;