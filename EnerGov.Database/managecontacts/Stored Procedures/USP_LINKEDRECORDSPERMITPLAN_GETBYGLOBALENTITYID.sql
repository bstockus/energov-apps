CREATE PROCEDURE [managecontacts].[USP_LINKEDRECORDSPERMITPLAN_GETBYGLOBALENTITYID]        
(@GLOBALENTITYID CHAR(36))        
AS        
BEGIN        
    SET NOCOUNT ON;        
    SELECT     
 '' AS PARENTID,
 [PMPERMITADDRESS].[PMPERMITADDRESSID] AS ENTITYID,
 [MAILINGADDRESS].[ADDRESSLINE1],    
 [MAILINGADDRESS].[ADDRESSLINE2],    
 [MAILINGADDRESS].[ADDRESSLINE3],
 [MAILINGADDRESS].[ADDRESSTYPE] AS ADDRESSTYPENAME,
 [MAILINGADDRESS].[ATTN] AS ATTN,
 [MAILINGADDRESS].[CITY],
 [MAILINGADDRESS].[COMPSITE] AS CompSite,
 [MAILINGADDRESS].[COUNTRY] AS COUNTRYNAME,
 [MAILINGADDRESSCOUNTRYTYPE].[MAILINGADDRESSCOUNTRYTYPEID] AS COUNTRYTYPEID,
 [MAILINGADDRESSCOUNTRYTYPE].[MAILINGADDRESSCOUNTRYTYPENAME] AS COUNTRYTYPENAME,
 [PMPERMITADDRESS].[MAIN] AS ISMAIN,
 [MAILINGADDRESS].[POBOX] AS POBOX,
 [MAILINGADDRESS].[POSTALCODE],
 [MAILINGADDRESS].[POSTDIRECTION] AS POSTALDIRECTION,
 [MAILINGADDRESS].[PREDIRECTION] AS PREDIRECTION,
 [MAILINGADDRESS].[PROVINCE] AS PROVINCENAME,
 [MAILINGADDRESS].[RURALROUTE] AS RURALROUTE,
 [MAILINGADDRESS].[STATE],
 [MAILINGADDRESS].[STATION] AS STATION,
 [MAILINGADDRESS].[STREETTYPE] AS STREETTYPENAME,
 [MAILINGADDRESS].[UNITORSUITE] AS UNITORSUITE,
 [MAILINGADDRESS].[ADDRESSID] AS ADDRESSID
 FROM     
 [dbo].[PMPERMITCONTACT]    
 INNER JOIN [dbo].[PMPERMIT] ON [PMPERMITCONTACT].[PMPERMITID] = [PMPERMIT].[PMPERMITID]    
 INNER JOIN [dbo].[PMPERMITTYPE] ON [PMPERMIT].[PMPERMITTYPEID] = [PMPERMITTYPE].[PMPERMITTYPEID]    
 INNER JOIN [dbo].[PMPERMITWORKCLASS] ON [PMPERMIT].[PMPERMITWORKCLASSID] = [PMPERMITWORKCLASS].[PMPERMITWORKCLASSID]    
 LEFT OUTER JOIN [dbo].[PMPERMITADDRESS] ON [PMPERMIT].[PMPERMITID] = [PMPERMITADDRESS].[PMPERMITID]    
 LEFT OUTER JOIN [dbo].[MAILINGADDRESS] ON [MAILINGADDRESS].[MAILINGADDRESSID] = [PMPERMITADDRESS].[MAILINGADDRESSID]    
 INNER JOIN [dbo].[MAILINGADDRESSCOUNTRYTYPE] ON [MAILINGADDRESS].[COUNTRYTYPE] = [MAILINGADDRESSCOUNTRYTYPE].[MAILINGADDRESSCOUNTRYTYPEID]
    WHERE [PMPERMITCONTACT].[GLOBALENTITYID] =  @GLOBALENTITYID    
   
 UNION ALL
    
  SELECT     
  '' AS PARENTID,
 [PLPLANADDRESS].[PLPLANADDRESSID] AS ENTITYID,
 [MAILINGADDRESS].[ADDRESSLINE1],    
 [MAILINGADDRESS].[ADDRESSLINE2],    
 [MAILINGADDRESS].[ADDRESSLINE3],
 [MAILINGADDRESS].[ADDRESSTYPE] AS ADDRESSTYPENAME,
 [MAILINGADDRESS].[ATTN] AS ATTN,
 [MAILINGADDRESS].[CITY],
 [MAILINGADDRESS].[COMPSITE] AS CompSite,
 [MAILINGADDRESS].[COUNTRY] AS COUNTRYNAME,
 [MAILINGADDRESSCOUNTRYTYPE].[MAILINGADDRESSCOUNTRYTYPEID] AS COUNTRYTYPEID,
 [MAILINGADDRESSCOUNTRYTYPE].[MAILINGADDRESSCOUNTRYTYPENAME] AS COUNTRYTYPENAME,
 [PLPLANADDRESS].[MAIN] AS ISMAIN,
 [MAILINGADDRESS].[POBOX] AS POBOX,
 [MAILINGADDRESS].[POSTALCODE],
 [MAILINGADDRESS].[POSTDIRECTION],
 [MAILINGADDRESS].[PREDIRECTION],
 [MAILINGADDRESS].[PROVINCE],
 [MAILINGADDRESS].[RURALROUTE],
 [MAILINGADDRESS].[STATE],
 [MAILINGADDRESS].[STATION] AS STATION,
 [MAILINGADDRESS].[STREETTYPE] AS STREETTYPENAME,
 [MAILINGADDRESS].[UNITORSUITE] AS UNITORSUITE,
 [MAILINGADDRESS].[ADDRESSID] AS ADDRESSID
  FROM    
  [dbo].[PLPLANCONTACT]    
  INNER JOIN [dbo].[PLPLAN] ON [PLPLANCONTACT].[PLPLANID] = [PLPLAN].[PLPLANID]    
  INNER JOIN [dbo].[PLPLANTYPE] ON [PLPLAN].[PLPLANTYPEID] = [PLPLANTYPE].[PLPLANTYPEID]    
  INNER JOIN [dbo].[PLPLANWORKCLASS] ON [PLPLAN].[PLPLANWORKCLASSID] = [PLPLANWORKCLASS].[PLPLANWORKCLASSID]    
  LEFT OUTER JOIN [dbo].[PLPLANADDRESS] ON [PLPLAN].[PLPLANID] = [PLPLANADDRESS].[PLPLANID]    
  LEFT OUTER JOIN [dbo].[MAILINGADDRESS] ON [MAILINGADDRESS].[MAILINGADDRESSID] = [PLPLANADDRESS].[MAILINGADDRESSID]    
  INNER JOIN [dbo].[MAILINGADDRESSCOUNTRYTYPE] ON [MAILINGADDRESS].[COUNTRYTYPE] = [MAILINGADDRESSCOUNTRYTYPE].[MAILINGADDRESSCOUNTRYTYPEID]
  WHERE [PLPLANCONTACT].[GLOBALENTITYID] =  @GLOBALENTITYID    
END;