CREATE FUNCTION [bulkupdate].[UDF_GET_BURECORD_COUNTS]()
RETURNS TABLE
AS
RETURN
(
	SELECT 
		[dbo].[BUSERVICE].[BUSERVICEID], 
		COUNT(*) AS TOTALCOUNT, 
		SUM(CASE WHEN [PROCESSEDDATE] IS NULL THEN 0 ELSE 1 END) AS PROCESSEDCOUNT 
	FROM [dbo].[BURECORD] 
	JOIN [dbo].[BUSERVICE] ON [dbo].[BURECORD].[BUSERVICEID] = [dbo].[BUSERVICE].[BUSERVICEID]
	GROUP BY [dbo].[BUSERVICE].[BUSERVICEID] 
)