CREATE PROCEDURE [codemanagementsetup].[USP_CMCODEACTIVITYTYPE_SEARCH]
(
	@SEARCH AS NVARCHAR(MAX) = '',
	@PAGE_NUMBER AS int = 1,
	@PAGE_SIZE AS int = 10,
	@IS_ASCENDING AS bit = 1
)
AS
BEGIN
WITH RAW_DATA
  AS (
	SELECT
		[dbo].[CMCODEACTIVITYTYPE].[CMCODEACTIVITYTYPEID],
		[dbo].[CMCODEACTIVITYTYPE].[NAME],
		[dbo].[CMCODEACTIVITYTYPE].[ROWVERSION],
		 CASE @IS_ASCENDING
		  WHEN 1 THEN ROW_NUMBER() OVER (ORDER BY [dbo].[CMCODEACTIVITYTYPE].[NAME])
		  ELSE ROW_NUMBER() OVER (ORDER BY [dbo].[CMCODEACTIVITYTYPE].[NAME] DESC)
		END AS RowNumber,
		COUNT(1) OVER() AS TotalRows
	FROM [dbo].[CMCODEACTIVITYTYPE]
	WHERE ([dbo].[CMCODEACTIVITYTYPE].[NAME] LIKE '%'+ @SEARCH +'%')
	)
SELECT
	*
FROM RAW_DATA  
  WHERE RowNumber > @PAGE_SIZE * (@PAGE_NUMBER - 1)
  AND RowNumber <= @PAGE_SIZE * @PAGE_NUMBER
  ORDER BY RowNumber
END