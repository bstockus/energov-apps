CREATE FUNCTION [managebusiness].[UFN_GET_TAXREMITTANCE_BALANCE_DUE]
(
    @BLGLOBALENTITYEXTENSIONID CHAR(36)
)
RETURNS MONEY
AS
BEGIN
    DECLARE @BALANCEDUE AS MONEY;
    SELECT @BALANCEDUE = ISNULL(SUM(CACOMPUTEDFEE.COMPUTEDAMOUNT - CACOMPUTEDFEE.AMOUNTPAIDTODATE), 0)
    FROM [dbo].[TXREMITTANCEACCOUNT]
        INNER JOIN [TXREMITTANCE]
            ON [TXREMITTANCEACCOUNT].[TXREMITTANCEACCOUNTID] = [TXREMITTANCE].[TXREMITTANCEACCOUNTID]
        INNER JOIN [TXREMITTANCEFEE]
            ON [TXREMITTANCE].[TXREMITTANCEID] = [TXREMITTANCEFEE].[TXREMITTANCEID]
        INNER JOIN [CACOMPUTEDFEE]
            ON [TXREMITTANCEFEE].[CACOMPUTEDFEEID] = [CACOMPUTEDFEE].[CACOMPUTEDFEEID]
    WHERE [TXREMITTANCEACCOUNT].[BLGLOBALENTITYEXTENSIONID] = @BLGLOBALENTITYEXTENSIONID
          AND ([CACOMPUTEDFEE].[CASTATUSID] NOT IN ( 10, 5 )); -- 10 => FeeStatuses.Deleted | 5 => FeeStatuses.Void
    RETURN @BALANCEDUE;
END;