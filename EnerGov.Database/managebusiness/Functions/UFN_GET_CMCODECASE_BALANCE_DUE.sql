 CREATE FUNCTION [managebusiness].[UFN_GET_CMCODECASE_BALANCE_DUE]
(
     @BLGLOBALENTITYEXTENSIONID CHAR(36)
)
RETURNS MONEY
AS
BEGIN
    DECLARE @BALANCEDUE AS MONEY
    SELECT @BALANCEDUE = ISNULL(SUM(CACOMPUTEDFEE.COMPUTEDAMOUNT - CACOMPUTEDFEE.AMOUNTPAIDTODATE),0)
    FROM [dbo].[CMCODECASEFEE]
    JOIN [dbo].[CMCODECASE] ON [dbo].[CMCODECASE].[CMCODECASEID] = [dbo].[CMCODECASEFEE].[CMCODECASEID]
        JOIN [dbo].[BLGLOBALENTITYEXTENSIONCODECASEXREF] ON [dbo].[BLGLOBALENTITYEXTENSIONCODECASEXREF].[CMCODECASEID] = [dbo].[CMCODECASEFEE].[CMCODECASEID]
           INNER JOIN [dbo].[CACOMPUTEDFEE]  ON [CMCODECASEFEE].[CACOMPUTEDFEEID] = [CACOMPUTEDFEE].[CACOMPUTEDFEEID]
    WHERE [BLGLOBALENTITYEXTENSIONCODECASEXREF].[BLGLOBALENTITYEXTENSIONID] = @BLGLOBALENTITYEXTENSIONID
          AND [CACOMPUTEDFEE].[CASTATUSID] NOT IN (10,5) -- FeeStatuses.Deleted | 5 --FeeStatuses.Void

    RETURN @BALANCEDUE;
END