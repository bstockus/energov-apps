CREATE TABLE [dbo].[HISTORYSYSTEMSETUP] (
    [HISTORYSYSTEMSETUPID] INT            IDENTITY (1, 1) NOT NULL,
    [ID]                   CHAR (36)      NOT NULL,
    [ROWVERSION]           INT            NOT NULL,
    [CHANGEDON]            DATETIME       NOT NULL,
    [CHANGEDBY]            CHAR (36)      NOT NULL,
    [FIELDNAME]            NVARCHAR (250) NOT NULL,
    [OLDVALUE]             NVARCHAR (MAX) NOT NULL,
    [NEWVALUE]             NVARCHAR (MAX) NOT NULL,
    [ADDITIONALINFO]       NVARCHAR (MAX) NOT NULL,
    [FORMID]               CHAR (36)      NULL,
    [ACTION]               INT            NULL,
    [ISROOT]               BIT            NULL,
    [RECORDNAME]           NVARCHAR (MAX) NULL,
    CONSTRAINT [PK_HistorySystemSetupID] PRIMARY KEY CLUSTERED ([HISTORYSYSTEMSETUPID] ASC) WITH (FILLFACTOR = 100),
    CONSTRAINT [HistorySystemSetup_Forms] FOREIGN KEY ([FORMID]) REFERENCES [dbo].[FORMS] ([SFORMSGUID]),
    CONSTRAINT [HistorySystemSetup_Users] FOREIGN KEY ([CHANGEDBY]) REFERENCES [dbo].[USERS] ([SUSERGUID])
);


GO
CREATE NONCLUSTERED INDEX [IDX_HSysSet_ChangedOn]
    ON [dbo].[HISTORYSYSTEMSETUP]([ID] ASC, [CHANGEDON] ASC, [HISTORYSYSTEMSETUPID] ASC, [CHANGEDBY] ASC, [FIELDNAME] ASC)
    INCLUDE([ROWVERSION], [OLDVALUE], [NEWVALUE], [ADDITIONALINFO]) WITH (FILLFACTOR = 80);


GO
CREATE NONCLUSTERED INDEX [HISTORYSYSTEMSETUP_IX_FORMID_ADDITIONALINFO_QUERY]
    ON [dbo].[HISTORYSYSTEMSETUP]([FORMID] ASC)
    INCLUDE([ADDITIONALINFO]);


GO
CREATE NONCLUSTERED INDEX [IX_HISTORYSYSTEMSETUP_FILTER_DISTINCT]
    ON [dbo].[HISTORYSYSTEMSETUP]([FORMID] ASC, [CHANGEDBY] ASC)
    INCLUDE([CHANGEDON], [FIELDNAME], [RECORDNAME]);

