CREATE TABLE [dbo].[SERVICETASKHISTORY] (
    [SERVICETASKHISTORYID] CHAR (36)      NOT NULL,
    [SERVICEID]            CHAR (36)      NOT NULL,
    [SERVICETASKID]        INT            NOT NULL,
    [STARTTIME]            DATETIME       NULL,
    [ENDTIME]              DATETIME       NULL,
    [AREDETAILSMONITORED]  BIT            DEFAULT ((0)) NOT NULL,
    [RESULT]               NVARCHAR (50)  NULL,
    [ERROR]                NVARCHAR (MAX) NULL,
    CONSTRAINT [PK_SERVICETASKHISTORY] PRIMARY KEY NONCLUSTERED ([SERVICETASKHISTORYID] ASC) WITH (FILLFACTOR = 80),
    CONSTRAINT [FK_SERVICETASKHISTORY_SRV] FOREIGN KEY ([SERVICEID]) REFERENCES [dbo].[SERVICE] ([SERVICEID]),
    CONSTRAINT [FK_SERVICETASKHISTORY_TSK] FOREIGN KEY ([SERVICETASKID]) REFERENCES [dbo].[SERVICETASK] ([SERVICETASKID])
);


GO
CREATE NONCLUSTERED INDEX [IX_SERVICETASKHISTORY_TSK]
    ON [dbo].[SERVICETASKHISTORY]([SERVICETASKID] ASC, [SERVICEID] ASC) WITH (FILLFACTOR = 80);


GO
CREATE NONCLUSTERED INDEX [IX_SERVICETASKHISTORY_MONITOR]
    ON [dbo].[SERVICETASKHISTORY]([SERVICETASKID] ASC, [STARTTIME] ASC);


GO
CREATE NONCLUSTERED INDEX [IX_SERVICETASKHISTORY_MONITOR_LAST_RUN]
    ON [dbo].[SERVICETASKHISTORY]([SERVICETASKID] ASC, [ENDTIME] ASC);


GO
CREATE NONCLUSTERED INDEX [IX_SERVICETASKHISTORY_SERVICETASKID]
    ON [dbo].[SERVICETASKHISTORY]([SERVICETASKID] ASC)
    INCLUDE([ENDTIME], [RESULT]);


GO
CREATE NONCLUSTERED INDEX [NCIDX_SERVICETASKHISTORY_ENDTIME]
    ON [dbo].[SERVICETASKHISTORY]([ENDTIME] DESC);

