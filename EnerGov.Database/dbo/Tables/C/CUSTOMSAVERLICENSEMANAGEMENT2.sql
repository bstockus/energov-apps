CREATE TABLE [dbo].[CUSTOMSAVERLICENSEMANAGEMENT2] (
    [ID] CHAR (36) NOT NULL,
    CONSTRAINT [PK_LicenseManagement2] PRIMARY KEY NONCLUSTERED ([ID] ASC) WITH (FILLFACTOR = 90)
);


GO

CREATE TRIGGER [TG_CUSTOMSAVERLICENSEMANAGEMENT2_UPDATE_ELASTIC_BUSINESS] ON  CUSTOMSAVERLICENSEMANAGEMENT2
   AFTER UPDATE
AS 
BEGIN
	SET NOCOUNT ON;

    INSERT INTO [ELASTICSEARCHOBJECT]
    ( [ELASTICSEARCHOBJECTID] ,
        [OBJECTID] ,
        [OBJECTCLASSNAME] ,
        [ROWVERSION] ,
        [CREATEDATE] ,
        [PROCESSEDDATE] ,
        [OBJECTACTION] ,
        [INDEXNAME]
    )
	SELECT
		NEWID() ,
		[B].[BLGLOBALENTITYEXTENSIONID] ,
        'EnerGovBusiness.BusinessLicense.BusinessLicenseGlobalEntityExtension' ,
        [B].[ROWVERSION] ,
        GETDATE() ,
        NULL ,
        2 ,
        (SELECT STRINGVALUE FROM SETTINGS WITH (NOLOCK) WHERE NAME = 'ServiceBusTenant')
	FROM [Inserted]
	JOIN [BLGLOBALENTITYEXTENSION] AS [B] WITH (NOLOCK) ON [B].[BLGLOBALENTITYEXTENSIONID] = [Inserted].[ID];

END

GO

CREATE TRIGGER [TG_CUSTOMSAVERLICENSEMANAGEMENT2_UPDATE_ELASTIC_LICENSE] ON  CUSTOMSAVERLICENSEMANAGEMENT2
   AFTER UPDATE
AS 
BEGIN
	SET NOCOUNT ON;

    INSERT INTO [ELASTICSEARCHOBJECT]
    ( [ELASTICSEARCHOBJECTID] ,
        [OBJECTID] ,
        [OBJECTCLASSNAME] ,
        [ROWVERSION] ,
        [CREATEDATE] ,
        [PROCESSEDDATE] ,
        [OBJECTACTION] ,
        [INDEXNAME]
    )
	SELECT
		NEWID() ,
		[B].[BLLICENSEID] ,
        'EnerGovBusiness.BusinessLicense.BusinessLicense' ,
        [B].[ROWVERSION] ,
        GETDATE() ,
        NULL ,
        2 ,
        (SELECT STRINGVALUE FROM SETTINGS WITH (NOLOCK) WHERE NAME = 'ServiceBusTenant')
	FROM [Inserted]
	JOIN [BLLICENSE] AS [B] WITH (NOLOCK) ON [B].[BLLICENSEID] = [Inserted].[ID];

END
