CREATE TABLE [dbo].[CMCODEWFACTIONSTEP] (
    [CMCODEWFACTIONSTEPID]       CHAR (36)       NOT NULL,
    [CMCODEWFSTEPID]             CHAR (36)       NOT NULL,
    [WFACTIONTYPEID]             INT             NOT NULL,
    [DESCRIPTION]                NVARCHAR (MAX)  NULL,
    [PRIORITYORDER]              INT             NOT NULL,
    [STARTDATE]                  DATETIME        NULL,
    [ENDDATE]                    DATETIME        NULL,
    [ROWVERSION]                 INT             NOT NULL,
    [LASTCHANGEDON]              DATETIME        NOT NULL,
    [LASTCHANGEDBY]              CHAR (36)       NOT NULL,
    [WORKFLOWSTATUSID]           INT             NOT NULL,
    [LOCATION]                   NVARCHAR (50)   NULL,
    [EXPECTEDDURATIONHOURS]      DECIMAL (6, 2)  NULL,
    [EVENTDATE]                  DATETIME        NULL,
    [NAME]                       NVARCHAR (100)  NOT NULL,
    [HEARINGTYPEID]              CHAR (36)       NULL,
    [PASSDESCRIPTION]            NVARCHAR (30)   NOT NULL,
    [FAILDESCRIPTION]            NVARCHAR (30)   NOT NULL,
    [ALLOWREDO]                  BIT             NOT NULL,
    [REDODESCRIPTION]            NVARCHAR (30)   NULL,
    [ICON]                       VARBINARY (MAX) NULL,
    [DAYSTOCOMPLETE]             INT             NULL,
    [MEETINGTYPEID]              CHAR (36)       NULL,
    [CMCODEWFPARENTACTIONSTEPID] CHAR (36)       NULL,
    [VERSIONNUMBER]              INT             NULL,
    [SORTORDER]                  INT             NOT NULL,
    [GENERALREASON]              NVARCHAR (MAX)  NULL,
    [AUTORECEIVE]                BIT             NOT NULL,
    [AUTOCOMPLETED]              BIT             NOT NULL,
    [WORKFLOWCOMPLETETYPEID]     INT             NULL,
    [PMPERMITTYPEID]             CHAR (36)       NULL,
    [PMPERMITWORKCLASSID]        CHAR (36)       NULL,
    [PLPLANTYPEID]               CHAR (36)       NULL,
    [PLPLANWORKCLASSID]          CHAR (36)       NULL,
    [IMINSPECTIONTYPEID]         CHAR (36)       NULL,
    [CMCODEACTIVITYTYPEID]       CHAR (36)       NULL,
    [RPTREPORTID]                CHAR (36)       NULL,
    [CMCODEID]                   CHAR (36)       NULL,
    [TASKTYPEID]                 CHAR (36)       NULL,
    [NOPRIORITY]                 BIT             DEFAULT ((0)) NOT NULL,
    [DUEDATE]                    DATETIME        NULL,
    [CAFEETEMPLATEID]            CHAR (36)       NULL,
    [ISAUTOINVOICE]              BIT             CONSTRAINT [DF_CMCODEWFACTIONSTEP_ISAUTOINVOICE] DEFAULT ((0)) NOT NULL,
    [ISREQUIREDFULLPAYMNENT]     BIT             CONSTRAINT [DF_CMCODEWFACTIONSTEP_ISREQUIRED] DEFAULT ((0)) NOT NULL,
    [PARENTINSPECTIONNUMBER]     NVARCHAR (50)   NULL,
    [COMPUTEFEEACTIONTYPEID]     INT             DEFAULT ((0)) NULL,
    [ISUSEACTIONDATEASFEEDATE]   BIT             DEFAULT ((0)) NOT NULL,
    [ISCOMPUTEMAINFEETEMPLATE]   BIT             DEFAULT ((0)) NOT NULL,
    [INSPECTIONSET]              INT             CONSTRAINT [DF_CMCODEWFACTIONSTEP_SET] DEFAULT ((0)) NOT NULL,
    [CMCASETYPEID]               CHAR (36)       NULL,
    [WKOTYPEID]                  INT             NULL,
    [WKOTYPENAME]                VARCHAR (255)   NULL,
    [WKOCLASSID]                 INT             NULL,
    [WKOCLASSNAME]               VARCHAR (255)   NULL,
    [IDENTITYCOLUMN]             BIGINT          IDENTITY (1, 1) NOT NULL,
    CONSTRAINT [PK_CodeWFActionStep] PRIMARY KEY NONCLUSTERED ([CMCODEWFACTIONSTEPID] ASC) WITH (FILLFACTOR = 80),
    CONSTRAINT [FK_CMActionStep_CMStep] FOREIGN KEY ([CMCODEWFSTEPID]) REFERENCES [dbo].[CMCODEWFSTEP] ([CMCODEWFSTEPID]),
    CONSTRAINT [FK_CMACTSTEP_CMCASETYPE] FOREIGN KEY ([CMCASETYPEID]) REFERENCES [dbo].[CMCASETYPE] ([CMCASETYPEID]),
    CONSTRAINT [FK_CMCodeActStep_TaskType] FOREIGN KEY ([TASKTYPEID]) REFERENCES [dbo].[TASKTYPE] ([TASKTYPEID]),
    CONSTRAINT [FK_CMCODEWFACTIONSTEP_CAFEETEMPLATE] FOREIGN KEY ([CAFEETEMPLATEID]) REFERENCES [dbo].[CAFEETEMPLATE] ([CAFEETEMPLATEID]),
    CONSTRAINT [FK_CMCodeWFActionStep_InsT] FOREIGN KEY ([IMINSPECTIONTYPEID]) REFERENCES [dbo].[IMINSPECTIONTYPE] ([IMINSPECTIONTYPEID]),
    CONSTRAINT [FK_CMViolation_CodeID] FOREIGN KEY ([CMCODEID]) REFERENCES [dbo].[CMCODE] ([CMCODEID]),
    CONSTRAINT [FK_CMWFACT_ACTIONTYPEID] FOREIGN KEY ([COMPUTEFEEACTIONTYPEID]) REFERENCES [dbo].[WFACTIONSYSTEMTYPE] ([WFACTIONSYSTEMTYPEID]),
    CONSTRAINT [FK_CMWFActionStep_PLType] FOREIGN KEY ([PLPLANTYPEID]) REFERENCES [dbo].[PLPLANTYPE] ([PLPLANTYPEID]),
    CONSTRAINT [FK_CMWFActionStep_PLWC] FOREIGN KEY ([PLPLANWORKCLASSID]) REFERENCES [dbo].[PLPLANWORKCLASS] ([PLPLANWORKCLASSID]),
    CONSTRAINT [FK_CMWFActionStep_PMType] FOREIGN KEY ([PMPERMITTYPEID]) REFERENCES [dbo].[PMPERMITTYPE] ([PMPERMITTYPEID]),
    CONSTRAINT [FK_CMWFActionStep_PMWC] FOREIGN KEY ([PMPERMITWORKCLASSID]) REFERENCES [dbo].[PMPERMITWORKCLASS] ([PMPERMITWORKCLASSID]),
    CONSTRAINT [FK_CMWFActionStep_WFCompType] FOREIGN KEY ([WORKFLOWCOMPLETETYPEID]) REFERENCES [dbo].[WORKFLOWCOMPLETETYPE] ([WORKFLOWCOMPLETETYPEID]),
    CONSTRAINT [FK_CMWFActStep_CMActType] FOREIGN KEY ([CMCODEACTIVITYTYPEID]) REFERENCES [dbo].[CMCODEACTIVITYTYPE] ([CMCODEACTIVITYTYPEID]),
    CONSTRAINT [FK_CMWFActStep_RPTReport] FOREIGN KEY ([RPTREPORTID]) REFERENCES [dbo].[RPTREPORT] ([RPTREPORTID]),
    CONSTRAINT [FK_CodeWFActionStep_HearingType] FOREIGN KEY ([HEARINGTYPEID]) REFERENCES [dbo].[HEARINGTYPE] ([HEARINGTYPEID]),
    CONSTRAINT [FK_CodeWFActionStep_MeetingType] FOREIGN KEY ([MEETINGTYPEID]) REFERENCES [dbo].[MEETINGTYPE] ([MEETINGTYPEID]),
    CONSTRAINT [FK_CodeWFActionStep_Users] FOREIGN KEY ([LASTCHANGEDBY]) REFERENCES [dbo].[USERS] ([SUSERGUID]),
    CONSTRAINT [FK_CodeWFActionStep_WFActionType] FOREIGN KEY ([WFACTIONTYPEID]) REFERENCES [dbo].[WFACTIONTYPE] ([WFACTIONTYPEID]),
    CONSTRAINT [FK_CodeWFActionStep_WorkflowStatus] FOREIGN KEY ([WORKFLOWSTATUSID]) REFERENCES [dbo].[WORKFLOWSTATUS] ([WORKFLOWSTATUSID]),
    CONSTRAINT [FK_Parent_ActionStep] FOREIGN KEY ([CMCODEWFPARENTACTIONSTEPID]) REFERENCES [dbo].[CMCODEWFACTIONSTEP] ([CMCODEWFACTIONSTEPID])
);


GO
CREATE CLUSTERED INDEX [CLIDX_CMCODEWFACTSTEP_IDCOL]
    ON [dbo].[CMCODEWFACTIONSTEP]([IDENTITYCOLUMN] ASC) WITH (FILLFACTOR = 100);


GO
CREATE NONCLUSTERED INDEX [CMCODEWFPARENTACTIONSTEPID_IDX]
    ON [dbo].[CMCODEWFACTIONSTEP]([CMCODEWFPARENTACTIONSTEPID] ASC) WITH (FILLFACTOR = 80);


GO
CREATE NONCLUSTERED INDEX [IMPORT1]
    ON [dbo].[CMCODEWFACTIONSTEP]([CMCODEWFSTEPID] ASC) WITH (FILLFACTOR = 80);


GO
CREATE NONCLUSTERED INDEX [IMPORT2]
    ON [dbo].[CMCODEWFACTIONSTEP]([IMINSPECTIONTYPEID] ASC) WITH (FILLFACTOR = 80);


GO
CREATE NONCLUSTERED INDEX [NCIDX_CMCODEWFACTIONSTEP_CMCODEWFSTEPID_INCL]
    ON [dbo].[CMCODEWFACTIONSTEP]([CMCODEWFSTEPID] ASC)
    INCLUDE([CMCODEWFACTIONSTEPID]) WITH (FILLFACTOR = 90, PAD_INDEX = ON);

