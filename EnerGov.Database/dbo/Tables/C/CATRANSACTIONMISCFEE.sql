CREATE TABLE [dbo].[CATRANSACTIONMISCFEE] (
    [CATRANSACTIONMISCFEEID] CHAR (36) NOT NULL,
    [CAMISCFEEID]            CHAR (36) NOT NULL,
    [CATRANSACTIONID]        CHAR (36) NOT NULL,
    [CASTATUSID]             INT       CONSTRAINT [DEF_CATransactionMiscFee_Status] DEFAULT ((1)) NOT NULL,
    [ROWVERSION]             INT       CONSTRAINT [DF_CATransactionMiscFee_RowVersion] DEFAULT ((1)) NOT NULL,
    [LASTCHANGEDON]          DATETIME  CONSTRAINT [DF_CATransactionMiscFee_LastChangedOn] DEFAULT (getdate()) NOT NULL,
    [LASTCHANGEDBY]          CHAR (36) NOT NULL,
    [PAIDAMOUNT]             MONEY     CONSTRAINT [DEF_CATransMiscFee_PaidAmount] DEFAULT ((0)) NOT NULL,
    [REFUNDAMOUNT]           MONEY     CONSTRAINT [DF_CATransMiscFee_RefundAmount] DEFAULT ((0)) NOT NULL,
    CONSTRAINT [PK_CATransactionMiscFee] PRIMARY KEY NONCLUSTERED ([CATRANSACTIONMISCFEEID] ASC) WITH (FILLFACTOR = 80),
    CONSTRAINT [FK_CATransactionMiscFee_Status] FOREIGN KEY ([CASTATUSID]) REFERENCES [dbo].[CASTATUS] ([CASTATUSID]),
    CONSTRAINT [FK_CATransactionMiscFee_Users] FOREIGN KEY ([LASTCHANGEDBY]) REFERENCES [dbo].[USERS] ([SUSERGUID]),
    CONSTRAINT [FK_CATransMiscFee_CATran] FOREIGN KEY ([CATRANSACTIONID]) REFERENCES [dbo].[CATRANSACTION] ([CATRANSACTIONID]),
    CONSTRAINT [FK_CATransMiscFee_Fee] FOREIGN KEY ([CAMISCFEEID]) REFERENCES [dbo].[CAMISCFEE] ([CAMISCFEEID])
);


GO
CREATE NONCLUSTERED INDEX [IX_CATRANSACTIONMISCFEE_CATRANSACTIONID]
    ON [dbo].[CATRANSACTIONMISCFEE]([CATRANSACTIONID] ASC);


GO

CREATE TRIGGER [TG_CATRANSACTIONMISCFEE_DELETE_ELASTIC_FEE] ON  CATRANSACTIONMISCFEE
   AFTER DELETE
AS 
BEGIN
	SET NOCOUNT ON;

    INSERT INTO [ELASTICSEARCHOBJECT]
    ( [ELASTICSEARCHOBJECTID] ,
        [OBJECTID] ,
        [OBJECTCLASSNAME] ,
        [ROWVERSION] ,
        [CREATEDATE] ,
        [PROCESSEDDATE] ,
        [OBJECTACTION] ,
        [INDEXNAME]
    )
	SELECT
		NEWID() ,
		[Deleted].[CATRANSACTIONMISCFEEID] ,
        'EnerGovBusiness.Cashier.Fee' ,
        1 ,
        GETDATE() ,
        NULL ,
        3 ,
        (SELECT STRINGVALUE FROM SETTINGS WITH (NOLOCK) WHERE NAME = 'ServiceBusTenant')
	FROM [Deleted];

END
GO


CREATE TRIGGER [TG_CATRANSACTIONMISCFEE_INSERT_ELASTIC_FEE] ON  CATRANSACTIONMISCFEE
   AFTER INSERT
AS 
BEGIN
	SET NOCOUNT ON;

    INSERT INTO [ELASTICSEARCHOBJECT]
    ( [ELASTICSEARCHOBJECTID] ,
        [OBJECTID] ,
        [OBJECTCLASSNAME] ,
        [ROWVERSION] ,
        [CREATEDATE] ,
        [PROCESSEDDATE] ,
        [OBJECTACTION] ,
        [INDEXNAME]
    )
	SELECT
		NEWID() ,
		[Inserted].[CAMISCFEEID] ,
        'EnerGovBusiness.Cashier.Fee' ,
        1 ,
        GETDATE() ,
        NULL ,
        1 ,
        (SELECT STRINGVALUE FROM SETTINGS WITH (NOLOCK) WHERE NAME = 'ServiceBusTenant')
	FROM [Inserted];

END
GO

CREATE TRIGGER [TG_CATRANSACTIONMISCFEE_UPDATE_ELASTIC_FEE] ON  CATRANSACTIONMISCFEE
   AFTER UPDATE
AS 
BEGIN
	SET NOCOUNT ON;

    INSERT INTO [ELASTICSEARCHOBJECT]
    ( [ELASTICSEARCHOBJECTID] ,
        [OBJECTID] ,
        [OBJECTCLASSNAME] ,
        [ROWVERSION] ,
        [CREATEDATE] ,
        [PROCESSEDDATE] ,
        [OBJECTACTION] ,
        [INDEXNAME]
    )
	SELECT
		NEWID() ,
		[Inserted].[CAMISCFEEID] ,
        'EnerGovBusiness.Cashier.Fee' ,
        1 ,
        GETDATE() ,
        NULL ,
        2 ,
        (SELECT STRINGVALUE FROM SETTINGS WITH (NOLOCK) WHERE NAME = 'ServiceBusTenant')
	FROM [Inserted];

END