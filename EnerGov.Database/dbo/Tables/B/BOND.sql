CREATE TABLE [dbo].[BOND] (
    [BONDID]                CHAR (36)     NOT NULL,
    [BONDNUMBER]            NVARCHAR (50) NOT NULL,
    [BONDTYPEID]            CHAR (36)     NOT NULL,
    [BONDSTATUSID]          CHAR (36)     NOT NULL,
    [BONDDATE]              DATETIME      NULL,
    [BONDEXPIRATIONDATE]    DATETIME      NULL,
    [BONDRELEASEDATE]       DATETIME      NULL,
    [AMOUNT]                MONEY         NOT NULL,
    [OBLIGEEID]             CHAR (36)     NOT NULL,
    [PRINCIPALID]           CHAR (36)     NOT NULL,
    [SURETYID]              CHAR (36)     NOT NULL,
    [GLOBALENTITYACCOUNTID] CHAR (36)     NULL,
    CONSTRAINT [PK_Bond] PRIMARY KEY CLUSTERED ([BONDID] ASC) WITH (FILLFACTOR = 90),
    CONSTRAINT [FK_Bond_BondStatus] FOREIGN KEY ([BONDSTATUSID]) REFERENCES [dbo].[BONDSTATUS] ([BONDSTATUSID]),
    CONSTRAINT [FK_Bond_BondType] FOREIGN KEY ([BONDTYPEID]) REFERENCES [dbo].[BONDTYPE] ([BONDTYPEID]),
    CONSTRAINT [FK_Bond_GEObligee] FOREIGN KEY ([OBLIGEEID]) REFERENCES [dbo].[GLOBALENTITY] ([GLOBALENTITYID]),
    CONSTRAINT [FK_Bond_GEPrincipal] FOREIGN KEY ([PRINCIPALID]) REFERENCES [dbo].[GLOBALENTITY] ([GLOBALENTITYID]),
    CONSTRAINT [FK_Bond_GESurety] FOREIGN KEY ([SURETYID]) REFERENCES [dbo].[GLOBALENTITY] ([GLOBALENTITYID]),
    CONSTRAINT [FK_Bond_GlobalEntityAccount] FOREIGN KEY ([GLOBALENTITYACCOUNTID]) REFERENCES [dbo].[GLOBALENTITYACCOUNT] ([GLOBALENTITYACCOUNTID])
);


GO
CREATE NONCLUSTERED INDEX [IX_BONDNOTE_BONDID]
    ON [dbo].[BOND]([BONDID] ASC);


GO

CREATE TRIGGER [TG_BOND_INSERT_ELASTIC] ON  BOND
   AFTER INSERT
AS 
BEGIN
	SET NOCOUNT ON;

    INSERT INTO [ELASTICSEARCHOBJECT]
    ( [ELASTICSEARCHOBJECTID] ,
        [OBJECTID] ,
        [OBJECTCLASSNAME] ,
        [ROWVERSION] ,
        [CREATEDATE] ,
        [PROCESSEDDATE] ,
        [OBJECTACTION] ,
        [INDEXNAME]
    )
	SELECT
		NEWID() ,
		[Inserted].[BONDID] ,
        'EnerGovBusiness.BondManagement.Bond' ,
        1 ,
        GETDATE() ,
        NULL ,
        1 ,
        (SELECT STRINGVALUE FROM SETTINGS WITH (NOLOCK) WHERE NAME = 'ServiceBusTenant')
	FROM [Inserted];

END
GO

CREATE TRIGGER [TG_BOND_DELETE_ELASTIC] ON  BOND
   AFTER DELETE
AS 
BEGIN
	SET NOCOUNT ON;

    INSERT INTO [ELASTICSEARCHOBJECT]
    ( [ELASTICSEARCHOBJECTID] ,
        [OBJECTID] ,
        [OBJECTCLASSNAME] ,
        [ROWVERSION] ,
        [CREATEDATE] ,
        [PROCESSEDDATE] ,
        [OBJECTACTION] ,
        [INDEXNAME]
    )
	SELECT
		NEWID() ,
		[Deleted].[BONDID] ,
        'EnerGovBusiness.BondManagement.Bond' ,
        1 ,
        GETDATE() ,
        NULL ,
        3 ,
        (SELECT STRINGVALUE FROM SETTINGS WITH (NOLOCK) WHERE NAME = 'ServiceBusTenant')
	FROM [Deleted];

END
GO

CREATE TRIGGER [TG_BOND_UPDATE_ELASTIC] ON  BOND
   AFTER UPDATE
AS 
BEGIN
	SET NOCOUNT ON;

    INSERT INTO [ELASTICSEARCHOBJECT]
    ( [ELASTICSEARCHOBJECTID] ,
        [OBJECTID] ,
        [OBJECTCLASSNAME] ,
        [ROWVERSION] ,
        [CREATEDATE] ,
        [PROCESSEDDATE] ,
        [OBJECTACTION] ,
        [INDEXNAME]
    )
	SELECT
		NEWID() ,
		[Inserted].[BONDID] ,
        'EnerGovBusiness.BondManagement.Bond' ,
        1 ,
        GETDATE() ,
        NULL ,
        2 ,
        (SELECT STRINGVALUE FROM SETTINGS WITH (NOLOCK) WHERE NAME = 'ServiceBusTenant')
	FROM [Inserted];

END