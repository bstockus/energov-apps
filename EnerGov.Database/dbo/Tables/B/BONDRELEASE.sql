CREATE TABLE [dbo].[BONDRELEASE] (
    [BONDRELEASEID]         CHAR (36)       NOT NULL,
    [BONDID]                CHAR (36)       NOT NULL,
    [GLOBALENTITYACCOUNTID] CHAR (36)       NULL,
    [CREATEDBY]             CHAR (36)       NOT NULL,
    [CREATEDDATE]           DATETIME        NULL,
    [DESCRIPTION]           NVARCHAR (MAX)  NULL,
    [AMOUNT]                MONEY           NOT NULL,
    [INTERESTRATE]          DECIMAL (20, 4) NULL,
    [BASEAMOUNT]            DECIMAL (20, 4) NULL,
    [INTERESTDATEFROM]      DATETIME        NULL,
    [INTERESTDATETO]        DATETIME        NULL,
    [COMPUTEDINTEREST]      DECIMAL (20, 4) NULL,
    [ISVOID]                BIT             DEFAULT ((0)) NOT NULL,
    [ORIGINALAMOUNT]        MONEY           NULL,
    [BONDINTADJREASONID]    CHAR (36)       NULL,
    [ADJUSTNOTE]            NVARCHAR (500)  NULL,
    CONSTRAINT [PK_BondRelease] PRIMARY KEY CLUSTERED ([BONDRELEASEID] ASC) WITH (FILLFACTOR = 90),
    CONSTRAINT [FK_BondRel_GlobalEntAcct] FOREIGN KEY ([GLOBALENTITYACCOUNTID]) REFERENCES [dbo].[GLOBALENTITYACCOUNT] ([GLOBALENTITYACCOUNTID]),
    CONSTRAINT [FK_BONDRELEASE_ADJREASON] FOREIGN KEY ([BONDINTADJREASONID]) REFERENCES [dbo].[BONDINTADJREASON] ([BONDINTADJREASONID]),
    CONSTRAINT [FK_BondRelease_Bond] FOREIGN KEY ([BONDID]) REFERENCES [dbo].[BOND] ([BONDID]),
    CONSTRAINT [FK_BondRelease_Users] FOREIGN KEY ([CREATEDBY]) REFERENCES [dbo].[USERS] ([SUSERGUID])
);


GO

CREATE TRIGGER [TG_BONDRELEASE_INSERT_ELASTIC] ON  [dbo].[BONDRELEASE]
   AFTER INSERT
AS 
BEGIN
	SET NOCOUNT ON;

    INSERT INTO [ELASTICSEARCHOBJECT]
    ( [ELASTICSEARCHOBJECTID] ,
        [OBJECTID] ,
        [OBJECTCLASSNAME] ,
        [ROWVERSION] ,
        [CREATEDATE] ,
        [PROCESSEDDATE] ,
        [OBJECTACTION] ,
        [INDEXNAME]
    )
	SELECT
		NEWID() ,
		[Inserted].[BONDID] ,
        'EnerGovBusiness.BondManagement.Bond' ,
        1 ,
        GETDATE() ,
        NULL ,
        2 ,
        (SELECT STRINGVALUE FROM SETTINGS WITH (NOLOCK) WHERE NAME = 'ServiceBusTenant')
	FROM [Inserted];

END
GO

CREATE TRIGGER [TG_BONDRELEASE_UPDATE_ELASTIC] ON  [dbo].[BONDRELEASE]
   AFTER UPDATE
AS 
BEGIN
	SET NOCOUNT ON;

    INSERT INTO [ELASTICSEARCHOBJECT]
    ( [ELASTICSEARCHOBJECTID] ,
        [OBJECTID] ,
        [OBJECTCLASSNAME] ,
        [ROWVERSION] ,
        [CREATEDATE] ,
        [PROCESSEDDATE] ,
        [OBJECTACTION] ,
        [INDEXNAME]
    )
	SELECT
		NEWID() ,
		[Inserted].[BONDID] ,
        'EnerGovBusiness.BondManagement.Bond' ,
        1 ,
        GETDATE() ,
        NULL ,
        2 ,
        (SELECT STRINGVALUE FROM SETTINGS WITH (NOLOCK) WHERE NAME = 'ServiceBusTenant')
	FROM [Inserted];

END