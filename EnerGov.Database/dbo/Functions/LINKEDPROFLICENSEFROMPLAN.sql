CREATE FUNCTION DBO.LINKEDPROFLICENSEFROMPLAN
(	
	@ENTITY_ID char(36),
	@USER_ID char(36)
)
RETURNS TABLE 
AS
RETURN 
(
		select oneLicense.ILLICENSEID from PLPLANACTIONREF xref INNER JOIN ILLICENSEWFACTIONSTEP illicense ON xref.OBJECTID = illicense.ILLICENSEWFACTIONSTEPID  
		INNER JOIN ILLICENSEWFSTEP step on illicense.ILLICENSEWFSTEPID = step.ILLICENSEWFSTEPID  
		INNER JOIN ILLICENSE oneLicense on step.ILLICENSEID = oneLicense.ILLICENSEID  
		INNER JOIN GETUSERVISIBLERECORDTYPES(@USER_ID) u on oneLicense.ILLICENSETYPEID = u.RECORDTYPEID
		where(xref.PLPLANID = @ENTITY_ID)	 
)
