
CREATE FUNCTION [dbo].[PLAN_HAS_FAILED_INSPECTIONS]
(
	@PLPLAN_ID CHAR(36)
)
RETURNS BIT
AS
BEGIN
	DECLARE @RESULT AS BIT
	SET @RESULT = 0
	
	IF (EXISTS(SELECT * FROM IMINSPECTION
					INNER JOIN PLPLAN ON PLPLAN.PLPLANID = IMINSPECTION.LINKID
					INNER JOIN IMINSPECTIONSTATUS ON IMINSPECTIONSTATUS.IMINSPECTIONSTATUSID = IMINSPECTION.IMINSPECTIONSTATUSID
					WHERE PLPLAN.PLPLANID = @PLPLAN_ID AND (IMINSPECTIONSTATUS.REINSPECTIONFLAG = 1 OR IMINSPECTIONSTATUS.INVIOLATIONFLAG = 1)))
	BEGIN
		SET @RESULT = 1
	END

	RETURN @RESULT
END

