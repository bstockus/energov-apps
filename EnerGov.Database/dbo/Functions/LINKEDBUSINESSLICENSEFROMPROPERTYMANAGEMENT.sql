CREATE FUNCTION DBO.LINKEDBUSINESSLICENSEFROMPROPERTYMANAGEMENT
(	
	@ENTITY_ID char(36),
	@USER_ID char(36),
	@BLLICENSETYPEMODULE_ID INT
)
RETURNS TABLE 
AS
RETURN 
(
	SELECT DISTINCT BLLICENSE.BLLICENSEID  FROM BLLICENSEPARCEL
	INNER JOIN BLLICENSE ON  BLLICENSEPARCEL.BLLICENSEID = BLLICENSE.BLLICENSEID
	INNER JOIN GETUSERVISIBLERECORDTYPES(@USER_ID) u on BLLICENSE.BLLICENSETYPEID = u.RECORDTYPEID
	INNER JOIN BLLICENSETYPE ON BLLICENSETYPE.BLLICENSETYPEID= BLLICENSE.BLLICENSETYPEID
	WHERE (BLLICENSEPARCEL.PARCELID = @ENTITY_ID AND BLLICENSETYPE.BLLICENSETYPEMODULEID=@BLLICENSETYPEMODULE_ID)
)