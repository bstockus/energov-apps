CREATE FUNCTION DBO.LINKEDPERMITFROMCONTACT
(	
	@ENTITY_ID char(36),
	@USER_ID char(36)
)
RETURNS TABLE 
AS
RETURN 
(
	SELECT DISTINCT PMPERMIT.PMPERMITID, 0 AS ISCHILD, 1 AS ISPARENT from PMPERMITCONTACT 
	INNER JOIN PMPERMIT ON PMPERMITCONTACT.PMPERMITID = PMPERMIT.PMPERMITID 
	INNER JOIN GETUSERVISIBLERECORDTYPES(@USER_ID) u on PMPERMIT.PMPERMITTYPEID = u.RECORDTYPEID
	WHERE(PMPERMITCONTACT.GLOBALENTITYID = @ENTITY_ID)
)