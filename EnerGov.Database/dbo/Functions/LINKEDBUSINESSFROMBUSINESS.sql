CREATE FUNCTION DBO.LINKEDBUSINESSFROMBUSINESS
(	
	@ENTITY_ID char(36),
	@BLEXTCOMPANYTYPEMODULE_ID INT
)
RETURNS TABLE 
AS
RETURN 
(
		select blxc.BLGLOBALENTITYEXTENSIONCHILDID from BLGLOBALENTITYEXTENSIONPARENTC blxc INNER JOIN
		BLGLOBALENTITYEXTENSION blx on blx.BLGLOBALENTITYEXTENSIONID = blxc.BLGLOBALENTITYEXTPARENTID 
		INNER JOIN BLEXTCOMPANYTYPE ON BLEXTCOMPANYTYPE.BLEXTCOMPANYTYPEID = blx.BLEXTCOMPANYTYPEID
		where blxc.BLGLOBALENTITYEXTPARENTID = @ENTITY_ID AND BLEXTCOMPANYTYPE.BLEXTCOMPANYTYPEMODULEID= @BLEXTCOMPANYTYPEMODULE_ID	
		UNION ALL
		select blxc.BLGLOBALENTITYEXTPARENTID from BLGLOBALENTITYEXTENSIONPARENTC blxc INNER JOIN
		BLGLOBALENTITYEXTENSION blx on blx.BLGLOBALENTITYEXTENSIONID = blxc.BLGLOBALENTITYEXTENSIONCHILDID 
		INNER JOIN BLEXTCOMPANYTYPE ON BLEXTCOMPANYTYPE.BLEXTCOMPANYTYPEID = blx.BLEXTCOMPANYTYPEID
		where blxc.BLGLOBALENTITYEXTENSIONCHILDID = @ENTITY_ID AND BLEXTCOMPANYTYPE.BLEXTCOMPANYTYPEMODULEID= @BLEXTCOMPANYTYPEMODULE_ID	
		
)