CREATE FUNCTION [dbo].[GETTOPPARENTCONDITIONGROUPIDS]
(
		@CACONDITIONGROUPIDS AS [RecordIDs] READONLY
)
RETURNS @TOPPARENTCONDITIONGROUPIDS TABLE(TOPPARENTCONDITIONGROUPID CHAR(36),CONDITIONGROUPID CHAR(36))
AS
BEGIN	
	;WITH CTE AS
	(
		SELECT 
			[CACONDITIONGROUP].[CACONDITIONGROUPID],
			[CACONDITIONGROUP].[PARENTCONDITIONGROUPID], 
			[RECORDID] AS [CONDITIONGROUPIDS]			
		FROM [dbo].[CACONDITIONGROUP] 
		INNER JOIN @CACONDITIONGROUPIDS ON [CACONDITIONGROUP].[CACONDITIONGROUPID] = [RECORDID] 		
		UNION ALL
		SELECT 
			[CHILDRECORD].[CACONDITIONGROUPID],
			[CHILDRECORD].[PARENTCONDITIONGROUPID],
			[PARENTRECORD].[CONDITIONGROUPIDS]
		FROM 
			[dbo].[CACONDITIONGROUP] [CHILDRECORD] INNER JOIN CTE AS [PARENTRECORD] 
				ON [CHILDRECORD].[CACONDITIONGROUPID] = [PARENTRECORD].[PARENTCONDITIONGROUPID]
	)
	INSERT INTO @TOPPARENTCONDITIONGROUPIDS(TOPPARENTCONDITIONGROUPID,CONDITIONGROUPID)
	SELECT [CTE].[CACONDITIONGROUPID], [CTE].[CONDITIONGROUPIDS]
	FROM [CTE] 
	WHERE [CTE].[PARENTCONDITIONGROUPID] IS NULL
	RETURN
END