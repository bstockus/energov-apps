CREATE FUNCTION [dbo].[LINKEDPLANFROMOBJECTCASE]
(
	@ENTITY_ID char(36),
	@USER_ID char(36)
)
RETURNS TABLE 
AS 
RETURN
(
	SELECT DISTINCT PLPLANOBJECT.PLPLANID, 1 AS ISCHILD, 0 AS ISPARENT FROM PLPLANOBJECT
	INNER JOIN PLPLAN ON PLPLANOBJECT.PLPLANID = PLPLAN.PLPLANID
	INNER JOIN GETUSERVISIBLERECORDTYPES(@USER_ID) u ON PLPLAN.PLPLANTYPEID = u.RECORDTYPEID	
	WHERE PLPLANOBJECT.OMOBJECTID = @ENTITY_ID
)