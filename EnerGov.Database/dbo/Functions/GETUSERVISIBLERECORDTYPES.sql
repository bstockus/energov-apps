CREATE FUNCTION [dbo].[GETUSERVISIBLERECORDTYPES]
(    
    @USERID char(36)
)
RETURNS TABLE
AS
RETURN
(
        SELECT rt.RECORDTYPEID FROM USERS u
        INNER JOIN ROLERECORDTYPEXREF rt ON u.SROLEID = rt.ROLEID
        WHERE u.SUSERGUID = @USERID and rt.VISIBLE = 1    
)