CREATE FUNCTION DBO.LINKEDCODECASEFROMPROFESSIONALLICENSE
(	
	@ENTITY_ID char(36),
	@USER_ID char(36)
)
RETURNS TABLE 
AS
RETURN 
(
	SELECT CMCODECASE.CMCODECASEID,1 AS ISCHILD, 0 AS ISPARENT 	FROM ILLICENSE 
	INNER JOIN ILLICENSEWFSTEP ON ILLICENSE.ILLICENSEID = ILLICENSEWFSTEP.ILLICENSEID
	INNER JOIN ILLICENSEWFACTIONSTEP ON ILLICENSEWFSTEP.ILLICENSEWFSTEPID = ILLICENSEWFACTIONSTEP.ILLICENSEWFSTEPID
	INNER JOIN CMCODECASEACTIONREF ON 	ILLICENSEWFACTIONSTEP.ILLICENSEWFACTIONSTEPID = CMCODECASEACTIONREF.CMCODECASEACTIONREFID
	INNER JOIN CMCODECASE ON CMCODECASEACTIONREF.CMCODECASEID = CMCODECASE.CMCODECASEID 
	INNER JOIN GETUSERVISIBLERECORDTYPES(@USER_ID) u on CMCODECASE.CMCASETYPEID = u.RECORDTYPEID
	WHERE (ILLICENSE.ILLICENSEID = @ENTITY_ID)
)