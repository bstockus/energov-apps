CREATE FUNCTION [dbo].[LINKEDPERMITFROMOBJECTCASE]
(
	@ENTITY_ID char(36),
	@USER_ID char(36)
)
RETURNS TABLE 
AS 
RETURN
(
	SELECT DISTINCT PMPERMITOBJECT.PMPERMITID, 1 AS ISCHILD, 0 AS ISPARENT FROM PMPERMITOBJECT
	INNER JOIN PMPERMIT ON PMPERMITOBJECT.PMPERMITID = PMPERMIT.PMPERMITID
	INNER JOIN GETUSERVISIBLERECORDTYPES(@USER_ID) u ON PMPERMIT.PMPERMITTYPEID = u.RECORDTYPEID	
	WHERE PMPERMITOBJECT.OMOBJECTID = @ENTITY_ID
)