CREATE PROCEDURE [dbo].[USP_OFFICE_DELETE]
(
   @OFFICEID CHAR(36),
   @ROWVERSION INT
)
AS
BEGIN
	SET NOCOUNT ON;
	DECLARE @DELETEDADDRESSES AS TABLE(MAILINGADDRESSID CHAR(36))
	DELETE FROM OFFICEADDRESS OUTPUT DELETED.MAILLINGADDRESSID INTO @DELETEDADDRESSES WHERE OFFICEID = @OFFICEID
    DELETE FROM MAILINGADDRESS WHERE MAILINGADDRESSID IN (SELECT MAILINGADDRESSID FROM @DELETEDADDRESSES)

	EXEC [dbo].[USP_OFFICEHOURS_DELETE_BYPARENTID] @OFFICEID

	SET NOCOUNT OFF;
	DELETE FROM [dbo].[OFFICE]
	WHERE
		[OFFICEID] = @OFFICEID AND
		[ROWVERSION]= @ROWVERSION
END