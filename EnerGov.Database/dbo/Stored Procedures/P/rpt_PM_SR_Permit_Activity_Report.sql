

CREATE PROCEDURE [dbo].[rpt_PM_SR_Permit_Activity_Report]
@PMPERMITID AS VARCHAR(36)
AS
BEGIN
--exec rpt_PM_SR_Permit_Activity_Report 'd381b807-db08-42df-b209-3930c37e9cb1'
--exec rpt_PM_SR_Permit_Activity_Report '9be846fc-54c5-4195-ad42-0fef042c49d4'

SELECT PMPERMIT.PERMITNUMBER, USERS.FNAME, USERS.LNAME, PMPERMITACTIVITY.PERMITACTIVITYNAME, PMPERMITACTIVITY.PERMITACTIVITYNUMBER, 
       PMPERMITACTIVITY.PERMITACTIVITYCOMMENTS, PMPERMITACTIVITY.CREATEDON, PMPERMITACTIVITYTYPE.NAME AS ACTIVITYTYPE, PMPERMITACTIVITY.PMPERMITACTIVITYID,
       CONVERT(Date,PMPERMITACTIVITY.CREATEDON, 101) AS CreatedDate,
		--(SELECT R.[IMAGE] FROM RPTIMAGELIB R
		--	WHERE R.IMAGENAME = 'Municipality_Logo') LOGO,
		(SELECT CASE WHEN R.[IMAGE] IS NULL THEN 'N' ELSE 'Y' END FROM RPTIMAGELIB R
			WHERE R.IMAGENAME = 'Municipality_Logo') SHOWLOGO,
		(SELECT R.REPORTTEXT FROM RPTTEXTLIB R
			WHERE R.TEXTNAME = 'Municipality_Name') Municipality_Name,	   
		(SELECT R.REPORTTEXT FROM RPTTEXTLIB R
			WHERE R.TEXTNAME = 'Municipality_Page_Footer') Municipality_Page_Footer
       
FROM PMPERMIT 
INNER JOIN PMPERMITACTIVITY ON PMPERMIT.PMPERMITID = PMPERMITACTIVITY.PMPERMITID 
INNER JOIN PMPERMITACTIVITYTYPE ON PMPERMITACTIVITY.PMPERMITACTIVITYTYPEID = PMPERMITACTIVITYTYPE.PMPERMITACTIVITYTYPEID 
INNER JOIN USERS ON PMPERMITACTIVITY.SUSERGUID = USERS.SUSERGUID
WHERE PMPERMIT.PMPERMITID = @PMPERMITID

END
