
CREATE PROCEDURE [dbo].[rpt_PL_SR_Planning_Activity_Report]
@ENDDATE AS DATETIME
AS


BEGIN

DECLARE @APPLICATIONDATE DATETIME = DATEADD(yy,-3,DATEADD(yy,DATEDIFF(yy,0,GETDATE()),0)) 
 
SELECT PL.APPLICATIONDATE, PLPLANTYPE.PLANNAME, PL.PLPLANID,
       (SELECT R.[IMAGE] FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') LOGO,
	   (SELECT CASE WHEN R.[IMAGE] IS NULL THEN 'N' ELSE 'Y' END FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') SHOWLOGO,
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Name') Municipality_Name,	   
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Page_Footer') Municipality_Page_Footer

FROM PLPLAN PL
INNER JOIN PLPLANTYPE ON PL.PLPLANTYPEID = PLPLANTYPE.PLPLANTYPEID
WHERE PL.APPLICATIONDATE >= @APPLICATIONDATE AND PL.APPLICATIONDATE < @ENDDATE

END

