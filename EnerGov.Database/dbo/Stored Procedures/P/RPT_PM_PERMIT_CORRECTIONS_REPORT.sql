

CREATE PROCEDURE [dbo].[RPT_PM_PERMIT_CORRECTIONS_REPORT]
@PMPERMITID AS VARCHAR(36)
AS
SELECT PMPERMIT.PMPERMITID, PMPERMIT.PERMITNUMBER, PMPERMIT.APPLYDATE, PMPERMIT.EXPIREDATE, PMPERMIT.DESCRIPTION, PMPERMIT.SQUAREFEET, PMPERMIT.VALUE, 
       PLITEMREVIEWTYPE.NAME AS REVIEWITEM, USERS.FNAME, USERS.LNAME, USERS.PHONE, USERS.EMAIL, USERS.TITLE, USERS."CREDENTIALS", 
       PLPLANCORRECTIONTYPE.NAME AS CORRECTIONTYPE, PLPLANCORRECTION.COMMENTS AS [CORRECTIVEACTIONS COMMENTS], 
       PLPLANCORRECTION.PLPLANCORRECTIONID, PLITEMREVIEWTYPE.DESCRIPTION AS ITEMREVIEWDESC,
	   PARCEL.PARCELNUMBER, PLITEMREVIEW.PLITEMREVIEWID,
	   MA.ADDRESSLINE1, MA.ADDRESSLINE2, MA.ADDRESSLINE3, MA.CITY, MA.STATE, MA.POSTALCODE, 
       MA.POSTDIRECTION, MA.PREDIRECTION, MA.STREETTYPE, MA.UNITORSUITE
FROM PMPERMIT 
INNER JOIN PLITEMREVIEW ON PMPERMIT.PMPERMITID = PLITEMREVIEW.PMPERMITID 
INNER JOIN PLITEMREVIEWTYPE ON PLITEMREVIEW.PLITEMREVIEWTYPEID = PLITEMREVIEWTYPE.PLITEMREVIEWTYPEID 
INNER JOIN PLPLANCORRECTION ON PLITEMREVIEW.PLITEMREVIEWID = PLPLANCORRECTION.PLITEMREVIEWID 
INNER JOIN PLPLANCORRECTIONTYPE ON PLPLANCORRECTION.PLPLANCORRECTIONTYPEID = PLPLANCORRECTIONTYPE.PLPLANCORRECTIONTYPEID 
INNER JOIN USERS ON PLITEMREVIEW.ASSIGNEDUSERID = USERS.SUSERGUID 
LEFT JOIN PMPERMITPARCEL ON PMPERMIT.PMPERMITID = PMPERMITPARCEL.PMPERMITID AND PMPERMITPARCEL.MAIN = 1
LEFT JOIN PARCEL ON PMPERMITPARCEL.PARCELID = PARCEL.PARCELID
LEFT JOIN (SELECT	PMPERMITADDRESS.PMPERMITID, MAILINGADDRESS.ADDRESSLINE1, MAILINGADDRESS.ADDRESSLINE2, MAILINGADDRESS.ADDRESSLINE3, 
					MAILINGADDRESS.CITY, MAILINGADDRESS.STATE, MAILINGADDRESS.POSTALCODE, 
					MAILINGADDRESS.POSTDIRECTION, MAILINGADDRESS.PREDIRECTION, MAILINGADDRESS.STREETTYPE, MAILINGADDRESS.UNITORSUITE
			FROM PMPERMITADDRESS 
			INNER JOIN MAILINGADDRESS ON PMPERMITADDRESS.MAILINGADDRESSID = MAILINGADDRESS.MAILINGADDRESSID
			WHERE PMPERMITADDRESS.PMPERMITID = @PMPERMITID 
			AND PMPERMITADDRESS.MAIN = 'TRUE') AS MA ON PMPERMIT.PMPERMITID = MA.PMPERMITID
WHERE PMPERMIT.PMPERMITID = @PMPERMITID
