

/****** Object:  StoredProcedure [dbo].[rpt_PM_SR_Permit_Detailed_Report_CONTACT]    Script Date: 02/25/2011 15:58:53 ******/
CREATE PROCEDURE [dbo].[rpt_PM_SR_Permit_Detailed_Report_Contact]
@PMPERMITID AS VARCHAR(36)
AS

SELECT PMPERMITCONTACT.GLOBALENTITYID, LANDMANAGEMENTCONTACTTYPE.NAME AS CONTACTTYPE, GE.GLOBALENTITYNAME, GE.FirStNAME, 
       GE.LaStNAME, MAILINGADDRESS.ADDRESSLINE1, MAILINGADDRESS.ADDRESSLINE2, MAILINGADDRESS.ADDRESSLINE3, MAILINGADDRESS.CITY, MAILINGADDRESS.STATE, 
       MAILINGADDRESS.POSTALCODE, MAILINGADDRESS.POSTDIRECTION, MAILINGADDRESS.PREDIRECTION, MAILINGADDRESS.STREETTYPE, MAILINGADDRESS.ADDRESSTYPE, 
       MAILINGADDRESS.UNITORSUITE, GE.BUSINESSPHONE, GE.HOMEPHONE, GE.MOBILEPHONE,
	   CASE WHEN GE.ISCONTACT = 1 
		THEN
			CASE WHEN GE.ISCOMPANY = 1
				THEN GE.GLOBALENTITYNAME + CHAR(13) + GE.FIRSTNAME + (
					CASE WHEN ISNULL(GE.MIDDLENAME,'') = '' 
						THEN '' 
						ELSE ' ' + LEFT(GE.MIDDLENAME,1)
					END) + ' ' + GE.LASTNAME 
				ELSE GE.FIRSTNAME + (
					CASE WHEN ISNULL(GE.MIDDLENAME,'') = '' 
						THEN '' 
						ELSE ' ' + LEFT(GE.MIDDLENAME,1)
					END) + ' ' + GE.LASTNAME 
			END
		ELSE GE.GLOBALENTITYNAME END CONTACTNAME

FROM PMPERMITCONTACT 
INNER JOIN LANDMANAGEMENTCONTACTTYPE ON PMPERMITCONTACT.LANDMANAGEMENTCONTACTTYPEID = LANDMANAGEMENTCONTACTTYPE.LANDMANAGEMENTCONTACTTYPEID 
INNER JOIN GLOBALENTITY GE ON PMPERMITCONTACT.GLOBALENTITYID = GE.GLOBALENTITYID 
LEFT OUTER JOIN GLOBALENTITYMAILINGADDRESS ON GLOBALENTITYMAILINGADDRESS.GLOBALENTITYID = GE.GLOBALENTITYID
LEFT OUTER JOIN MAILINGADDRESS ON MAILINGADDRESS.MAILINGADDRESSID = GLOBALENTITYMAILINGADDRESS.MAILINGADDRESSID 
WHERE PMPERMITCONTACT.PMPERMITID = @PMPERMITID

