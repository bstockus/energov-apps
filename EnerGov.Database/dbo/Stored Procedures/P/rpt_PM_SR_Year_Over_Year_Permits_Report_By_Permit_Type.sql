
-- EXEC [rpt_PM_Year_Over_Year_Permits_Report_By_Permit_Type] 2015


CREATE PROCEDURE [dbo].[rpt_PM_SR_Year_Over_Year_Permits_Report_By_Permit_Type]
@YEAR AS INT
AS
BEGIN
SELECT PMPERMIT.PERMITNUMBER AS PermitNumber, PMPERMITTYPE.NAME AS PermitType, PMPERMIT.VALUE AS Valuation, PMPERMIT.APPLYDATE AS ApplyDate, 
       PMPERMIT.ISSUEDATE AS IssueDate, PMPERMIT.SQUAREFEET AS SquareFeet, PMPERMIT.EXPIREDATE AS ExpireDate, PMPERMIT.FINALIZEDATE AS FinalDate,
	   --(SELECT R.[IMAGE] FROM RPTIMAGELIB R
	   -- WHERE R.IMAGENAME = 'Municipality_Logo') LOGO,
	   (SELECT CASE WHEN R.[IMAGE] IS NULL THEN 'N' ELSE 'Y' END FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') SHOWLOGO,
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Name') Municipality_Name,	   
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Page_Footer') Municipality_Page_Footer

--INTO #YOY
FROM PMPERMIT
INNER JOIN PMPERMITTYPE ON PMPERMIT.PMPERMITTYPEID = PMPERMITTYPE.PMPERMITTYPEID
WHERE DATEPART(YEAR,PMPERMIT.ISSUEDATE) BETWEEN	@YEAR-6 AND @YEAR OR
DATEPART(YEAR,PMPERMIT.APPLYDATE) BETWEEN	@YEAR-6 AND @YEAR OR
DATEPART(YEAR,PMPERMIT."EXPIREDATE") BETWEEN	@YEAR-6 AND @YEAR OR
DATEPART(YEAR,PMPERMIT.FINALIZEDATE) BETWEEN	@YEAR-6 AND @YEAR

--CREATE INDEX TEMP1 ON #YOY (PermitNumber);

--SELECT * FROM #YOY

END
