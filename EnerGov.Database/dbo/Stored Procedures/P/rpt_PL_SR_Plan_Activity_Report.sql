

CREATE PROCEDURE [dbo].[rpt_PL_SR_Plan_Activity_Report]
@PLPLANID AS VARCHAR(36)
AS

SELECT USERS.FNAME, USERS.LNAME, PLPLANACTIVITY.PLPLANACTIVITYID, PLPLANACTIVITY.PLANACTIVITYNAME, PLPLANACTIVITY.PLANACTIVITYNUMBER, 
       PLPLANACTIVITY.PLANACTIVITYCOMMENTS, PLPLANACTIVITY.CREATEDON, PLPLANACTIVITYTYPE.NAME AS ACTIVITYTYPE, PLPLAN.PLANNUMBER,
       CONVERT(DATE,PLPLANACTIVITY.CREATEDON) AS CreateDate,
	   (SELECT R.[IMAGE] FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') LOGO,
	   (SELECT CASE WHEN R.[IMAGE] IS NULL THEN 'N' ELSE 'Y' END FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') SHOWLOGO,
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Name') Municipality_Name,	   
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Page_Footer') Municipality_Page_Footer

FROM PLPLANACTIVITY 
INNER JOIN PLPLAN ON PLPLANACTIVITY.PLPLANID = PLPLAN.PLPLANID 
INNER JOIN PLPLANACTIVITYTYPE ON PLPLANACTIVITY.PLPLANACTIVITYTYPEID = PLPLANACTIVITYTYPE.PLPLANACTIVITYTYPEID 
INNER JOIN USERS ON PLPLANACTIVITY.SUSERGUID = USERS.SUSERGUID
WHERE (PLPLAN.PLPLANID = @PLPLANID)

