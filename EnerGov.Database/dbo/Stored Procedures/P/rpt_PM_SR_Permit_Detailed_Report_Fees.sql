

/****** Object:  StoredProcedure [dbo].[rpt_PM_SR_Permit_Detailed_Report_FEES]    Script Date: 02/25/2011 15:58:53 ******/
CREATE PROCEDURE [dbo].[rpt_PM_SR_Permit_Detailed_Report_Fees]
@PMPERMITID AS VARCHAR(36)
AS

SELECT CACOMPUTEDFEE.FEENAME, CACOMPUTEDFEE.COMPUTEDAMOUNT, ISNULL(CAINVOICE.INVOICENUMBER,'NOT INVOICED') AS INVOICENUMBER, CAINVOICE.INVOICEDATE, CAINVOICE.CAINVOICEID, 
       CACOMPUTEDFEE.CACOMPUTEDFEEID, --CASTATUS.NAME AS INVOICESTATUS, CASTATUS_1.NAME AS COMPUTEDFEESTATUS,  
       CACOMPUTEDFEE.AMOUNTPAIDTODATE AS PAIDAMOUNT

FROM PMPERMITFEE 
INNER JOIN CACOMPUTEDFEE ON PMPERMITFEE.CACOMPUTEDFEEID = CACOMPUTEDFEE.CACOMPUTEDFEEID 
	AND NOT CACOMPUTEDFEE.CASTATUSID in (5,10)
LEFT OUTER JOIN CAINVOICEFEE ON CACOMPUTEDFEE.CACOMPUTEDFEEID = CAINVOICEFEE.CACOMPUTEDFEEID 
LEFT OUTER JOIN CAINVOICE ON CAINVOICEFEE.CAINVOICEID = CAINVOICE.CAINVOICEID 
	AND CAINVOICE.CASTATUSID NOT IN (5,10)
WHERE PMPERMITFEE.PMPERMITID = @PMPERMITID

