
CREATE PROCEDURE rpt_PM_SR_Permit_Email_Details
	@PMPERMITID AS VARCHAR(36)
AS

BEGIN

SELECT P.PMPERMITID, P.PERMITNUMBER
	, E.ID, E.EMAILFROM, E.EMAILTO, E.CC, E.BCC, E.[SUBJECT], E.BODY, E.DATESENT,
	(SELECT R.[IMAGE] FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') LOGO,
	(SELECT CASE WHEN R.[IMAGE] IS NULL THEN 'N' ELSE 'Y' END FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') SHOWLOGO,
	(SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Name') Municipality_Name,	   
	(SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Page_Footer') Municipality_Page_Footer
FROM PMPERMIT P
left JOIN EMAILQUEUE E ON P.PMPERMITID = E.UNIQUERECORDID
WHERE P.PMPERMITID = @PMPERMITID

END
