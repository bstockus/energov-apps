




CREATE PROCEDURE [dbo].[RPT_PM_PERMITS_ISSUED_BY_STATUS]
@STARTDATE AS DATETIME,
@ENDDATE AS DATETIME
AS
SET @ENDDATE = DATEADD(S,-1,DATEADD(D,1,@ENDDATE))

-- PM Permits Issued by Status
SELECT PMPERMITSTATUS.NAME AS PermitStatus, PMPERMITTYPE.NAME AS PermitType, PMPERMITWORKCLASS.NAME AS PermitClass, 
       PMPERMIT.PERMITNUMBER, PMPERMIT.ISSUEDATE, PMPERMIT.VALUE, PMPERMIT.DESCRIPTION AS PermitDesc,
       PARCEL.PARCELNUMBER, TB_CONT.GLOBALENTITYNAME, TB_CONT.FIRSTNAME, TB_CONT.LASTNAME,
       TB_ADDR.ADDRESSLINE1, TB_ADDR.ADDRESSLINE2, TB_ADDR.ADDRESSLINE3, TB_ADDR.CITY, TB_ADDR.STATE, 
       TB_ADDR.POSTALCODE, TB_ADDR.POSTDIRECTION, TB_ADDR.PREDIRECTION, TB_ADDR.STREETTYPE, TB_ADDR.UNITORSUITE,
       PMPERMIT.PMPERMITID
FROM PMPERMIT
INNER JOIN PMPERMITSTATUS ON PMPERMIT.PMPERMITSTATUSID = PMPERMITSTATUS.PMPERMITSTATUSID
INNER JOIN PMPERMITTYPE ON PMPERMIT.PMPERMITTYPEID = PMPERMITTYPE.PMPERMITTYPEID
INNER JOIN PMPERMITWORKCLASS ON PMPERMIT.PMPERMITWORKCLASSID = PMPERMITWORKCLASS.PMPERMITWORKCLASSID
LEFT OUTER JOIN ( SELECT * FROM PMPERMITPARCEL WHERE PMPERMITPARCEL.MAIN = 1 ) AS PMPERMITPARCEL ON PMPERMIT.PMPERMITID = PMPERMITPARCEL.PMPERMITID
LEFT OUTER JOIN PARCEL ON PMPERMITPARCEL.PARCELID = PARCEL.PARCELID
LEFT OUTER JOIN ( SELECT PMPERMITADDRESS.PMPERMITID, MAILINGADDRESS.MAILINGADDRESSID, MAILINGADDRESS.ADDRESSTYPE, MAILINGADDRESS.PARCELNUMBER, 
                         MAILINGADDRESS.ADDRESSLINE1, MAILINGADDRESS.ADDRESSLINE2, MAILINGADDRESS.ADDRESSLINE3, MAILINGADDRESS.CITY, MAILINGADDRESS.STATE, 
                         MAILINGADDRESS.POSTALCODE, MAILINGADDRESS.POSTDIRECTION, MAILINGADDRESS.PREDIRECTION, MAILINGADDRESS.STREETTYPE, MAILINGADDRESS.UNITORSUITE
                  FROM PMPERMITADDRESS 
                  INNER JOIN MAILINGADDRESS ON PMPERMITADDRESS.MAILINGADDRESSID = MAILINGADDRESS.MAILINGADDRESSID
                  WHERE PMPERMITADDRESS.MAIN = 1
                ) AS TB_ADDR ON PMPERMIT.PMPERMITID = TB_ADDR.PMPERMITID
LEFT OUTER JOIN ( SELECT PMPERMITCONTACT.PMPERMITID, PMPERMITCONTACT.ISBILLING, LANDMANAGEMENTCONTACTTYPE.NAME AS ContactType, 
                         GLOBALENTITY.GLOBALENTITYID, GLOBALENTITY.GLOBALENTITYNAME, GLOBALENTITY.FIRSTNAME, GLOBALENTITY.LASTNAME,
                         GLOBALENTITY.BUSINESSPHONE, GLOBALENTITY.HOMEPHONE, GLOBALENTITY.MOBILEPHONE, GLOBALENTITY.EMAIL
                  FROM PMPERMITCONTACT
                  INNER JOIN LANDMANAGEMENTCONTACTTYPE ON PMPERMITCONTACT.LANDMANAGEMENTCONTACTTYPEID = LANDMANAGEMENTCONTACTTYPE.LANDMANAGEMENTCONTACTTYPEID
                  INNER JOIN GLOBALENTITY ON PMPERMITCONTACT.GLOBALENTITYID = GLOBALENTITY.GLOBALENTITYID 
                ) AS TB_CONT ON PMPERMIT.PMPERMITID = TB_CONT.PMPERMITID

WHERE PMPERMIT.ISSUEDATE BETWEEN @STARTDATE AND @ENDDATE


