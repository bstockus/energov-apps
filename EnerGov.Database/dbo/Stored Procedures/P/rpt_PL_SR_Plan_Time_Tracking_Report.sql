

CREATE PROCEDURE [dbo].[rpt_PL_SR_Plan_Time_Tracking_Report]
@PLPLANID AS VARCHAR(36)
AS
SELECT TIMETRACKINGTYPE.NAME AS TIMETRACKINGTYPE, TIMETRACKING.LOGDATE, TIMETRACKING.COMMENTS, TIMETRACKING.STARTTIME, TIMETRACKING.ENDTIME, 
       TIMETRACKING.HOURS, TIMETRACKING.MINUTES, TIMETRACKING.TOTALTIME, TIMETRACKING.BILLABLEAMOUNT, USERS.FNAME, USERS.LNAME, USERS.ID, 
       TIMETRACKING.TIMETRACKINGID, TIMETRACKING.BILLED, PLPLAN.PLANNUMBER AS PLANNUMBER, CONVERT(DATE,TIMETRACKING.LOGDATE) AS LogDateDate,
	   	(SELECT R.[IMAGE] FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') LOGO,
	   (SELECT CASE WHEN R.[IMAGE] IS NULL THEN 'N' ELSE 'Y' END FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') SHOWLOGO,
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Name') Municipality_Name,	   
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Page_Footer') Municipality_Page_Footer

FROM TIMETRACKINGTYPE 
INNER JOIN TIMETRACKING ON TIMETRACKINGTYPE.TIMETRACKINGTYPEID = TIMETRACKING.TIMETRACKINGTYPEID 
INNER JOIN USERS ON TIMETRACKING.LogUSERID = USERS.SUSERGUID 
INNER JOIN PLPLAN ON TIMETRACKING.PrimaryRecordID = PLPLAN.PLPLANID
WHERE PLPLAN.PLPLANID = @PLPLANID

