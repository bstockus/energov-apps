

CREATE PROCEDURE [dbo].[rpt_PL_SR_Plan_Cases_Listing_By_User]
@STARTDATE DATETIME,
@ENDDATE DATETIME,
@FILTER VARCHAR(150)

AS

BEGIN

SELECT PLPlan.PLPLANID, PLPlanStatus.NAME, PLPlanType.PLANNAME, Users.ID, PLPlan.APPLICATIONDATE,
--	   (SELECT R.[IMAGE] FROM RPTIMAGELIB R
--		WHERE R.IMAGENAME = 'Municipality_Logo') LOGO,
	   (SELECT CASE WHEN R.[IMAGE] IS NULL THEN 'N' ELSE 'Y' END FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') SHOWLOGO,
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Name') Municipality_Name,	   
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Page_Footer') Municipality_Page_Footer

 FROM PLPLAN
 INNER JOIN PLPLANTYPE ON PLPLAN.PLPLANTYPEID = PLPLANTYPE.PLPLANTYPEID
 INNER JOIN PLPLANSTATUS ON PLPLAN.PLPLANSTATUSID = PLPLANSTATUS.PLPLANSTATUSID
 INNER JOIN USERS ON PLPLAN.ASSIGNEDTO = USERS.SUSERGUID

WHERE (CASE @FILTER 
	WHEN 'EXPIRE DATE' THEN PLPLAN.EXPIREDATE
	WHEN 'APPLY DATE' THEN PLPLAN.APPLICATIONDATE
	WHEN 'COMPLETE DATE' THEN PLPLAN.COMPLETEDATE END)
	BETWEEN @STARTDATE AND @ENDDATE


END

