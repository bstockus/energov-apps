CREATE PROCEDURE [dbo].[USP_RPTREPORT_UPDATE]
(
	@RPTREPORTID CHAR(36),
	@RPTFRMTOBUSOBJMAPID CHAR(36),
	@REPORTNAME NVARCHAR(255),
	@FRIENDLYNAME NVARCHAR(255),
	@SYSTEMREPORT BIT,
	@PROMPTINPUT BIT,
	@IDENOBJPROPFRIENDLYNAME NVARCHAR(255),
	@IDENTIFYOBJECTPROPERTYTOKEN NVARCHAR(255),
	@IDENTIFYOBJECTPROPERTYNAME NVARCHAR(255),
	@IDENTIFYOBJECTPROPERTYVALUE NVARCHAR(255),
	@REPORTPREVIEWIMAGE VARBINARY(MAX),
	@MOBILEGOVREPORT BIT,
	@ISSUBFOLDER BIT,
	@RPTREPORTTYPEID INT,
	@REPORTVIRTUALPATH NVARCHAR(255),
	@LASTCHANGEDBY CHAR(36),
	@LASTCHANGEDON DATE,
	@ROWVERSION INT,
	@IMAGEUPDATED BIT = 0
)
AS
DECLARE @OUTPUTTABLE as TABLE([ROWVERSION]  int)
UPDATE [dbo].[RPTREPORT] SET
	[RPTFRMTOBUSOBJMAPID] = @RPTFRMTOBUSOBJMAPID,
	[REPORTNAME] = @REPORTNAME,
	[FRIENDLYNAME] = @FRIENDLYNAME,
	[SYSTEMREPORT] = @SYSTEMREPORT,
	[PROMPTINPUT] = @PROMPTINPUT,
	[IDENOBJPROPFRIENDLYNAME] = @IDENOBJPROPFRIENDLYNAME,
	[IDENTIFYOBJECTPROPERTYTOKEN] = @IDENTIFYOBJECTPROPERTYTOKEN,
	[IDENTIFYOBJECTPROPERTYNAME] = @IDENTIFYOBJECTPROPERTYNAME,
	[IDENTIFYOBJECTPROPERTYVALUE] = @IDENTIFYOBJECTPROPERTYVALUE,
	[REPORTPREVIEWIMAGE] = CASE WHEN @IMAGEUPDATED= 1 THEN  @REPORTPREVIEWIMAGE 
							    ELSE  [REPORTPREVIEWIMAGE] END ,
	[MOBILEGOVREPORT] = @MOBILEGOVREPORT,
	[ISSUBFOLDER] = @ISSUBFOLDER,
	[RPTREPORTTYPEID] = @RPTREPORTTYPEID,
	[REPORTVIRTUALPATH] = @REPORTVIRTUALPATH,
	[LASTCHANGEDBY] = @LASTCHANGEDBY,
	[LASTCHANGEDON] = @LASTCHANGEDON,
	[ROWVERSION] = @ROWVERSION +1 
OUTPUT inserted.[ROWVERSION] INTO @OUTPUTTABLE
WHERE
	[RPTREPORTID] = @RPTREPORTID AND 
	[ROWVERSION]= @ROWVERSION

SELECT * FROM @OUTPUTTABLE