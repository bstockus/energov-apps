CREATE PROCEDURE [dbo].[USP_RPTIMAGELIB_UPDATE]
(
	@RPTIMAGELIBID CHAR(36),
	@IMAGENAME NVARCHAR(50),
	@FILENAME NVARCHAR(150),
	@PRIORFILENAME NVARCHAR(150),
	@DIMENSIONS NVARCHAR(50),
	@IMAGE VARBINARY(MAX),
	@LASTCHANGEDBY CHAR(36),
	@LASTCHANGEDON DATETIME,
	@ROWVERSION INT
)
AS
DECLARE @OUTPUTTABLE as TABLE([ROWVERSION]  int)
UPDATE [dbo].[RPTIMAGELIB] SET
	[IMAGENAME] = @IMAGENAME,
	[FILENAME] = @FILENAME,
	[PRIORFILENAME] = @PRIORFILENAME,
	[DIMENSIONS] = @DIMENSIONS,
	[IMAGE] = @IMAGE,
	[LASTCHANGEDBY] = @LASTCHANGEDBY,
	[LASTCHANGEDON] = @LASTCHANGEDON,
	[ROWVERSION] = @ROWVERSION + 1
OUTPUT inserted.[ROWVERSION] INTO @OUTPUTTABLE
WHERE
	[RPTIMAGELIBID] = @RPTIMAGELIBID AND 
	[ROWVERSION]= @ROWVERSION

SELECT * FROM @OUTPUTTABLE