CREATE PROCEDURE [dbo].[USP_LOGCASETYPENUMBERINGHISTORY]
@ID							CHAR(36),
@ROWVERSION					INT,
@CHANGEDBY					CHAR(36),
@ADDITIONALINFO				NVARCHAR(MAX),
@OLDFORMATSTRING			NVARCHAR(50)	=	'',
@NEWFORMATSTRING			NVARCHAR(50)	=	'',
@OLDPADWITHZEROSTOLENGTH	INT,
@NEWPADWITHZEROSTOLENGTH	INT,
@OLDUSERESET				BIT				=	0,
@NEWUSERESET				BIT				=	0,
@ISUPDATE					BIT				=	0,
@ISFROMAUTONUMBERSETUP		BIT				=	0,
@FORMID						CHAR(36),
@ACTION						INT,
@ISROOT						BIT				=   0,
@RECORDNAME					NVARCHAR(MAX)

AS
BEGIN	
	SET NOCOUNT ON;
	IF (@ISUPDATE = 1)
		BEGIN
		INSERT INTO [HISTORYSYSTEMSETUP]
		(	[ID],
			[ROWVERSION],
			[CHANGEDON],
			[CHANGEDBY],
			[FIELDNAME],
			[OLDVALUE],
			[NEWVALUE],
			[ADDITIONALINFO],
			[FORMID],
			[ACTION],
			[ISROOT],
			[RECORDNAME]
		)
	
		SELECT 
				@ID,
				@ROWVERSION,
				GETUTCDATE(),
				@CHANGEDBY,
				CASE @ISFROMAUTONUMBERSETUP WHEN 1 THEN 'AutoNumber Reset Format String' ELSE 'Case Type Numbering Schema' END,
				CASE WHEN @OLDFORMATSTRING = '' THEN '[none]' ELSE @OLDFORMATSTRING END,
				@NEWFORMATSTRING,
				@ADDITIONALINFO,
				@FORMID,
				@ACTION,
				@ISROOT,
				@RECORDNAME
		WHERE	@NEWFORMATSTRING != @OLDFORMATSTRING
		
		UNION ALL
		SELECT 
				@ID,
				@ROWVERSION,
				GETUTCDATE(),
				@CHANGEDBY,
				CASE @ISFROMAUTONUMBERSETUP WHEN 1 THEN 'AutoNumber Reset Pad With Zeros Length' ELSE 'Case Number Pad to Digits' END,
				CASE WHEN @OLDPADWITHZEROSTOLENGTH = 0 THEN '[none]' ELSE CONVERT(NVARCHAR (MAX),@OLDPADWITHZEROSTOLENGTH) END,				
				CONVERT(NVARCHAR (MAX), @NEWPADWITHZEROSTOLENGTH),
				@ADDITIONALINFO,
				@FORMID,
				@ACTION,
				@ISROOT,
				@RECORDNAME
		WHERE @NEWPADWITHZEROSTOLENGTH != @OLDPADWITHZEROSTOLENGTH

		UNION ALL
		SELECT 
				@ID,
				@ROWVERSION,
				GETUTCDATE(),
				@CHANGEDBY,
				'AutoNumber Reset Auto Reset',
				CASE WHEN @OLDUSERESET = 1 THEN 'Yes' ELSE 'No' END,
				CASE WHEN @NEWUSERESET = 1 THEN 'Yes' ELSE 'No' END,
				@ADDITIONALINFO,
				@FORMID,
				@ACTION,
				@ISROOT,
				@RECORDNAME
		WHERE @NEWUSERESET != @OLDUSERESET
		END
	ELSE 
	BEGIN
		INSERT INTO [HISTORYSYSTEMSETUP]
		(	[ID],
			[ROWVERSION],
			[CHANGEDON],
			[CHANGEDBY],
			[FIELDNAME],
			[OLDVALUE],
			[NEWVALUE],
			[ADDITIONALINFO],
			[FORMID],
			[ACTION],
			[ISROOT],
			[RECORDNAME]
		) SELECT
			@ID,
			@ROWVERSION,
			GETUTCDATE(),
			@CHANGEDBY,
			'Case Type Numbering Added',
			'',
			'',
			@ADDITIONALINFO,
			@FORMID,
			@ACTION,
			@ISROOT,
			@RECORDNAME
		END
END