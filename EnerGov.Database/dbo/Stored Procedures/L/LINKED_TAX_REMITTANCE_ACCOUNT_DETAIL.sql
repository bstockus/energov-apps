CREATE PROCEDURE [dbo].[LINKED_TAX_REMITTANCE_ACCOUNT_DETAIL]
	@ENTITY_ID AS CHAR(36),
	@MODULE_TYPE as char(36),
	@FROM INT = 1,
	@TO INT,
	@PAGE_SIZE INT = 20,
	@SORT_FIELD VARCHAR(36),
	@IS_ASC BIT = 1,
	@USER_ID AS CHAR(36)
AS
declare @DATA TABLE 
(
	TXREMITTANCEACCOUNTID char(36)
)	IF (@MODULE_TYPE = 'ContactManagement')
	BEGIN
		INSERT INTO @DATA
		SELECT * FROM DBO.LINKEDTAXREMITTANCEFROMCONTACT(@ENTITY_ID, @USER_ID)
	END
	IF (@MODULE_TYPE = 'BusinessLicenseEntity')
	BEGIN
		INSERT INTO @DATA
		SELECT * FROM DBO.LINKEDTAXREMITTANCEFROMBUSINESS(@ENTITY_ID, @USER_ID)
	END
BEGIN
WITH 
ALLTAXDETAILS AS (
SELECT tax.TXREMITTANCEACCOUNTID ,tax.REMITTANCEACCOUNTNUMBER as ACCOUNTNUMBER, taxType.NAME as TAXTYPE, taxStatus.NAME as STATUS, tax.OPENDATE
 FROM TXREMITTANCEACCOUNT tax INNER JOIN 
 TXREMITTANCETYPE taxType on tax.TXREMITTANCETYPEID = taxType.TXREMITTANCETYPEID INNER JOIN
 TXREMITSTATUS taxStatus on tax.TXREMITTANCESTATUSID = taxStatus.TXREMITSTATUSID
 WHERE tax.TXREMITTANCEACCOUNTID in (select TXREMITTANCEACCOUNTID from @DATA)),
 NUMBEREDDATA AS
 (SELECT TXREMITTANCEACCOUNTID, ACCOUNTNUMBER, TAXTYPE, STATUS, OPENDATE,
 ROW_NUMBER() OVER(ORDER BY
 case when @is_asc = 1 AND @Sort_Field = 'ACCOUNTNUMBER' then ACCOUNTNUMBER END ASC,
 case when @is_asc = 0 AND @Sort_Field = 'ACCOUNTNUMBER' then ACCOUNTNUMBER END DESC,
 case when @is_asc = 1 AND @Sort_Field = 'TAXTYPE' then TAXTYPE END ASC, 
 case when @is_asc = 0 AND @Sort_Field = 'TAXTYPE' then TAXTYPE END DESC,
 case when @is_asc = 1 AND @Sort_Field = 'STATUS' then STATUS END ASC, 
 case when @is_asc = 0 AND @Sort_Field = 'STATUS' then STATUS END DESC,
 case when @is_asc = 1 AND @Sort_Field = 'OPENDATE' then OPENDATE END ASC, 
 case when @is_asc = 0 AND @Sort_Field = 'OPENDATE' then OPENDATE END DESC)
 AS ROWNUMBER, COUNT(1) OVER() AS TOTAL_ROWS from ALLTAXDETAILS)
 select * from NUMBEREDDATA WHERE ROWNUMBER > @From AND ROWNUMBER <= @To
 END


 select * from TXREMITTANCEACCOUNT