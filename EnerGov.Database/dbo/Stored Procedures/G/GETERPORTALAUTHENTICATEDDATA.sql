
CREATE PROCEDURE [dbo].[GETERPORTALAUTHENTICATEDDATA]
-- Add the parameters for the stored procedure here
@Email nvarchar(80),
@Password nvarchar(100),
@UserGuid char(36)
AS
BEGIN
	SELECT	USERS.SUSERGUID,
			USERS.FNAME,
			USERS.LNAME,
			USERS.GLOBALENTITYID,
			APPLICATIONALLOWED.APPROVED
	FROM	USERS		
	INNER JOIN APPLICATIONALLOWED ON APPLICATIONALLOWED.USERID = USERS.SUSERGUID
	WHERE APPLICATIONALLOWED.APPLICATIONID = 2 AND ((USERS.PASSWORD = @Password AND USERS.EMAIL = @Email) OR USERS.SUSERGUID = @UserGuid)		
END
