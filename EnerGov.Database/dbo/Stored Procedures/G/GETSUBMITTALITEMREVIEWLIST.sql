CREATE PROCEDURE [dbo].[GETSUBMITTALITEMREVIEWLIST]
-- Add the parameters for the stored procedure here
@SubmittalID char(36),
@ModuleID int	
AS
BEGIN	
	IF @ModuleID = 1
	BEGIN
	SELECT	DISTINCT PLITEMREVIEW.PLITEMREVIEWID,  
			PLITEMREVIEW.PLPLANID AS CASEID,
			PLITEMREVIEW.PLSUBMITTALID,
			PLITEMREVIEWTYPE.NAME AS ITEMREVIEWTYPENAME,
			PLSUBMITTALTYPE.TYPENAME AS SUBMITTALTYPENAME,
			PLITEMREVIEWSTATUS.NAME AS STATUSNAME,
			PLITEMREVIEW.ASSIGNEDUSERID,
			USERS.FNAME AS ASSIGNEDUSERFIRSTNAME,
			USERS.LNAME AS ASSIGNEDUSERLASTNAME,
			PLITEMREVIEW.COMPLETEDATE,
			1 AS MODULEID,
			'Plan' AS MODULENAME				
	FROM PLITEMREVIEW	
	INNER JOIN PLITEMREVIEWTYPE ON PLITEMREVIEWTYPE.PLITEMREVIEWTYPEID = PLITEMREVIEW.PLITEMREVIEWTYPEID
	INNER JOIN PLITEMREVIEWSTATUS ON PLITEMREVIEWSTATUS.PLITEMREVIEWSTATUSID = PLITEMREVIEW.PLITEMREVIEWSTATUSID		
	INNER JOIN PLSUBMITTAL ON PLITEMREVIEW.PLSUBMITTALID = PLSUBMITTAL.PLSUBMITTALID
	INNER JOIN PLSUBMITTALTYPE ON PLSUBMITTALTYPE.PLSUBMITTALTYPEID = PLSUBMITTAL.PLSUBMITTALTYPEID		
	INNER JOIN USERS ON USERS.SUSERGUID = PLITEMREVIEW.ASSIGNEDUSERID				
	WHERE (PLSUBMITTAL.PLSUBMITTALID = @SubmittalID)
	ORDER BY PLITEMREVIEW.COMPLETEDATE ASC			       
	END
	ELSE IF @ModuleID = 2
	BEGIN
	SELECT	DISTINCT PLITEMREVIEW.PLITEMREVIEWID,  
			PLITEMREVIEW.PMPERMITID AS CASEID,
			PLITEMREVIEW.PLSUBMITTALID,
			PLITEMREVIEWTYPE.NAME AS ITEMREVIEWTYPENAME,
			PLSUBMITTALTYPE.TYPENAME AS SUBMITTALTYPENAME,
			PLITEMREVIEWSTATUS.NAME AS STATUSNAME,
			PLITEMREVIEW.ASSIGNEDUSERID,
			USERS.FNAME AS ASSIGNEDUSERFIRSTNAME,
			USERS.LNAME AS ASSIGNEDUSERLASTNAME,
			PLITEMREVIEW.COMPLETEDATE,
			2 AS MODULEID,
			'Permit' AS MODULENAME				
	FROM PLITEMREVIEW	
	INNER JOIN PLITEMREVIEWTYPE ON PLITEMREVIEWTYPE.PLITEMREVIEWTYPEID = PLITEMREVIEW.PLITEMREVIEWTYPEID
	INNER JOIN PLITEMREVIEWSTATUS ON PLITEMREVIEWSTATUS.PLITEMREVIEWSTATUSID = PLITEMREVIEW.PLITEMREVIEWSTATUSID		
	INNER JOIN PLSUBMITTAL ON PLITEMREVIEW.PLSUBMITTALID = PLSUBMITTAL.PLSUBMITTALID
	INNER JOIN PLSUBMITTALTYPE ON PLSUBMITTALTYPE.PLSUBMITTALTYPEID = PLSUBMITTAL.PLSUBMITTALTYPEID		
	INNER JOIN USERS ON USERS.SUSERGUID = PLITEMREVIEW.ASSIGNEDUSERID				
	WHERE (PLSUBMITTAL.PLSUBMITTALID = @SubmittalID)
	ORDER BY PLITEMREVIEW.COMPLETEDATE ASC	
	END
END