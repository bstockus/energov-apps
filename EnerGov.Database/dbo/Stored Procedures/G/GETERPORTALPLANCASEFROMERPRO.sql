
CREATE PROCEDURE [dbo].[GETERPORTALPLANCASEFROMERPRO]
-- Add the parameters for the stored procedure here
@ERPROJECTID char(36)	
AS
BEGIN		
	SELECT	DISTINCT PLPLAN.PLPLANID,
			PLPLAN.PLANNUMBER,				
			PLPLANSTATUS.NAME AS PLANSTATUSNAME,				
			PLPLAN.APPLICATIONDATE,
			PLPLAN.COMPLETEDATE,
			PLPLAN.EXPIREDATE,
			PRPROJECT.NAME AS PROJECTNAME,
			PLPLANTYPE.PLANNAME AS PLANTYPENAME,
			PLPLANWORKCLASS.NAME AS WORKCLASSNAME			
	FROM PLPLAN			
	INNER JOIN ERPROJECT ON ERPROJECT.PLPLANID = PLPLAN.PLPLANID
	INNER JOIN PLPLANSTATUS ON PLPLANSTATUS.PLPLANSTATUSID = PLPLAN.PLPLANSTATUSID		
	INNER JOIN PLPLANTYPE ON PLPLANTYPE.PLPLANTYPEID = PLPLAN.PLPLANTYPEID
	LEFT OUTER JOIN PLPLANWORKCLASS ON PLPLANWORKCLASS.PLPLANWORKCLASSID = PLPLAN.PLPLANWORKCLASSID
	OUTER APPLY (SELECT TOP 1 PRPROJECTID FROM PRPROJECTPLAN WHERE PRPROJECTPLAN.PLPLANID = PLPLAN.PLPLANID) A
	LEFT OUTER JOIN PRPROJECT ON PRPROJECT.PRPROJECTID = A.PRPROJECTID	
	WHERE ERPROJECT.ERPROJECTID = @ERPROJECTID
END	
