
CREATE PROCEDURE [dbo].[GETERPORTALSEARCHPLANLIST]
-- Add the parameters for the stored procedure here
@PlanNumber nvarchar(50),
@ProjectName nvarchar(50),
@ProjectNumber nvarchar(50),
@PlanStatusID char(36),
@CreateFromDate datetime,
@CreateToDate datetime,
@GlobalEntityID char(36)	
AS
BEGIN
		
	SELECT	DISTINCT PLPLAN.PLPLANID,
			PLPLAN.PLANNUMBER,				
			PLPLANSTATUS.NAME AS PLANSTATUSNAME,				
			PLPLAN.APPLICATIONDATE,
			PLPLAN.COMPLETEDATE,
			PLPLAN.EXPIREDATE,
			PRPROJECT.NAME AS PROJECTNAME,
			PRPROJECT.PROJECTNUMBER AS PROJECTNUMBER											
	FROM PLPLAN		
	INNER JOIN PLPLANSTATUS ON PLPLANSTATUS.PLPLANSTATUSID = PLPLAN.PLPLANSTATUSID
	INNER JOIN PLPLANCONTACT ON PLPLANCONTACT.PLPLANID = PLPLAN.PLPLANID
	LEFT OUTER JOIN PRPROJECTPLAN ON PRPROJECTPLAN.PLPLANID = PLPLAN.PLPLANID
	LEFT OUTER JOIN PRPROJECT ON PRPROJECT.PRPROJECTID = PRPROJECTPLAN.PRPROJECTID			
	WHERE PLPLANCONTACT.GLOBALENTITYID = @GlobalEntityID AND 
		(@PlanNumber IS NULL OR @PlanNumber = '' OR PLPLAN.PLANNUMBER LIKE '%' + @PlanNumber + '%') AND
		(@ProjectName IS NULL OR @ProjectName = '' OR PRPROJECT.NAME LIKE '%' + @ProjectName + '%') AND
		(@ProjectNumber IS NULL OR @ProjectNumber = '' OR PRPROJECT.PROJECTNUMBER LIKE '%' + @ProjectNumber + '%') AND
		(@CreateFromDate IS NULL OR PLPLAN.APPLICATIONDATE = @CreateFromDate OR PLPLAN.APPLICATIONDATE > @CreateFromDate) AND
		(@CreateToDate IS NULL OR PLPLAN.APPLICATIONDATE = @CreateFromDate OR PLPLAN.APPLICATIONDATE < @CreateToDate) AND
		(@PlanStatusID IS NULL OR @PlanStatusID = '' OR PLPLAN.PLPLANSTATUSID = @PlanStatusID)			
END	
