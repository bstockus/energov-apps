
CREATE PROCEDURE [dbo].[GETPLAN]
-- Add the parameters for the stored procedure here
@PLPLanID char(36)	
AS
BEGIN	
	SELECT	DISTINCT PLPLAN.PLPLANID,
			PLPLAN.PLANNUMBER,
			PLPLANTYPE.PLANNAME AS PLANTYPENAME,
			PLPLANWORKCLASS.NAME AS PLANWORKCLASSNAME,
			PLPLANSTATUS.NAME AS PLANSTATUSNAME,
			PLPLAN.DESCRIPTION AS PLANDESCRIPTION,
			PRPROJECT.NAME AS PROJECTNAME,
			PRPROJECT.PRPROJECTID AS PRPROJECTID,
			DISTRICT.NAME AS DISTRICTNAME,
			PLPLAN.ASSIGNEDTO,
			ASSIGNEDUSER.FNAME,
			ASSIGNEDUSER.LNAME,
			PLPLAN.APPLICATIONDATE,
			PLPLAN.COMPLETEDATE,
			PLPLAN.EXPIREDATE,
			PLPLAN.APPROVALEXPIREDATE,
			PLPLAN.SQUAREFEET,
			PLPLAN.VALUE
	FROM PLPLAN	
	LEFT OUTER JOIN USERS AS ASSIGNEDUSER ON ASSIGNEDUSER.SUSERGUID = PLPLAN.ASSIGNEDTO
	INNER JOIN PLPLANTYPE ON PLPLANTYPE.PLPLANTYPEID = PLPLAN.PLPLANTYPEID
	LEFT OUTER JOIN PLPLANWORKCLASS ON PLPLANWORKCLASS.PLPLANWORKCLASSID = PLPLAN.PLPLANWORKCLASSID
	INNER JOIN PLPLANSTATUS ON PLPLANSTATUS.PLPLANSTATUSID = PLPLAN.PLPLANSTATUSID
	OUTER APPLY (SELECT TOP 1 PRPROJECTID FROM PRPROJECTPLAN WHERE PRPROJECTPLAN.PLPLANID = PLPLAN.PLPLANID) A
	LEFT OUTER JOIN PRPROJECT ON PRPROJECT.PRPROJECTID = A.PRPROJECTID
	INNER JOIN DISTRICT ON DISTRICT.DISTRICTID = PLPLAN.DISTRICTID	
	WHERE (PLPLAN.PLPLANID = @PLPLanID)	       
END
