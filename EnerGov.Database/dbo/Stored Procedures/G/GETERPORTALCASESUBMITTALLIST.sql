CREATE PROCEDURE [dbo].[GETERPORTALCASESUBMITTALLIST]
-- Add the parameters for the stored procedure here
@CaseID char(36),
@ModuleID int
AS
BEGIN	
	IF @ModuleID = 1
	BEGIN
	SELECT	DISTINCT PLSUBMITTAL.PLSUBMITTALID, 
			PLSUBMITTAL.PLPLANID AS CASEID, 
			PLPLANWFACTIONSTEP.NAME AS SUBMITTALNAME,
			PLPLANWFACTIONSTEP.VERSIONNUMBER AS SUBMITTALVERSION,
			PLPLANWFACTIONSTEP.WORKFLOWSTATUSID,
			1 AS MODULEID,
			'Plan' AS MODULENAME				
	FROM PLSUBMITTAL					
	INNER JOIN PLPLANWFACTIONSTEP ON PLPLANWFACTIONSTEP.PLPLANWFACTIONSTEPID = PLSUBMITTAL.PLPLANWFACTIONSTEPID
	WHERE (PLSUBMITTAL.PLPLANID = @CaseID)	
	ORDER BY PLPLANWFACTIONSTEP.NAME ASC, PLPLANWFACTIONSTEP.VERSIONNUMBER ASC		       
	END
	ELSE IF @ModuleID = 2
	BEGIN
	SELECT	DISTINCT PLSUBMITTAL.PLSUBMITTALID, 
			PLSUBMITTAL.PMPERMITID AS CASEID, 
			PMPERMITWFACTIONSTEP.NAME AS SUBMITTALNAME,
			PMPERMITWFACTIONSTEP.VERSIONNUMBER AS SUBMITTALVERSION,
			PMPERMITWFACTIONSTEP.WORKFLOWSTATUSID,
			2 AS MODULEID,
			'Permit' AS MODULENAME				
	FROM PLSUBMITTAL					
	INNER JOIN PMPERMITWFACTIONSTEP ON PMPERMITWFACTIONSTEP.PMPERMITWFACTIONSTEPID = PLSUBMITTAL.PMPERMITWFACTIONSTEPID
	WHERE (PLSUBMITTAL.PMPERMITID = @CaseID)	
	ORDER BY PMPERMITWFACTIONSTEP.NAME ASC, PMPERMITWFACTIONSTEP.VERSIONNUMBER ASC		       
	END
END