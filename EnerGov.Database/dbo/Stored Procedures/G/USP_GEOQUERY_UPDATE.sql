CREATE PROCEDURE [dbo].[USP_GEOQUERY_UPDATE]
(
	@GEOQUERYID CHAR(36),
	@QUERYNAME NVARCHAR(150),
	@FEATURECLASSNAME NVARCHAR(150),
	@FEATURECLASSID INT,
	@FIELDNAME NVARCHAR(150),
	@RETURNTYPE NVARCHAR(50),
	@RETURNEDFEATURECLASS NVARCHAR(150),
	@RETURNEDFEATURECLASSID INT,
	@GEOQUERYTYPEID CHAR(36),
	@RETURNFIELDNAME NVARCHAR(150),
	@RETURNFIELDTYPE NVARCHAR(50),
	@DISTANCE FLOAT(53),
	@GEOQUERYUNITTYPEID CHAR(36),
	@USEBUFFERRING BIT,
	@BUFFERFEATURECLASS NVARCHAR(150),
	@BUFFERFEATURECLASSID INT,
	@BUFFERGEOQUERYTYPEID CHAR(36),
	@APPLYSHAPEBUFFERING BIT,
	@LASTCHANGEDBY CHAR(36),
	@LASTCHANGEDON DATETIME,
	@ROWVERSION INT
)
AS
DECLARE @OUTPUTTABLE as TABLE([ROWVERSION]  int)
UPDATE [dbo].[GEOQUERY] SET
	[QUERYNAME] = @QUERYNAME,
	[FEATURECLASSNAME] = @FEATURECLASSNAME,
	[FEATURECLASSID] = @FEATURECLASSID,
	[FIELDNAME] = @FIELDNAME,
	[RETURNTYPE] = @RETURNTYPE,
	[RETURNEDFEATURECLASS] = @RETURNEDFEATURECLASS,
	[RETURNEDFEATURECLASSID] = @RETURNEDFEATURECLASSID,
	[GEOQUERYTYPEID] = @GEOQUERYTYPEID,
	[RETURNFIELDNAME] = @RETURNFIELDNAME,
	[RETURNFIELDTYPE] = @RETURNFIELDTYPE,
	[DISTANCE] = @DISTANCE,
	[GEOQUERYUNITTYPEID] = @GEOQUERYUNITTYPEID,
	[USEBUFFERRING] = @USEBUFFERRING,
	[BUFFERFEATURECLASS] = @BUFFERFEATURECLASS,
	[BUFFERFEATURECLASSID] = @BUFFERFEATURECLASSID,
	[BUFFERGEOQUERYTYPEID] = @BUFFERGEOQUERYTYPEID,
	[APPLYSHAPEBUFFERING] = @APPLYSHAPEBUFFERING,
	[LASTCHANGEDBY] = @LASTCHANGEDBY,
	[LASTCHANGEDON] = @LASTCHANGEDON,
	[ROWVERSION] = @ROWVERSION + 1
OUTPUT inserted.[ROWVERSION] INTO @OUTPUTTABLE
WHERE
	[GEOQUERYID] = @GEOQUERYID AND 
	[ROWVERSION]= @ROWVERSION

SELECT * FROM @OUTPUTTABLE