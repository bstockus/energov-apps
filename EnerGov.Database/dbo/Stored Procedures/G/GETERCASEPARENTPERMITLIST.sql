CREATE PROCEDURE [dbo].[GETERCASEPARENTPERMITLIST]
-- Add the parameters for the stored procedure here
@CaseID char(36),
@ModuleID int	
AS
BEGIN	
	IF @ModuleID = 1
	BEGIN
		SELECT	DISTINCT PMPERMIT.PMPERMITID,
				PMPERMIT.PERMITNUMBER,
				PMPERMITTYPE.NAME AS PERMITTYPENAME,
				PMPERMITWORKCLASS.NAME AS PERMITWORKCLASSNAME
		FROM PMPERMIT
		INNER JOIN PMPERMITTYPE ON PMPERMITTYPE.PMPERMITTYPEID = PMPERMIT.PMPERMITTYPEID
		LEFT OUTER JOIN PMPERMITWORKCLASS ON PMPERMITWORKCLASS.PMPERMITWORKCLASSID = PMPERMIT.PMPERMITWORKCLASSID
		INNER JOIN PMPERMITWFSTEP ON PMPERMITWFSTEP.PMPERMITID = PMPERMIT.PMPERMITID
		INNER JOIN PMPERMITWFACTIONSTEP ON PMPERMITWFACTIONSTEP.PMPERMITWFSTEPID = PMPERMITWFSTEP.PMPERMITWFSTEPID
		INNER JOIN PLPLANACTIONREF ON PLPLANACTIONREF.OBJECTID = PMPERMITWFACTIONSTEP.PMPERMITWFACTIONSTEPID
		WHERE PLPLANACTIONREF.PLPLANID = @CaseID
	END
	ELSE IF @ModuleID = 2
	BEGIN
		SELECT	DISTINCT PMPERMIT.PMPERMITID,
				PMPERMIT.PERMITNUMBER,
				PMPERMITTYPE.NAME AS PERMITTYPENAME,
				PMPERMITWORKCLASS.NAME AS PERMITWORKCLASSNAME
		FROM PMPERMIT
		INNER JOIN PMPERMITTYPE ON PMPERMITTYPE.PMPERMITTYPEID = PMPERMIT.PMPERMITTYPEID
		LEFT OUTER JOIN PMPERMITWORKCLASS ON PMPERMITWORKCLASS.PMPERMITWORKCLASSID = PMPERMIT.PMPERMITWORKCLASSID
		INNER JOIN PMPERMITWFSTEP ON PMPERMITWFSTEP.PMPERMITID = PMPERMIT.PMPERMITID
		INNER JOIN PMPERMITWFACTIONSTEP ON PMPERMITWFACTIONSTEP.PMPERMITWFSTEPID = PMPERMITWFSTEP.PMPERMITWFSTEPID
		INNER JOIN PMPERMITACTIONREF ON PMPERMITACTIONREF.OBJECTID = PMPERMITWFACTIONSTEP.PMPERMITWFACTIONSTEPID
		WHERE PMPERMITACTIONREF.PMPERMITID = @CaseID
	END
END