
-- exec [rpt_TX_SR_Tax_Remittance_Report_Tax_Account_with_Unreported_Coupons]

CREATE PROCEDURE [dbo].[rpt_TX_SR_Tax_Remittance_Report_Tax_Account_with_Unreported_Coupons]

AS

SELECT  TX.AMOUNTREPORTED
       ,TXREMITTANCEACCOUNT.REMITTANCEACCOUNTNUMBER AS REMACCOUNT
       ,COALESCE(NULLIF(GLOBALENTITY.GLOBALENTITYNAME,''),'N/A') AS BUSINESSNAME
       ,TXRPTPERIOD.NAME REPORTPERIOD
       ,TXBILLPERIOD.STARTDATE, TXBILLPERIOD.ENDDATE,TXBILLPERIOD.DUEDATE,TxBillPeriod.PERIODNAME,
       --,CAINVOICE.INVOICENUMBER,CAINVOICE.INVOICETOTAL
	 --  ,(SELECT R.[IMAGE] FROM RPTIMAGELIB R
		--WHERE R.IMAGENAME = 'Municipality_Logo') LOGO,
(SELECT CASE WHEN R.[IMAGE] IS NULL THEN 'N' ELSE 'Y' END FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') SHOWLOGO,
(SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Name') Municipality_Name,	   
(SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Page_Footer') Municipality_Page_Footer
FROM TXREMITTANCE TX
INNER JOIN TXBILLPERIOD On TX.TXBILLPERIODID = TXBILLPERIOD.BILLPERIODID
INNER JOIN TXREMITTANCEACCOUNT ON Tx.TXREMITTANCEACCOUNTID = TXREMITTANCEACCOUNT.TXREMITTANCEACCOUNTID
LEFT OUTER JOIN TXRPTPERIOD ON TXREMITTANCEACCOUNT.REPORTPERIODID = TXRPTPERIOD.TXRPTPERIODID
INNER JOIN TXREMITSTATUS ON TXREMITTANCEACCOUNT.TXREMITTANCESTATUSID = TXREMITSTATUS.TXREMITSTATUSID and TXREMITSTATUS.TXREMITSTATUSSYSTEMID <> 2
--LEFT OUTER JOIN TXREMITTANCEFEE  ON Tx.TXREMITTANCEID = TXREMITTANCEFEE.TXREMITTANCEID
--LEFT OUTER JOIN CACOMPUTEDFEE ON CACOMPUTEDFEE.CACOMPUTEDFEEID = TXREMITTANCEFEE.CACOMPUTEDFEEID
--LEFT OUTER JOIN CATRANSACTIONFEE ON CAComputedFee.CAComputedFeeID = CATransactionFee.CaComputedFeeID
--LEFT OUTER JOIN CATRANSACTION ON  CATRANSACTION.CATRANSACTIONID = CATRANSACTIONFEE.CATRANSACTIONID 
--LEFT OUTER JOIN CATRANSACTIONINVOICE ON CATRANSACTION.CATRANSACTIONID = CATRANSACTIONINVOICE.CATRANSACTIONID 
--LEFT OUTER JOIN CAINVOICE ON CAINVOICE.CAINVOICEID = CATRANSACTIONINVOICE.CAINVOICEID 
INNER JOIN BLGLOBALENTITYEXTENSION ON TXREMITTANCEACCOUNT.BLGLOBALENTITYEXTENSIONID = BLGLOBALENTITYEXTENSION.BLGLOBALENTITYEXTENSIONID
INNER JOIN GLOBALENTITY ON GLOBALENTITY.GLOBALENTITYID  = BLGLOBALENTITYEXTENSION.GLOBALENTITYID

WHERE Tx.AmountReported IS NULL OR TX.REPORTEDDATE IS NULL
ORDER BY TXBILLPERIOD.DUEDATE ASC

