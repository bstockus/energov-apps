CREATE PROCEDURE [dbo].[USP_TILLSESSION_HAVEVALIDTILLSESSION]
	@USERID CHAR(36), 
	@OFFICEID CHAR(36) = NULL
AS
BEGIN
	IF EXISTS ( SELECT 1 FROM SETTINGS WHERE NAME = 'ENABLETILLSESSIONS' AND BITVALUE= 1)
	BEGIN
		SELECT CAST(1 AS BIT) AS ENABLETILLSESSIONSETTING,  CASE WHEN COUNT(*) = 1 THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS HAVEVALIDTILLSESSION FROM [dbo].CATILLSESSION
		WHERE USERID=@USERID AND ((@OFFICEID is null and OFFICEID is null) OR @OFFICEID=OFFICEID) AND CLOSEDTIMESTAMP IS NULL
	END
	ELSE
	BEGIN 
		SELECT CAST(0 AS BIT) AS ENABLETILLSESSIONSETTING, CAST(0 AS BIT) AS HAVEVALIDTILLSESSION
	END 
END