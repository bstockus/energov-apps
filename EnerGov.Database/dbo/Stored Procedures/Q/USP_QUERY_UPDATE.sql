CREATE PROCEDURE [dbo].[USP_QUERY_UPDATE]
(
	@QUERYID CHAR(36),
	@NAME NVARCHAR(100),
	@DESCRIPTION NVARCHAR(MAX),
	@PRIORITY INT,
	@ISENABLED BIT,
	@MODULEID INT,
	@QUERYBUILDERID CHAR(36),
	@LASTCHANGEDON DATETIME,
	@LASTCHANGEDBY CHAR(36),
	@ROWVERSION INT
)
AS
DECLARE @OUTPUTTABLE as TABLE([ROWVERSION]  int)
UPDATE [dbo].[QUERY] SET
	[NAME]			=	@NAME,
	[DESCRIPTION]	=	@DESCRIPTION,
	[PRIORITY]		=	@PRIORITY,
	[ISENABLED]		=	@ISENABLED,
	[MODULEID]		=	@MODULEID,
	[QUERYBUILDERID]=	@QUERYBUILDERID,
	[LASTCHANGEDON] =	@LASTCHANGEDON,
	[LASTCHANGEDBY] =	@LASTCHANGEDBY,
	[ROWVERSION]	=	@ROWVERSION + 1
OUTPUT inserted.[ROWVERSION] INTO @OUTPUTTABLE
WHERE
	[dbo].[QUERY].[QUERYID] = @QUERYID AND [dbo].[QUERY].[ROWVERSION] = @ROWVERSION

SELECT * FROM @OUTPUTTABLE