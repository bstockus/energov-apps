CREATE PROCEDURE [dbo].[USP_WORKFLOWACTIONMAILMERGETMPL_DELETE_BYPARENTID]
(
	@WORKFLOWACTIONID CHAR(36),
	@WORKFLOWID CHAR(36)
)
AS
	DECLARE @MAILMERGETEMPLATEIDS RECORDIDS
	INSERT INTO @MAILMERGETEMPLATEIDS
	SELECT MAILMERGETEMPLATEID from [WORKFLOWACTIONMAILMERGETMPL]
	INNER JOIN [dbo].[WORKFLOWACTION] on [dbo].[WORKFLOWACTIONMAILMERGETMPL].[WORKFLOWACTIONID] = [dbo].[WORKFLOWACTION].[WORKFLOWACTIONID]
	WHERE
		(@WORKFLOWACTIONID IS NULL OR [dbo].[WORKFLOWACTION].[WORKFLOWACTIONID] = @WORKFLOWACTIONID) AND
		(@WORKFLOWID IS NULL OR [dbo].[WORKFLOWACTION].[WORKFLOWID] = @WORKFLOWID)
	
	DELETE [dbo].[WORKFLOWACTIONMAILMERGETMPL] FROM [dbo].[WORKFLOWACTIONMAILMERGETMPL]
	INNER JOIN [dbo].[WORKFLOWACTION] on [dbo].[WORKFLOWACTIONMAILMERGETMPL].[WORKFLOWACTIONID] = [dbo].[WORKFLOWACTION].[WORKFLOWACTIONID]
	WHERE
		(@WORKFLOWACTIONID IS NULL OR [dbo].[WORKFLOWACTION].[WORKFLOWACTIONID] = @WORKFLOWACTIONID) AND
		(@WORKFLOWID IS NULL OR [dbo].[WORKFLOWACTION].[WORKFLOWID] = @WORKFLOWID)
	
	EXEC [dbo].[USP_MAILMERGETEMPLATE_DELETE_BYIDS] @MAILMERGETEMPLATEIDS