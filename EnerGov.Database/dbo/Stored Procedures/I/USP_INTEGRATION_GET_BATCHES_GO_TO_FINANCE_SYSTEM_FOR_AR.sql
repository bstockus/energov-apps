CREATE PROCEDURE [dbo].[USP_INTEGRATION_GET_BATCHES_GO_TO_FINANCE_SYSTEM_FOR_AR]
	@BATCH_NUMBER AS NVARCHAR(50)
AS

BEGIN

SELECT DISTINCT ISNULL(CAFINANCIALINTEGRATIONSETUPID, '') CAFINANCIALINTEGRATIONSETUPID
FROM (

SELECT DISTINCT JURISDICTION.CAFINANCIALINTEGRATIONSETUPID
FROM CATRANSACTIONARINTEGRATION
JOIN CAINVOICEFEEARPOSTING ON CATRANSACTIONARINTEGRATION.CATRANSACTIONARPOSTINGID = CAINVOICEFEEARPOSTING.CATRANSACTIONARPOSTINGID
JOIN CAINVOICEFEE ON CAINVOICEFEEARPOSTING.CAINVOICEFEEID = CAINVOICEFEE.CAINVOICEFEEID
JOIN CACOMPUTEDFEE ON CAINVOICEFEE.CACOMPUTEDFEEID = CACOMPUTEDFEE.CACOMPUTEDFEEID
JOIN CAFEETEMPLATEFEE ON CACOMPUTEDFEE.CAFEETEMPLATEFEEID = CAFEETEMPLATEFEE.CAFEETEMPLATEFEEID
JOIN CAFEE ON CAFEETEMPLATEFEE.CAFEEID = CAFEE.CAFEEID
LEFT JOIN JURISDICTION ON CAFEE.JURISDICTIONID = JURISDICTION.JURISDICTIONID
WHERE CATRANSACTIONARINTEGRATION.BATCHNUMBER = @BATCH_NUMBER

UNION ALL

SELECT DISTINCT JURISDICTION.CAFINANCIALINTEGRATIONSETUPID
FROM CATRANSACTIONARINTEGRATION
JOIN CAINVMISCFEEARPOSTING ON CATRANSACTIONARINTEGRATION.CATRANSACTIONARPOSTINGID = CAINVMISCFEEARPOSTING.CATRANSACTIONARPOSTINGID
JOIN CAINVOICEMISCFEE ON CAINVMISCFEEARPOSTING.CAINVOICEMISCFEEID = CAINVOICEMISCFEE.CAINVOICEMISCFEEID
JOIN CAMISCFEE ON CAINVOICEMISCFEE.CAMISCFEEID = CAMISCFEE.CAMISCFEEID
JOIN CAFEE ON CAMISCFEE.CAFEEID = CAFEE.CAFEEID
LEFT JOIN JURISDICTION ON CAFEE.JURISDICTIONID = JURISDICTION.JURISDICTIONID
WHERE CATRANSACTIONARINTEGRATION.BATCHNUMBER = @BATCH_NUMBER
) AS TB

END