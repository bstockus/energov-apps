
CREATE PROCEDURE rpt_IP_SR_Monetary_Impact_Conditions_by_Condition_Date
	@STARTDATE AS DATETIME,
	@ENDDATE AS DATETIME
AS

SET @STARTDATE = DATEADD(dd, DATEDIFF(dd, 0, @startdate), 0)
SET @ENDDATE = DATEADD(S,-1,DATEADD(D,1,@ENDDATE)) 

SELECT	IPCONDITIONCATEGORY.IPCONDITIONCATEGORYID, IPCONDITIONCATEGORY.NAME 'IPCONDITIONCATEGORY_NAME',
		IPCONDITION.CONDITIONNUMBER,
		IPCASE.SOURCECASENUMBER,
		IPCASE.CASENUMBER,
		DISTRICT.NAME 'DISTRICT_NAME',
		IPCONDITION.DESCRIPTION 'IPCONDITION_DESCRIPTION',
		IPUNITTYPE.NAME 'IPUNITTYPE_NAME',
		IPCONDITIONMONETARY.ASSESSAMOUNT,
		IPCONDITIONMONETARY.NUMOFCONDITIONUNIT ,
		--(SELECT R.[IMAGE] FROM RPTIMAGELIB R
		--	WHERE R.IMAGENAME = 'Municipality_Logo') LOGO,
		(SELECT CASE WHEN R.[IMAGE] IS NULL THEN 'N' ELSE 'Y' END FROM RPTIMAGELIB R
			WHERE R.IMAGENAME = 'Municipality_Logo') SHOWLOGO,
		(SELECT R.REPORTTEXT FROM RPTTEXTLIB R
			WHERE R.TEXTNAME = 'Municipality_Name') Municipality_Name,	   
		(SELECT R.REPORTTEXT FROM RPTTEXTLIB R
			WHERE R.TEXTNAME = 'Municipality_Page_Footer') Municipality_Page_Footer

FROM	IPCASE 
		INNER JOIN IPCONDITION ON IPCASE.IPCASEID = IPCONDITION.IPCASEID and IPCONDITION.MONETARY = 'true'
		INNER JOIN DISTRICT ON IPCASE.DISTRICTID = DISTRICT.DISTRICTID 
		INNER JOIN IPUNITTYPE ON IPCONDITION.IPUNITTYPEID = IPUNITTYPE.IPUNITTYPEID
		INNER JOIN IPCONDITIONMONETARY ON IPCONDITION.IPCONDITIONID = IPCONDITIONMONETARY.IPCONDITIONID 
		INNER JOIN IPCONDITIONTYPE ON IPCONDITION.IPCONDITIONTYPEID = IPCONDITIONTYPE.IPCONDITIONTYPEID
		INNER JOIN IPCONDITIONCATEGORY ON IPCONDITIONTYPE.IPCONDITIONCATEGORYID = IPCONDITIONCATEGORY.IPCONDITIONCATEGORYID 
				
WHERE	IPCONDITION.CREATEDDATE BETWEEN @STARTDATE AND @ENDDATE

ORDER BY	IPCONDITIONCATEGORY.NAME,
			IPCONDITIONCATEGORY.IPCONDITIONCATEGORYID,
			IPCONDITION.CONDITIONNUMBER,
			IPCASE.SOURCECASENUMBER,
			DISTRICT.NAME 

