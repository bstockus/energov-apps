
CREATE PROCEDURE [dbo].[rpt_IP_SR_Impact_Case_History_Report]
@IPCASEID AS VARCHAR(36)
AS

SELECT IPCASE.CASENUMBER, HISTORYIMPACTMANAGEMENT.ROWVERSION, HISTORYIMPACTMANAGEMENT.CHANGEDON, 
       HISTORYIMPACTMANAGEMENT.FIELDNAME, HISTORYIMPACTMANAGEMENT.OLDVALUE, HISTORYIMPACTMANAGEMENT.NEWVALUE, HISTORYIMPACTMANAGEMENT.ADDITIONALINFO, 
       USERS.FNAME, USERS.LNAME,
	   (SELECT R.[IMAGE] FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') LOGO,
	   (SELECT CASE WHEN R.[IMAGE] IS NULL THEN 'N' ELSE 'Y' END FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') SHOWLOGO,
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Name') Municipality_Name,	   
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Page_Footer') Municipality_Page_Footer
       
FROM IPCASE 
INNER JOIN HISTORYIMPACTMANAGEMENT ON IPCASE.IPCASEID = HISTORYIMPACTMANAGEMENT.ID 
INNER JOIN USERS ON HISTORYIMPACTMANAGEMENT.CHANGEDBY = USERS.SUSERGUID
WHERE IPCASE.IPCASEID = @IPCASEID

