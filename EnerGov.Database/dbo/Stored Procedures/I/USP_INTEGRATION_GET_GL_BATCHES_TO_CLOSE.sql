CREATE PROCEDURE [dbo].[USP_INTEGRATION_GET_GL_BATCHES_TO_CLOSE]
	@BatchCutoffDate AS DATETIME
AS

BEGIN

SELECT DISTINCT CATRANSACTION.EXTERNALBATCHNBR
FROM CATRANSACTION
LEFT JOIN CAINTEGRATIONBATCHPROCESS ON CATRANSACTION.EXTERNALBATCHNBR = CAINTEGRATIONBATCHPROCESS.BATCH_NUMBER
WHERE CAINTEGRATIONBATCHPROCESS.BATCH_NUMBER IS NULL
AND CATRANSACTION.EXTERNALBATCHNBR IS NOT NULL 
AND (CATRANSACTION.EXTERNALBATCHNBR LIKE 'EGW%' OR
     CATRANSACTION.EXTERNALBATCHNBR LIKE 'MSC%' OR
     CATRANSACTION.EXTERNALBATCHNBR LIKE 'RR%' OR
     CATRANSACTION.EXTERNALBATCHNBR LIKE 'BDP%' OR
	 CATRANSACTION.EXTERNALBATCHNBR LIKE 'BDR%' OR
	 CATRANSACTION.EXTERNALBATCHNBR LIKE 'VOI%'
)
AND LEN(CATRANSACTION.EXTERNALBATCHNBR) > 3
AND CATRANSACTION.LASTCHANGEDON >= @BatchCutoffDate

END