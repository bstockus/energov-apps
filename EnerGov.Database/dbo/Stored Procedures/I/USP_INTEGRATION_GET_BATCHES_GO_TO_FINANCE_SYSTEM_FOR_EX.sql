CREATE PROCEDURE [dbo].[USP_INTEGRATION_GET_BATCHES_GO_TO_FINANCE_SYSTEM_FOR_EX]
	@BATCH_NUMBER AS NVARCHAR(50)
AS

BEGIN

SELECT DISTINCT ISNULL(CAFINANCIALINTEGRATIONSETUPID, '') CAFINANCIALINTEGRATIONSETUPID
FROM (

SELECT DISTINCT JURISDICTION.CAFINANCIALINTEGRATIONSETUPID
FROM CAEXTERNALINVOICEBATCHFEE
JOIN CACOMPUTEDFEE ON CAEXTERNALINVOICEBATCHFEE.CACOMPUTEDFEEID = CACOMPUTEDFEE.CACOMPUTEDFEEID
JOIN CAFEETEMPLATEFEE ON CACOMPUTEDFEE.CAFEETEMPLATEFEEID = CAFEETEMPLATEFEE.CAFEETEMPLATEFEEID
JOIN CAFEE on CAFEETEMPLATEFEE.CAFEEID = CAFEE.CAFEEID
LEFT JOIN JURISDICTION ON CAFEE.JURISDICTIONID = JURISDICTION.JURISDICTIONID
WHERE CAEXTERNALINVOICEBATCHFEE.BATCHNUMBER = @BATCH_NUMBER

UNION ALL

SELECT DISTINCT JURISDICTION.CAFINANCIALINTEGRATIONSETUPID
FROM CAEXTERNALINVOICEBATCHMISCFEE
JOIN CAMISCFEE ON CAEXTERNALINVOICEBATCHMISCFEE.CAMISCFEEID = CAMISCFEE.CAMISCFEEID
JOIN CAFEE ON CAMISCFEE.CAFEEID = CAFEE.CAFEEID
LEFT JOIN JURISDICTION ON CAFEE.JURISDICTIONID = JURISDICTION.JURISDICTIONID
WHERE CAEXTERNALINVOICEBATCHMISCFEE.BATCHNUMBER = @BATCH_NUMBER

) AS TB

END