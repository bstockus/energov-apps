CREATE PROCEDURE [dbo].[USP_INTEGRATION_GET_BATCHES_GO_TO_FINANCE_SYSTEM_FOR_GL]
	@IS_ONLINE AS BIT,
	@BATCH_NUMBER AS NVARCHAR(50)
AS

BEGIN

IF (@IS_ONLINE = 0)
BEGIN
	SELECT DISTINCT ISNULL(JURISDICTION.CAFINANCIALINTEGRATIONSETUPID, '') AS CAFINANCIALINTEGRATIONSETUPID
	FROM CATRANSACTIONPAYMENT
	JOIN CATRANSACTION ON CATRANSACTIONPAYMENT.CATRANSACTIONID = CATRANSACTION.CATRANSACTIONID
	LEFT JOIN OFFICE ON CATRANSACTION.OFFICEID = OFFICE.OFFICEID
	LEFT JOIN JURISDICTION ON OFFICE.JURISDICTIONID = JURISDICTION.JURISDICTIONID
	WHERE CATRANSACTION.EXTERNALBATCHNBR = @BATCH_NUMBER
	AND CATRANSACTIONPAYMENT.ISONLINE = @IS_ONLINE
END
ELSE
BEGIN
	SELECT DISTINCT ISNULL(JURISDICTION.CAFINANCIALINTEGRATIONSETUPID, '') AS CAFINANCIALINTEGRATIONSETUPID
	FROM CATRANSACTIONPAYMENT
	JOIN CATRANSACTION ON CATRANSACTIONPAYMENT.CATRANSACTIONID = CATRANSACTION.CATRANSACTIONID
	JOIN CATRANSACTIONFEE ON CATRANSACTION.CATRANSACTIONID = CATRANSACTIONFEE.CATRANSACTIONID
	JOIN CACOMPUTEDFEE ON CATRANSACTIONFEE.CACOMPUTEDFEEID = CATRANSACTIONFEE.CACOMPUTEDFEEID
	JOIN CAFEETEMPLATEFEE ON CACOMPUTEDFEE.CAFEETEMPLATEFEEID = CAFEETEMPLATEFEE.CAFEETEMPLATEFEEID
	JOIN CAFEE ON CAFEETEMPLATEFEE.CAFEEID = CAFEE.CAFEEID
	LEFT JOIN JURISDICTION ON CAFEE.JURISDICTIONID = JURISDICTION.JURISDICTIONID
	WHERE CATRANSACTION.EXTERNALBATCHNBR = @BATCH_NUMBER
	AND CATRANSACTIONPAYMENT.ISONLINE = @IS_ONLINE
END

END