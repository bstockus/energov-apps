CREATE PROCEDURE [dbo].[USP_SESSIONS_AND_SESSIONRECORD_KILL_INACTIVE_SESSIONS]
  @ActiveTime DATETIME
AS
BEGIN
  DELETE FROM SESSIONRECORD WHERE SESSIONRECORD.SESSIONID IN (SELECT SESSIONID FROM SESSIONS WHERE ACTIVETIME < @ActiveTime)

  DELETE FROM SESSIONS WHERE ACTIVETIME < @ActiveTime

  DELETE FROM SESSIONRECORD
   WHERE SESSIONID NOT IN (
    SELECT SESSIONS.SESSIONID
      FROM SESSIONRECORD
      JOIN SESSIONS ON SESSIONRECORD.SESSIONID = SESSIONS.SESSIONID)
END