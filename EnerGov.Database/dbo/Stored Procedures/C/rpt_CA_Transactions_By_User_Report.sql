

CREATE PROCEDURE [dbo].[rpt_CA_Transactions_By_User_Report]
@STARTDATE AS DATETIME,
@ENDDATE AS DATETIME
AS
SET @ENDDATE = DATEADD(S,-1,DATEADD(D,1,@ENDDATE))
SELECT CACOMPUTEDFEE.CACOMPUTEDFEEID, CACOMPUTEDFEE.FEENAME, CACOMPUTEDFEE.COMPUTEDAMOUNT, CATRANSACTIONFEE.PAIDAMOUNT, CATRANSACTIONFEE.REFUNDAMOUNT, 
       USERS.ID, USERS.SUSERGUID, USERS.FNAME, USERS.LNAME, CAINVOICE.INVOICENUMBER, CATRANSACTION.TRANSACTIONDATE, CAPAYMENTMETHOD.NAME AS PaymentMethod, 
       CATRANSACTIONPAYMENT.SUPPLEMENTALDATA, CATRANSACTIONTYPE.NAME AS TransactionType, CATRANSACTIONSTATUS.NAME AS TransactionStatus
FROM CACOMPUTEDFEE 
INNER JOIN CAINVOICEFEE ON CACOMPUTEDFEE.CACOMPUTEDFEEID = CAINVOICEFEE.CACOMPUTEDFEEID 
INNER JOIN CAINVOICE ON CAINVOICEFEE.CAINVOICEID = CAINVOICE.CAINVOICEID 
INNER JOIN CATRANSACTIONFEE ON CACOMPUTEDFEE.CACOMPUTEDFEEID = CATRANSACTIONFEE.CACOMPUTEDFEEID 
INNER JOIN CATRANSACTION ON CATRANSACTIONFEE.CATRANSACTIONID = CATRANSACTION.CATRANSACTIONID 
INNER JOIN CATRANSACTIONTYPE ON CATRANSACTION.CATRANSACTIONTYPEID = CATRANSACTIONTYPE.CATRANSACTIONTYPEID 
INNER JOIN CATRANSACTIONSTATUS ON CATRANSACTION.CATRANSACTIONSTATUSID = CATRANSACTIONSTATUS.CATRANSACTIONSTATUSID 
INNER JOIN USERS ON CATRANSACTION.CREATEDBY = USERS.SUSERGUID 
INNER JOIN CATRANSACTIONPAYMENT ON CATRANSACTION.CATRANSACTIONID = CATRANSACTIONPAYMENT.CATRANSACTIONID 
INNER JOIN CAPAYMENTMETHOD ON CATRANSACTIONPAYMENT.CAPAYMENTMETHODID = CAPAYMENTMETHOD.CAPAYMENTMETHODID
WHERE CATRANSACTION.TRANSACTIONDATE BETWEEN @STARTDATE AND @ENDDATE
AND  (NOT (CATRANSACTIONTYPE.NAME = 'Void Reversal')) 
AND  (NOT (CATRANSACTIONSTATUS.NAME = 'Void')) 
AND  (CAInvoice.CAStatusID <> 5)

UNION ALL
SELECT CAMiscFee.CAMiscFeeID AS CACOMPUTEDFEEID, CAMiscFee.FeeName, CAMiscFee.Amount AS COMPUTEDAMOUNT, CATransactionMiscFee.PaidAmount, CATRANSACTIONMISCFEE.REFUNDAMOUNT, 
       USERS.ID, USERS.SUSERGUID, USERS.FNAME, USERS.LNAME, CAInvoice.InvoiceNumber, CATransaction.TransactionDate, CAPaymentMethod.Name AS PaymentMethod, 
       CATransactionPayment.SupplementalData, CATransactionType.Name AS TransactionType, CATransactionStatus.Name AS TransactionStatus
FROM CAMISCFEE 
INNER JOIN CAINVOICEMISCFEE ON CAMISCFEE.CAMISCFEEID = CAINVOICEMISCFEE.CAMISCFEEID 
INNER JOIN CAINVOICE ON CAINVOICEMISCFEE.CAINVOICEID = CAINVOICE.CAINVOICEID 
INNER JOIN CATRANSACTIONMISCFEE ON CAMISCFEE.CAMISCFEEID = CATRANSACTIONMISCFEE.CAMISCFEEID 
INNER JOIN CATRANSACTION ON CATRANSACTIONMISCFEE.CATRANSACTIONID = CATRANSACTION.CATRANSACTIONID 
INNER JOIN CATRANSACTIONTYPE ON CATRANSACTION.CATRANSACTIONTYPEID = CATRANSACTIONTYPE.CATRANSACTIONTYPEID 
INNER JOIN CATRANSACTIONSTATUS ON CATRANSACTION.CATRANSACTIONSTATUSID = CATRANSACTIONSTATUS.CATRANSACTIONSTATUSID 
INNER JOIN USERS ON CATRANSACTION.CREATEDBY = USERS.SUSERGUID 
INNER JOIN CATRANSACTIONPAYMENT ON CATRANSACTION.CATRANSACTIONID = CATRANSACTIONPAYMENT.CATRANSACTIONID 
INNER JOIN CAPAYMENTMETHOD ON CATRANSACTIONPAYMENT.CAPAYMENTMETHODID = CAPAYMENTMETHOD.CAPAYMENTMETHODID
WHERE CATRANSACTION.TRANSACTIONDATE BETWEEN @STARTDATE AND @ENDDATE
AND  (NOT (CATRANSACTIONTYPE.NAME = 'Void Reversal'))
AND  (NOT (CATRANSACTIONSTATUS.NAME = 'Void'))
AND  (CAInvoice.CAStatusID <> 5)

