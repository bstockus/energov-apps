
CREATE PROCEDURE rpt_CM_SR_Case_Images_Contacts
@CMCODECASEID AS VARCHAR(36)
AS
SELECT CCC.CMCODECASEID, GE.FIRSTNAME, GE.LASTNAME, GE.GLOBALENTITYID, CCCT.NAME CONTACTTYPE, GE.GLOBALENTITYNAME COMPANYNAME, 
	CCC.ISBILLING, GE.GLOBALENTITYNAME, GE.[IMAGE], GE.ISCOMPANY, GE.ISCONTACT, GE.MIDDLENAME,
	CASE	WHEN LEN(LTRIM(GE.BUSINESSPHONE)) > 0 THEN GE.BUSINESSPHONE 
		WHEN LEN(LTRIM(GE.MOBILEPHONE)) > 0 THEN GE.MOBILEPHONE 
		WHEN LEN(LTRIM(GE.HOMEPHONE)) > 0 THEN GE.HOMEPHONE 
		WHEN LEN(LTRIM(GE.OTHERPHONE)) > 0 THEN GE.OTHERPHONE 
		ELSE '' END AS PHONE
FROM CMCODECASECONTACT CCC
INNER JOIN GLOBALENTITY GE ON CCC.GLOBALENTITYID = GE.GLOBALENTITYID
INNER JOIN CMCODECASECONTACTTYPE CCCT ON CCC.CMCODECASECONTACTTYPEID = CCCT.CMCODECASECONTACTTYPEID
WHERE CCC.CMCODECASEID = @CMCODECASEID


