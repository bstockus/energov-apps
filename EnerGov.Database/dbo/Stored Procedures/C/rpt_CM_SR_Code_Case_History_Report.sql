
CREATE PROCEDURE [dbo].[rpt_CM_SR_Code_Case_History_Report]
@CMCODECASEID AS VARCHAR(36)
AS

SELECT HISTORYCODEMANAGEMENT.ROWVERSION AS RowVersion, HISTORYCODEMANAGEMENT.CHANGEDON AS ChangedOn, 
       HISTORYCODEMANAGEMENT.FIELDNAME AS FieldName, HISTORYCODEMANAGEMENT.OLDVALUE AS OldValue, 
       HISTORYCODEMANAGEMENT.NEWVALUE AS NewValue, HISTORYCODEMANAGEMENT.ADDITIONALINFO AS AdditionalInfo, USERS.FNAME AS FName, 
       USERS.LNAME AS LName, CMCODECASE.CASENUMBER AS CaseNumber,
	   (SELECT R.[IMAGE] FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') LOGO,
	   (SELECT CASE WHEN R.[IMAGE] IS NULL THEN 'N' ELSE 'Y' END FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') SHOWLOGO,
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Name') Municipality_Name,	   
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Page_Footer') Municipality_Page_Footer

FROM HISTORYCODEMANAGEMENT 
INNER JOIN CMCODECASE ON HISTORYCODEMANAGEMENT.ID = CMCODECASE.CMCODECASEID 
INNER JOIN USERS ON HISTORYCODEMANAGEMENT.CHANGEDBY = USERS.SUSERGUID
WHERE CMCODECASE.CMCODECASEID = @CMCODECASEID
