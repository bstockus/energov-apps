

CREATE PROCEDURE [dbo].[rpt_CM_SR_Code_Case_Activity_Report]
@CMCODECASEID AS VARCHAR(36)
AS
SELECT CM.CASENUMBER AS CaseNumber, CM.OPENEDDATE AS OpenedDate, CM.CLOSEDDATE AS ClosedDate, 
       CMCODEACTIVITYTYPE.NAME AS ActivityType, CMCODEACTIVITY.CODEACTIVITYCOMMENTS AS Comments, CMCODECASESTATUS.NAME AS CodeCaseStatus, 
       CMCASETYPE.NAME AS CaseType, USERS.FNAME + ' ' + USERS.LNAME AS CreatedBy, CMCODEACTIVITY.CREATEDON AS ActivityCreateDate, CMCODEACTIVITY.CMCODEACTIVITYID,
       CMCODEACTIVITY.CODEACTIVITYNAME AS ActivityName, CONVERT(VARCHAR(10), CMCODEACTIVITY.CREATEDON, 108) AS ActivityTime,
  	   ADDRESSLINE1,  ADDRESSLINE2, ADDRESSLINE3,   CITY,  POSTALCODE,  POSTDIRECTION,
       PREDIRECTION,  [STATE],  STREETTYPE,  UNITORSUITE, RTRIM(LTRIM(AssignedTo.FNAME)) + ' ' + RTRIM(LTRIM(AssignedTo.LNAME))  AS AssignedTo,
	   (SELECT R.[IMAGE] FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') LOGO,
	   (SELECT CASE WHEN R.[IMAGE] IS NULL THEN 'N' ELSE 'Y' END FROM RPTIMAGELIB R
		WHERE R.IMAGENAME = 'Municipality_Logo') SHOWLOGO,
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Name') Municipality_Name,	   
	   (SELECT R.REPORTTEXT FROM RPTTEXTLIB R
		WHERE R.TEXTNAME = 'Municipality_Page_Footer') Municipality_Page_Footer
       
FROM CMCODECASE AS CM 
INNER JOIN CMCODECASESTATUS ON CM.CMCODECASESTATUSID = CMCODECASESTATUS.CMCODECASESTATUSID 
INNER JOIN CMCASETYPE ON CM.CMCASETYPEID = CMCASETYPE.CMCASETYPEID 
LEFT OUTER JOIN CMCODEACTIVITY ON CM.CMCODECASEID = CMCODEACTIVITY.CMCODECASEID 
LEFT OUTER JOIN CMCODEACTIVITYTYPE ON CMCODEACTIVITY.CMCODEACTIVITYTYPEID = CMCODEACTIVITYTYPE.CMCODEACTIVITYTYPEID 
LEFT OUTER JOIN USERS ON CMCODEACTIVITY.SUSERGUID = USERS.SUSERGUID
LEFT OUTER JOIN CMCODECASEADDRESS ON CM.CMCODECASEID = CMCODECASEADDRESS.CMCODECASEID AND CMCODECASEADDRESS.MAIN = 'TRUE'
LEFT OUTER JOIN MAILINGADDRESS ON CMCODECASEADDRESS.MAILINGADDRESSID = MAILINGADDRESS.MAILINGADDRESSID
LEFT OUTER JOIN USERS AssignedTo ON CM.ASSIGNEDTO = AssignedTo.SUSERGUID
WHERE CM.CMCODECASEID = @CMCODECASEID

