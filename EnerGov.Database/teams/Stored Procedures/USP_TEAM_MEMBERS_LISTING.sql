CREATE PROCEDURE [teams].[USP_TEAM_MEMBERS_LISTING]
	@TEAM_MANAGER_USER_ID CHAR(36),
	@RESOURCE_SYSTEM_TYPE_ID INT
AS
SET NOCOUNT ON;
SELECT 
	[dbo].[USERS].[SUSERGUID],
	[dbo].[USERS].[FNAME],
	[dbo].[USERS].[LNAME],
	[dbo].[USERS].[BACTIVE]
INTO #tmpMembers
FROM [dbo].[TEAMRESOURCE]
INNER JOIN [dbo].[TEAM] ON [dbo].[TEAM].[TEAMID] = [dbo].[TEAMRESOURCE].[TEAMID]
INNER JOIN [dbo].[USERS] ON [dbo].[USERS].[SUSERGUID] = [dbo].[TEAMRESOURCE].[USERID]
INNER JOIN [dbo].[RESOURCETYPE] ON [dbo].[RESOURCETYPE].[RESOURCETYPEID] = [dbo].[TEAMRESOURCE].[RESOURCETYPEID]
WHERE  
	[dbo].[TEAM].[USERID] = @TEAM_MANAGER_USER_ID AND
	[dbo].[RESOURCETYPE].[RESOURCESYSTEMTYPEID] = @RESOURCE_SYSTEM_TYPE_ID
ORDER BY [dbo].[USERS].[LNAME], [dbo].[USERS].[FNAME]

IF ((SELECT COUNT(*) FROM #tmpMembers) > 0 AND (SELECT COUNT(*) FROM #tmpMembers WHERE SUSERGUID = @TEAM_MANAGER_USER_ID) <= 0)
BEGIN
INSERT INTO #tmpMembers
	SELECT 
	[dbo].[USERS].[SUSERGUID],
	[dbo].[USERS].[FNAME],
	[dbo].[USERS].[LNAME],
	[dbo].[USERS].[BACTIVE]
FROM [dbo].[USERS] 
WHERE SUSERGUID = @TEAM_MANAGER_USER_ID
END

SELECT * FROM #tmpMembers