CREATE PROCEDURE [globalsetup].[USP_JURISDICTION_GETALL]
AS
BEGIN
SET NOCOUNT ON;
	SELECT 
		[dbo].[JURISDICTION].[JURISDICTIONID],
		[dbo].[JURISDICTION].[NAME],	
		[dbo].[JURISDICTION].[DESCRIPTION],
		[dbo].[JURISDICTION].[CAFINANCIALINTEGRATIONSETUPID],
		[dbo].[JURISDICTION].[LASTCHANGEDBY],
		[dbo].[JURISDICTION].[LASTCHANGEDON],
		[dbo].[JURISDICTION].[ROWVERSION],
		(SELECT 
			CAST(CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END AS BIT)
			FROM
			(
			SELECT p.CAFINANCIALINTEGRATIONSETUPID
			FROM CAINTEGRATIONBATCHPROCESS p
			INNER JOIN CAFINANCIALINTEGRATIONSETUP s ON p.CAFINANCIALINTEGRATIONSETUPID = s.CAFINANCIALINTEGRATIONSETUPID
			INNER JOIN JURISDICTION j ON j.CAFINANCIALINTEGRATIONSETUPID = s.CAFINANCIALINTEGRATIONSETUPID
			WHERE j.CAFINANCIALINTEGRATIONSETUPID = [dbo].[JURISDICTION].[CAFINANCIALINTEGRATIONSETUPID] AND s.[ISACTIVE] = 1 AND p.[SUCCESS] != 1
			) AS [RESULT]
		) AS [FINANCIALINTHASACTIVEBATCHESTOPROCESS]
	FROM [dbo].[JURISDICTION] 
	ORDER BY [dbo].[JURISDICTION].[NAME] ASC
END