CREATE PROCEDURE [energovshell].[USP_ENERGOVFORMS_GETBY_USERID]
(
	@USERID CHAR(36)
)
AS
BEGIN	
	SET NOCOUNT ON;
	SELECT	[dbo].[SUBMENUS].[SSUBMENUGUID] AS [SUBMENUID],
			[dbo].[FORMS].[SFORMSGUID],
			[dbo].[FORMS].[SFORMNAME] ,
			[dbo].[FORMS].[HTML_COMMON_NAME] ,
			[dbo].[FORMS].[SCOMMONNAME] ,
			[dbo].[FORMS].[ICONPATH] ,
			[dbo].[FORMS].[IORDER] ,
			[dbo].[FORMS].[SHINT] ,
			[dbo].[FORMS].[IS_HTML_ACTIVE]
	FROM  [dbo].[FORMS] WITH (NOLOCK) 
		INNER JOIN [dbo].[SUBMENUS] WITH (NOLOCK) ON [dbo].[FORMS].[FKSUBMENUGUID] = [dbo].[SUBMENUS].[SSUBMENUGUID]
		INNER JOIN [dbo].[MENUS] WITH (NOLOCK) ON [dbo].[SUBMENUS].[FKMENUGUID] = [dbo].[MENUS].[SMENUGUID]
		INNER JOIN [dbo].[ROLEFORMSXREF] WITH (NOLOCK) ON [dbo].[FORMS].[SFORMSGUID] = [dbo].[ROLEFORMSXREF].[FKFORMSID]
		INNER JOIN [dbo].[ROLESUBMENUXREF] WITH (NOLOCK) ON [dbo].[SUBMENUS].[SSUBMENUGUID] = [dbo].[ROLESUBMENUXREF].[FKSUBMENUID]
		INNER JOIN [dbo].[ROLEMENUXREF] WITH (NOLOCK) ON [dbo].[MENUS].[SMENUGUID] = [dbo].[ROLEMENUXREF].[FKMENUID]
		INNER JOIN [dbo].[ROLES] WITH (NOLOCK) ON [dbo].[ROLES].[SROLEGUID] = [dbo].[ROLESUBMENUXREF].[FKROLEID] AND [dbo].[ROLEMENUXREF].[FKROLEID] = [dbo].[ROLES].[SROLEGUID] AND [dbo].[ROLEFORMSXREF].[FKROLEID] = [dbo].[ROLES].[SROLEGUID]
		INNER JOIN [dbo].[USERS] WITH (NOLOCK) ON [dbo].[USERS].[SROLEID] = [dbo].[ROLES].[SROLEGUID]
	WHERE	
			[dbo].[ROLEMENUXREF].[BVISIBLE] = 1 
		AND [dbo].[ROLEFORMSXREF].[BVISIBLE] = 1 
		AND [dbo].[ROLESUBMENUXREF].[BVISIBLE] = 1 
		AND [dbo].[FORMS].[IS_HTML_ACTIVE] IS NULL 
		AND [dbo].[USERS].[SUSERGUID] = @USERID
END