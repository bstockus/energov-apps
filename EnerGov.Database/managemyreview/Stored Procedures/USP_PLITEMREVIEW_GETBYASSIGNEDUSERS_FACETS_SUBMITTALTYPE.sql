CREATE PROCEDURE [managemyreview].[USP_PLITEMREVIEW_GETBYASSIGNEDUSERS_FACETS_SUBMITTALTYPE]
(
	@ITEMREVIEWLIST RecordIDs READONLY
)
AS
BEGIN
SET NOCOUNT ON;

SELECT		PLSUBMITTALTYPE.PLSUBMITTALTYPEID AS ID
			, PLSUBMITTALTYPE.TYPENAME AS NAME
			, COUNT(*) COUNT
FROM		PLITEMREVIEW
INNER JOIN	@ITEMREVIEWLIST ON PLITEMREVIEW.PLITEMREVIEWID = RECORDID
INNER JOIN	PLSUBMITTAL ON PLSUBMITTAL.PLSUBMITTALID = PLITEMREVIEW.PLSUBMITTALID
INNER JOIN	PLSUBMITTALTYPE ON PLSUBMITTALTYPE.PLSUBMITTALTYPEID = PLSUBMITTAL.PLSUBMITTALTYPEID
GROUP BY PLSUBMITTALTYPE.PLSUBMITTALTYPEID, PLSUBMITTALTYPE.TYPENAME
ORDER BY COUNT(*) DESC, ID, NAME

END