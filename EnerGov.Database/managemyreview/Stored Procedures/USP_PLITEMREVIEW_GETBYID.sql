CREATE PROCEDURE [managemyreview].[USP_PLITEMREVIEW_GETBYID]
(
	 @ID	CHAR(36)
)
AS
BEGIN
SET NOCOUNT ON
DECLARE @PMPERMITID CHAR(36), @PLPLANID CHAR(36), @BLLICENSEID CHAR(36), @ILLICENSEID CHAR(36)

SELECT		@PLPLANID = PLPLANID
			, @PMPERMITID = PMPERMITID
			, @BLLICENSEID = BLLICENSEID
			, @ILLICENSEID = ILLICENSEID
FROM		PLITEMREVIEW
WHERE		PLITEMREVIEWID = @ID

IF (@PLPLANID IS NOT NULL)
BEGIN
	EXEC [managemyreview].[USP_PLITEMREVIEW_GETBYID_FORPLAN] @ID

	SELECT 
		@ID AS PARENTID,
		PLPLANADDRESS.PLPLANADDRESSID AS ENTITYID,
		MAILINGADDRESS.ADDRESSLINE1,
		MAILINGADDRESS.ADDRESSLINE2,
		MAILINGADDRESS.ADDRESSLINE3,
		MAILINGADDRESS.ADDRESSTYPE,
		MAILINGADDRESS.ATTN,
		MAILINGADDRESS.CITY,
		MAILINGADDRESS.COMPSITE,
		MAILINGADDRESS.COUNTRY,
		MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPEID,
		MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPENAME,
		PLPLANADDRESS.MAIN AS ISMAIN,
		MAILINGADDRESS.POBOX,
		MAILINGADDRESS.POSTALCODE,
		MAILINGADDRESS.POSTDIRECTION,
		MAILINGADDRESS.PREDIRECTION,
		MAILINGADDRESS.PROVINCE,
		MAILINGADDRESS.RURALROUTE,
		MAILINGADDRESS.STATE,
		MAILINGADDRESS.STATION,
		MAILINGADDRESS.STREETTYPE,
		MAILINGADDRESS.UNITORSUITE,
		MAILINGADDRESS.ADDRESSID
	FROM PLPLANADDRESS 
	INNER JOIN MAILINGADDRESS ON PLPLANADDRESS.MAILINGADDRESSID = MAILINGADDRESS.MAILINGADDRESSID
	INNER JOIN MAILINGADDRESSCOUNTRYTYPE ON MAILINGADDRESS.COUNTRYTYPE = MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPEID
	WHERE	PLPLANADDRESS.PLPLANID = @PLPLANID AND PLPLANADDRESS.MAIN = 1
END

IF (@PMPERMITID IS NOT NULL)
BEGIN
	EXEC [managemyreview].[USP_PLITEMREVIEW_GETBYID_FORPERMIT] @ID

	SELECT 
		@ID AS PARENTID,
		PMPERMITADDRESS.PMPERMITADDRESSID AS ENTITYID,
		MAILINGADDRESS.ADDRESSLINE1,
		MAILINGADDRESS.ADDRESSLINE2,
		MAILINGADDRESS.ADDRESSLINE3,
		MAILINGADDRESS.ADDRESSTYPE,
		MAILINGADDRESS.ATTN,
		MAILINGADDRESS.CITY,
		MAILINGADDRESS.COMPSITE,
		MAILINGADDRESS.COUNTRY,
		MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPEID,
		MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPENAME,
		PMPERMITADDRESS.MAIN AS ISMAIN,
		MAILINGADDRESS.POBOX,
		MAILINGADDRESS.POSTALCODE,
		MAILINGADDRESS.POSTDIRECTION,
		MAILINGADDRESS.PREDIRECTION,
		MAILINGADDRESS.PROVINCE,
		MAILINGADDRESS.RURALROUTE,
		MAILINGADDRESS.STATE,
		MAILINGADDRESS.STATION,
		MAILINGADDRESS.STREETTYPE,
		MAILINGADDRESS.UNITORSUITE,
		MAILINGADDRESS.ADDRESSID
	FROM PMPERMITADDRESS 
	INNER JOIN MAILINGADDRESS ON PMPERMITADDRESS.MAILINGADDRESSID = MAILINGADDRESS.MAILINGADDRESSID
	INNER JOIN MAILINGADDRESSCOUNTRYTYPE ON MAILINGADDRESS.COUNTRYTYPE = MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPEID
	WHERE	PMPERMITADDRESS.PMPERMITID = @PMPERMITID AND PMPERMITADDRESS.MAIN = 1
END

IF (@BLLICENSEID IS NOT NULL)
BEGIN
	EXEC [managemyreview].[USP_PLITEMREVIEW_GETBYID_FORBLLICENSE] @ID

	SELECT 
		@ID AS PARENTID,
		BLLICENSEADDRESS.BLLICENSEADDRESSID AS ENTITYID,
		MAILINGADDRESS.ADDRESSLINE1,
		MAILINGADDRESS.ADDRESSLINE2,
		MAILINGADDRESS.ADDRESSLINE3,
		MAILINGADDRESS.ADDRESSTYPE,
		MAILINGADDRESS.ATTN,
		MAILINGADDRESS.CITY,
		MAILINGADDRESS.COMPSITE,
		MAILINGADDRESS.COUNTRY,
		MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPEID,
		MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPENAME,
		BLLICENSEADDRESS.MAIN AS ISMAIN,
		MAILINGADDRESS.POBOX,
		MAILINGADDRESS.POSTALCODE,
		MAILINGADDRESS.POSTDIRECTION,
		MAILINGADDRESS.PREDIRECTION,
		MAILINGADDRESS.PROVINCE,
		MAILINGADDRESS.RURALROUTE,
		MAILINGADDRESS.STATE,
		MAILINGADDRESS.STATION,
		MAILINGADDRESS.STREETTYPE,
		MAILINGADDRESS.UNITORSUITE,
		MAILINGADDRESS.ADDRESSID
	FROM BLLICENSEADDRESS 
	INNER JOIN MAILINGADDRESS ON BLLICENSEADDRESS.MAILINGADDRESSID = MAILINGADDRESS.MAILINGADDRESSID
	INNER JOIN MAILINGADDRESSCOUNTRYTYPE ON MAILINGADDRESS.COUNTRYTYPE = MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPEID
	WHERE	BLLICENSEADDRESS.BLLICENSEID = @BLLICENSEID AND BLLICENSEADDRESS.MAIN = 1
END

IF (@ILLICENSEID IS NOT NULL)
BEGIN
	EXEC [managemyreview].[USP_PLITEMREVIEW_GETBYID_FORILLICENSE] @ID

	SELECT 
		@ID AS PARENTID,
		ILLICENSEADDRESS.ILLICENSEADDRESSID AS ENTITYID,
		MAILINGADDRESS.ADDRESSLINE1,
		MAILINGADDRESS.ADDRESSLINE2,
		MAILINGADDRESS.ADDRESSLINE3,
		MAILINGADDRESS.ADDRESSTYPE,
		MAILINGADDRESS.ATTN,
		MAILINGADDRESS.CITY,
		MAILINGADDRESS.COMPSITE,
		MAILINGADDRESS.COUNTRY,
		MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPEID,
		MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPENAME,
		ILLICENSEADDRESS.MAIN AS ISMAIN,
		MAILINGADDRESS.POBOX,
		MAILINGADDRESS.POSTALCODE,
		MAILINGADDRESS.POSTDIRECTION,
		MAILINGADDRESS.PREDIRECTION,
		MAILINGADDRESS.PROVINCE,
		MAILINGADDRESS.RURALROUTE,
		MAILINGADDRESS.STATE,
		MAILINGADDRESS.STATION,
		MAILINGADDRESS.STREETTYPE,
		MAILINGADDRESS.UNITORSUITE,
		MAILINGADDRESS.ADDRESSID
	FROM ILLICENSEADDRESS 
	INNER JOIN MAILINGADDRESS ON ILLICENSEADDRESS.MAILINGADDRESSID = MAILINGADDRESS.MAILINGADDRESSID
	INNER JOIN MAILINGADDRESSCOUNTRYTYPE ON MAILINGADDRESS.COUNTRYTYPE = MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPEID
	WHERE	ILLICENSEADDRESS.ILLICENSEID = @ILLICENSEID AND ILLICENSEADDRESS.MAIN = 1
END
DECLARE @PLITEMREVIEWIDS RecordIDs

INSERT INTO @PLITEMREVIEWIDS
SELECT @ID

EXEC [managemyreview].[USP_PLITEMREVIEW_GETCONTACTS] @PLITEMREVIEWIDS

EXEC [managemyreview].[USP_PLITEMREVIEW_GETHOLDS] @PLITEMREVIEWIDS

END