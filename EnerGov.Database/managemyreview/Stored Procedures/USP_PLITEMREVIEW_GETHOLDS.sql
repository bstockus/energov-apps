CREATE PROCEDURE [managemyreview].[USP_PLITEMREVIEW_GETHOLDS]
(
	 @PLITEMREVIEWIDS RecordIDs readonly
)
AS
BEGIN
SET NOCOUNT ON

SELECT		PLITEMREVIEW.PLITEMREVIEWID AS PARENTID
			, PLPLANHOLD.PLPLANID AS ENTITYID
			, PLPLANHOLD.PLPLANHOLDID AS HOLDID
			, HOLDTYPESETUPS.HOLDTYPEID	AS TYPEID
			, HOLDTYPESETUPS.NAME AS TYPENAME
			, PLPLANHOLD.ACTIVE			
			, PLPLANHOLD.COMMENTS		
			, HOLDTYPESETUPS.PLANWFSUBREVIVIEW AS ISWORKFLOWSUBMITTALREVIEWTYPE
			, HOLDTYPESETUPS.ALLOWHOLDOVERRIDES
FROM		PLPLANHOLD
JOIN		HOLDTYPESETUPS ON PLPLANHOLD.HOLDSETUPID = HOLDTYPESETUPS.HOLDSETUPID
JOIN		PLITEMREVIEW ON PLITEMREVIEW.PLPLANID = PLPLANHOLD.PLPLANID
WHERE		PLITEMREVIEW.PLITEMREVIEWID IN (SELECT RECORDID FROM @PLITEMREVIEWIDS)

UNION ALL

SELECT		PLITEMREVIEW.PLITEMREVIEWID AS PARENTID
			, PMPERMITHOLD.PMPERMITID AS ENTITYID
			, PMPERMITHOLD.PMPERMITHOLDID AS HOLDID
			, HOLDTYPESETUPS.HOLDTYPEID	AS TYPEID
			, HOLDTYPESETUPS.NAME AS TYPENAME
			, PMPERMITHOLD.ACTIVE			
			, PMPERMITHOLD.COMMENTS		
			, HOLDTYPESETUPS.PERMITWFSUBREVIEW AS ISWORKFLOWSUBMITTALREVIEWTYPE
			, HOLDTYPESETUPS.ALLOWHOLDOVERRIDES
FROM		PMPERMITHOLD
JOIN		HOLDTYPESETUPS ON PMPERMITHOLD.HOLDSETUPID = HOLDTYPESETUPS.HOLDSETUPID
JOIN		PLITEMREVIEW ON PLITEMREVIEW.PMPERMITID = PMPERMITHOLD.PMPERMITID
WHERE		PLITEMREVIEW.PLITEMREVIEWID IN (SELECT RECORDID FROM @PLITEMREVIEWIDS)

UNION ALL

SELECT		PLITEMREVIEW.PLITEMREVIEWID AS PARENTID
			, BLLICENSEHOLD.BLLICENSEID AS ENTITYID
			, BLLICENSEHOLD.BLLICENSEHOLDID AS HOLDID
			, HOLDTYPESETUPS.HOLDTYPEID	AS TYPEID
			, HOLDTYPESETUPS.NAME AS TYPENAME
			, BLLICENSEHOLD.ACTIVE			
			, BLLICENSEHOLD.COMMENTS		
			, CAST(0 AS BIT) AS ISWORKFLOWSUBMITTALREVIEWTYPE
			, HOLDTYPESETUPS.ALLOWHOLDOVERRIDES
FROM		BLLICENSEHOLD
JOIN		HOLDTYPESETUPS ON BLLICENSEHOLD.HOLDSETUPID = HOLDTYPESETUPS.HOLDSETUPID
JOIN		PLITEMREVIEW ON PLITEMREVIEW.BLLICENSEID = BLLICENSEHOLD.BLLICENSEID
WHERE		PLITEMREVIEW.PLITEMREVIEWID IN (SELECT RECORDID FROM @PLITEMREVIEWIDS)

UNION ALL

SELECT		PLITEMREVIEW.PLITEMREVIEWID AS PARENTID
			, ILLICENSEHOLD.ILLICENSEID AS ENTITYID
			, ILLICENSEHOLD.ILLICENSEHOLDID AS HOLDID
			, HOLDTYPESETUPS.HOLDTYPEID	AS TYPEID
			, HOLDTYPESETUPS.NAME AS TYPENAME
			, ILLICENSEHOLD.ACTIVE			
			, ILLICENSEHOLD.COMMENTS		
			, CAST(0 AS BIT) AS ISWORKFLOWSUBMITTALREVIEWTYPE
			, HOLDTYPESETUPS.ALLOWHOLDOVERRIDES
FROM		ILLICENSEHOLD
JOIN		HOLDTYPESETUPS ON ILLICENSEHOLD.HOLDSETUPID = HOLDTYPESETUPS.HOLDSETUPID
JOIN		PLITEMREVIEW ON PLITEMREVIEW.ILLICENSEID = ILLICENSEHOLD.ILLICENSEID
WHERE		PLITEMREVIEW.PLITEMREVIEWID IN (SELECT RECORDID FROM @PLITEMREVIEWIDS)

END