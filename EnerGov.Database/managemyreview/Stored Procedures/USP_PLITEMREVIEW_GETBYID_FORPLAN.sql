CREATE PROCEDURE [managemyreview].[USP_PLITEMREVIEW_GETBYID_FORPLAN]
(
	 @ID	CHAR(36)
)
AS
BEGIN

SELECT		PLITEMREVIEW.PLITEMREVIEWID				
			, PLITEMREVIEW.PLSUBMITTALID			
			, PLITEMREVIEW.ASSIGNEDUSERID 
			, PLITEMREVIEW.COMPLETEDATE 
			, PLITEMREVIEW.COMPLETED 
			, PLITEMREVIEW.NOTREQUIRED 
			, PLITEMREVIEW.DUEDATE 
			, PLPLAN.PLPLANID AS ENTITYID
			, PLPLAN.PLANNUMBER AS ENTITYNUMBER
			, PLPLANTYPE.PLPLANTYPEID AS ENTITYTYPEID
			, PLPLANTYPE.PLANNAME AS ENTITYTYPENAME
			, PLPLANWORKCLASS.PLPLANWORKCLASSID AS ENTITYCLASSID
			, PLPLANWORKCLASS.NAME AS ENTITYCLASSNAME
			, PLPLAN.DESCRIPTION AS ENTITYDESCRIPTION
			, PLPLAN.APPLICATIONDATE AS APPLIEDDATE
			, 1 AS MODULEID
			, PLSUBMITTALTYPE.PLSUBMITTALTYPEID AS SUBMITTALTYPEID
			, PLSUBMITTALTYPE.TYPENAME AS SUBMITTALTYPENAME
			, PLITEMREVIEWSTATUS.PLITEMREVIEWSTATUSID AS ITEMREVIEWSTATUSID
			, PLITEMREVIEWSTATUS.NAME AS ITEMREVIEWSTATUS
			, PLITEMREVIEWTYPE.PLITEMREVIEWTYPEID AS ITEMREVIEWTYPEID
			, PLITEMREVIEWTYPE.NAME AS ITEMREVIEWTYPE
			, PLPLANWFACTIONSTEP.VERSIONNUMBER AS VERSIONNUMBER
			, PLPLANADDRESS.MAILINGADDRESSID AS MAINADDRESSID
			, PRPROJECT.PRPROJECTID AS PROJECTID
			, PRPROJECT.NAME AS PROJECTNAME
			, ERENTITYSESSION.ERENTITYSESSIONID AS SESSIONID
			, PLPLAN.SQUAREFEET
			, PLPLAN.VALUE AS VALUATIONVALUE
			, CAST(0 AS BIT) AS ISSUEDFLAG
			, PLPLAN.COMPLETED AS COMPLETEDFLAG
			, CASEASSIGNEDTO.EMAIL AS CASEASSIGNEDTOEMAIL
			, CASEASSIGNEDTO.FNAME AS CASEASSIGNEDTOFIRSTNAME
			, CASEASSIGNEDTO.LNAME AS CASEASSIGNEDTOLASTNAME
			, NULL AS BUSINESSNAME
			, NULL AS LICENSEHOLDERFIRSTNAME
			, NULL AS LICENSEHOLDERLASTNAME
			, NULL AS EXPIRATIONDATE
			, NULL AS LASTRENEWALDATE
			, 1900 AS LICENSEYEAR
			, NULL AS LICENSETYPE
			, NULL AS LICENSESTATUS
			, ZONE.ZONEID
			, ZONE.NAME AS ZONENAME
			, ZONE.ZONECODE
			, ZONE.DESCRIPTION AS ZONEDESCRIPTION
			, PLPLANADDRESS.PLPLANADDRESSID AS PARENTADDRESSID
			, USERS.FNAME AS ASSIGNEDUSERFIRSTNAME
			, USERS.LNAME AS ASSIGNEDUSERLASTNAME
			, PLPLANWFACTIONSTEP.PLPLANWFSTEPID AS PLPLANWFSTEPID
			, ERENTITYSESSION.SESSIONSTATUSID AS SESSIONSTATUSID
			, PLITEMREVIEWTYPE.CODENAME AS CODENAME
			, PLITEMREVIEWTYPE.CODEURL AS CODEURL
			, NULL as LICENSETYPEMODULEID 
FROM		PLITEMREVIEW 
INNER JOIN	PLSUBMITTAL ON PLITEMREVIEW.PLSUBMITTALID = PLSUBMITTAL.PLSUBMITTALID
INNER JOIN	PLITEMREVIEWSTATUS ON PLITEMREVIEWSTATUS.PLITEMREVIEWSTATUSID = PLITEMREVIEW.PLITEMREVIEWSTATUSID
INNER JOIN	PLSUBMITTALTYPE ON PLSUBMITTAL.PLSUBMITTALTYPEID = PLSUBMITTALTYPE.PLSUBMITTALTYPEID
INNER JOIN	PLSUBMITTALSTATUS ON PLSUBMITTALSTATUS.PLSUBMITTALSTATUSID = PLSUBMITTAL.PLSUBMITTALSTATUSID
INNER JOIN	PLITEMREVIEWTYPE ON PLITEMREVIEW.PLITEMREVIEWTYPEID = PLITEMREVIEWTYPE.PLITEMREVIEWTYPEID
INNER JOIN	PLPLANWFACTIONSTEP ON PLPLANWFACTIONSTEP.PLPLANWFACTIONSTEPID = PLSUBMITTAL.PLPLANWFACTIONSTEPID
INNER JOIN	PLPLAN ON PLPLAN.PLPLANID = PLSUBMITTAL.PLPLANID
INNER JOIN	PLPLANTYPE ON PLPLAN.PLPLANTYPEID = PLPLANTYPE.PLPLANTYPEID
INNER JOIN	PLPLANSTATUS ON PLPLAN.PLPLANSTATUSID = PLPLANSTATUS.PLPLANSTATUSID
INNER JOIN	PLPLANWORKCLASS ON PLPLAN.PLPLANWORKCLASSID = PLPLANWORKCLASS.PLPLANWORKCLASSID
LEFT JOIN	PLPLANADDRESS ON PLPLAN.PLPLANID = PLPLANADDRESS.PLPLANID AND PLPLANADDRESS.MAIN = 1
INNER JOIN	USERS ON USERS.SUSERGUID = PLITEMREVIEW.ASSIGNEDUSERID
LEFT JOIN  USERS AS CASEASSIGNEDTO ON CASEASSIGNEDTO.SUSERGUID = PLPLAN.ASSIGNEDTO 
LEFT JOIN	PRPROJECTPLAN ON PRPROJECTPLAN.PLPLANID = PLPLAN.PLPLANID
LEFT JOIN	PRPROJECT ON PRPROJECT.PRPROJECTID = PRPROJECTPLAN.PRPROJECTID
LEFT JOIN	ERENTITYSESSION ON ERENTITYSESSION.PLSUBMITTALID = PLSUBMITTAL.PLSUBMITTALID
LEFT JOIN	PLPLANZONE ON PLPLAN.PLPLANID = PLPLANZONE.PLPLANID AND PLPLANZONE.MAIN = 1
LEFT JOIN	ZONE ON ZONE.ZONEID = PLPLANZONE.ZONEID
WHERE		PLITEMREVIEW.PLITEMREVIEWID = @ID

END