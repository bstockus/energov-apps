CREATE PROCEDURE [managemyreview].[USP_PLITEMREVIEW_GETBYASSIGNEDUSERS_FACETS_DUEDATE]
(
	@ITEMREVIEWLIST RecordIDs READONLY,
	@OVERDUEDATE DATE = NULL,
	@TODAYDUEBEGINDATE DATE = NULL,
	@TODAYDUEENDDATE DATE = NULL,
	@UPCOMINGDUEBEGINDATE DATE = NULL,
	@UPCOMINGDUEENDDATE DATE = NULL,
	@TODAYLABEL VARCHAR(30) = NULL,
	@NEXT5DAYSLABEL VARCHAR(30) = NULL,
	@OVERDUELABEL VARCHAR(30) = NULL
)
AS
BEGIN
SET NOCOUNT ON;

IF (@TODAYLABEL IS NULL OR @TODAYLABEL = '')
	SET @TODAYLABEL = 'Today'
IF (@NEXT5DAYSLABEL IS NULL OR @NEXT5DAYSLABEL = '')
	SET @NEXT5DAYSLABEL = 'Next 5 Days'
IF (@OVERDUELABEL IS NULL OR @OVERDUELABEL = '')
	SET @OVERDUELABEL = 'Overdue'

SELECT		@TODAYLABEL AS ID
			, @TODAYLABEL AS NAME
			, COUNT(*) COUNT
FROM		PLITEMREVIEW
INNER JOIN	@ITEMREVIEWLIST ON PLITEMREVIEW.PLITEMREVIEWID = RECORDID
WHERE		DUEDATE >= @TODAYDUEBEGINDATE AND DUEDATE < @TODAYDUEENDDATE
UNION ALL
SELECT		@NEXT5DAYSLABEL AS ID
			, @NEXT5DAYSLABEL AS NAME
			, COUNT(*) COUNT
FROM		PLITEMREVIEW
INNER JOIN	@ITEMREVIEWLIST ON PLITEMREVIEW.PLITEMREVIEWID = RECORDID
WHERE		DUEDATE >= @UPCOMINGDUEBEGINDATE AND DUEDATE < DATEADD(D, 1, @UPCOMINGDUEENDDATE)
UNION ALL
SELECT		@OVERDUELABEL AS ID
			, @OVERDUELABEL AS NAME
			, COUNT(*) COUNT
FROM		PLITEMREVIEW
INNER JOIN	@ITEMREVIEWLIST ON PLITEMREVIEW.PLITEMREVIEWID = RECORDID
WHERE		DUEDATE < @OVERDUEDATE
ORDER BY COUNT(*) DESC, ID, NAME

END