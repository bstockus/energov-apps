CREATE PROCEDURE [systemsetup].[USP_CMCODECASECONTACTTYPE_SEARCH]
(
	@SEARCH AS NVARCHAR(MAX) = '',
	@PAGE_NUMBER AS int = 1,
	@PAGE_SIZE AS int = 10,
	@IS_ASCENDING AS bit = 1
)
AS
BEGIN 
WITH RAW_DATA AS (
	SELECT		[dbo].[CMCODECASECONTACTTYPE].[CMCODECASECONTACTTYPEID],
				[dbo].[CMCODECASECONTACTTYPE].[NAME],
				CASE @IS_ASCENDING WHEN 1 THEN 
					ROW_NUMBER() OVER (ORDER BY [dbo].[CMCODECASECONTACTTYPE].[NAME])
				ELSE 
					ROW_NUMBER() OVER (ORDER BY [dbo].[CMCODECASECONTACTTYPE].[NAME] DESC)
				END AS RowNumber,
					COUNT(1) OVER() AS TotalRows
	FROM		[dbo].[CMCODECASECONTACTTYPE] 
	WHERE		[dbo].[CMCODECASECONTACTTYPE].[NAME] LIKE '%'+@SEARCH+'%'	
)


SELECT		*
FROM		RAW_DATA  
WHERE		RowNumber > @PAGE_SIZE * (@PAGE_NUMBER - 1)
			AND RowNumber <= @PAGE_SIZE * @PAGE_NUMBER
ORDER BY	RowNumber
END