CREATE PROCEDURE [communitydevelopmentsetup].[USP_IPASSESSMENTMILESTONE_GETALL]
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		[dbo].[IPASSESSMENTMILESTONE].[IPASSESSMENTMILESTONEID],
		[dbo].[IPASSESSMENTMILESTONE].[NAME],
		[dbo].[IPASSESSMENTMILESTONE].[DESCRIPTION],
		[dbo].[IPASSESSMENTMILESTONE].[IPMILESTONETYPEID],
		[dbo].[IPASSESSMENTMILESTONE].[ACTIVE],
		[dbo].[IPASSESSMENTMILESTONE].[CONFIGUREFIELDID],
		[dbo].[IPASSESSMENTMILESTONE].[MODULEID],
		[dbo].[IPASSESSMENTMILESTONE].[LASTCHANGEDBY],
		[dbo].[IPASSESSMENTMILESTONE].[LASTCHANGEDON],
		[dbo].[IPASSESSMENTMILESTONE].[ROWVERSION],
		CONFIGURABLEFIELDNAME = (CASE WHEN [dbo].[IPASSESSMENTMILESTONE].[IPMILESTONETYPEID] IN (1, 2)  
										THEN [dbo].[WFSTEP].[NAME] -- When Milestone Type is either 'Workflow Step Started' or 'Workflow Step Completed'
									  WHEN [dbo].[IPASSESSMENTMILESTONE].[IPMILESTONETYPEID] IN (3, 4) 
										THEN [dbo].[WFACTION].[NAME] -- When Milestone Type is either 'Workflow Action Started' or 'Workflow Action Completed'
								END)
	FROM 
		[dbo].[IPASSESSMENTMILESTONE] 
		LEFT JOIN [dbo].[WFACTION] WITH (NOLOCK) ON [dbo].[IPASSESSMENTMILESTONE].[CONFIGUREFIELDID] = [dbo].[WFACTION].[WFACTIONID]
		LEFT JOIN [dbo].[WFSTEP] WITH (NOLOCK) ON [dbo].[IPASSESSMENTMILESTONE].[CONFIGUREFIELDID] = [dbo].[WFSTEP].[WFSTEPID]
	ORDER BY
		[dbo].[IPASSESSMENTMILESTONE].[NAME]
END