CREATE PROCEDURE [common].[USP_RECENTCASE_UPDATEORINSERT]
(
 @FORMSID AS CHAR(36),
 @RECORDID AS CHAR(36),
 @USERID AS CHAR(36),
 @CASENUMBER AS [varchar](200)
)
AS
BEGIN
 IF EXISTS(SELECT 1 FROM RECENTCASE WHERE RECORDID = @RECORDID AND USERID = @USERID)
 BEGIN
	UPDATE RECENTCASE SET ACTIVETIME = GETDATE() WHERE RECORDID = @RECORDID AND USERID = @USERID
 END
 ELSE
 BEGIN
	DELETE FROM RECENTCASE WHERE USERID = @USERID AND RECORDID NOT IN (SELECT TOP 9 RECORDID FROM RECENTCASE WHERE USERID = @USERID ORDER BY ACTIVETIME DESC)
	INSERT INTO RECENTCASE VALUES (NEWID(),@FORMSID,@RECORDID,GETDATE(),@USERID,@CASENUMBER)
 END
END