CREATE PROCEDURE [globalsearch].[USP_DEPARTMENT_GETBYIDS_SELECT_LOOKUP]
(
	@SEARCH AS NVARCHAR(MAX) = '',	
	@DEPARTMENTIDIDS RECORDIDS  READONLY -- DEPARTMENTID
)
AS
BEGIN
SET NOCOUNT ON;
	SELECT  
		[USERDEPARTMENT].[SUSERGUID],
		[DEPARTMENT].[DEPARTMENTID],
		[DEPARTMENT].[NAME]
	FROM 
		[dbo].[USERDEPARTMENT] WITH (NOLOCK)
		INNER JOIN [dbo].[DEPARTMENT] WITH (NOLOCK) 
			ON [USERDEPARTMENT].[DEPARTMENTID] = [DEPARTMENT].[DEPARTMENTID]
		INNER JOIN [dbo].[USERS] WITH (NOLOCK) 
			ON [USERS].[SUSERGUID] = [USERDEPARTMENT].[SUSERGUID]
	WHERE
		(([dbo].[DEPARTMENT].[NAME] LIKE '%'+ @SEARCH +'%')
	AND (SELECT COUNT([RECORDID]) FROM @DEPARTMENTIDIDS)=0)
	OR ( ([dbo].[DEPARTMENT].[NAME] LIKE '%'+ @SEARCH +'%') 
	AND  [DEPARTMENT].[DEPARTMENTID] IN (SELECT [RECORDID] FROM @DEPARTMENTIDIDS ))
	ORDER BY ([USERS].[LNAME]+' ' +[USERS].[FNAME]), [DEPARTMENT].[NAME]

END