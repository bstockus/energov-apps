CREATE PROCEDURE [reviewcoordinator].[USP_SYSTEMTASK_GETBYID]
(
	@SYSTEMTASKID CHAR (36)
)
AS
SET NOCOUNT ON;
BEGIN	
	SELECT		SYSTEMTASK.SYSTEMTASKID, 
				SYSTEMTASK.SYSTEMTASKTYPEID, 
				SYSTEMTASK.PROCESSTYPE, 
				SYSTEMTASK.STARTDATE, 
				SYSTEMTASK.DUEDATE, 
				SYSTEMTASK.ASSIGNEDTO, 
				SYSTEMTASK.TEAMASSIGNEDTO, 
				SYSTEMTASK.CREATEDBYID, 
				SYSTEMTASK.CREATEDON, 
				SYSTEMTASK.COMPLETEDDATE, 
				SYSTEMTASK.COMPLETEDBY, 
				SYSTEMTASK.COMMENTS, 
				SYSTEMTASK.ATTENTIONRESOLVED, 
				SYSTEMTASK.SNOOZETYPEID, 
				SYSTEMTASK.SNOOZEUNTILDATE,
				PMPERMIT.PMPERMITID,
				PLPLAN.PLPLANID,
				COALESCE(PMPERMIT.ROWVERSION, PLPLAN.ROWVERSION) ROWVERSION
		FROM	SYSTEMTASK
		LEFT JOIN	PMPERMIT ON SYSTEMTASK.UNIQUERECORDID = PMPERMIT.PMPERMITID
		LEFT JOIN	PLPLAN ON SYSTEMTASK.UNIQUERECORDID = PLPLAN.PLPLANID
		WHERE		SYSTEMTASKID = @SYSTEMTASKID AND SYSTEMTASKTYPEID = 1

	UNION ALL

	SELECT		SYSTEMTASK.SYSTEMTASKID, 
				SYSTEMTASK.SYSTEMTASKTYPEID, 
				SYSTEMTASK.PROCESSTYPE, 
				SYSTEMTASK.STARTDATE, 
				SYSTEMTASK.DUEDATE, 
				SYSTEMTASK.ASSIGNEDTO, 
				SYSTEMTASK.TEAMASSIGNEDTO, 
				SYSTEMTASK.CREATEDBYID, 
				SYSTEMTASK.CREATEDON, 
				SYSTEMTASK.COMPLETEDDATE, 
				SYSTEMTASK.COMPLETEDBY, 
				SYSTEMTASK.COMMENTS, 
				SYSTEMTASK.ATTENTIONRESOLVED, 
				SYSTEMTASK.SNOOZETYPEID, 
				SYSTEMTASK.SNOOZEUNTILDATE,
				PLSUBMITTAL.PMPERMITID,
				PLSUBMITTAL.PLPLANID,
				COALESCE(PMPERMIT.ROWVERSION, PLPLAN.ROWVERSION) ROWVERSION
		FROM	SYSTEMTASK 
		JOIN	PLSUBMITTAL ON PLSUBMITTAL.PLSUBMITTALID = SYSTEMTASK.UNIQUERECORDID
		LEFT JOIN	PMPERMIT ON PLSUBMITTAL.PMPERMITID = PMPERMIT.PMPERMITID
		LEFT JOIN	PLPLAN ON PLSUBMITTAL.PLPLANID = PLPLAN.PLPLANID
		WHERE	SYSTEMTASKID = @SYSTEMTASKID AND SYSTEMTASKTYPEID != 1
END