CREATE PROCEDURE [reviewcoordinator].[USP_ERENTITYSESSIONTRANSACTION_GETBYPLSUBMITTALIDS]
(
	@SUBMITTALIDS AS RECORDIDS READONLY,
	@PROCESSTYPE AS INT = NULL
)
AS
BEGIN
SET NOCOUNT ON;

SELECT 
	ERSESSIONTRANSACTION.ERSESSIONTRANSACTIONID,
	ERSESSIONTRANSACTION.PROCESSTYPE,
	ERSESSIONTRANSACTION.ERENTITYPROJECTID,
	ERSESSIONTRANSACTION.ERENTITYSESSIONID,
	ERSESSIONTRANSACTION.CREATEDATE,
	ERSESSIONTRANSACTION.CREATEDBY,
	ERSESSIONTRANSACTION.TOTALSTEPS,
	ERSESSIONTRANSACTION.CURRENTSTEP,
	ERSESSIONTRANSACTION.LASTCHANGEDON,
	ERSESSIONTRANSACTION.PROCESSSTATUS,
	ERSESSIONTRANSACTION.RESULTLOG,
	ERSESSIONTRANSACTION.EMAILSENTDATE,
	ERSESSIONTRANSACTION.NUMBEROFATTEMPTS,
	ERSESSIONTRANSACTION.PLSUBMITTALID
FROM ERSESSIONTRANSACTION 
WHERE PLSUBMITTALID IN (SELECT RECORDID FROM @SUBMITTALIDS)
AND (@PROCESSTYPE IS NULL OR ERSESSIONTRANSACTION.PROCESSTYPE = @PROCESSTYPE)

END