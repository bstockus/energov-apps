CREATE PROCEDURE [reviewcoordinator].[USP_INBOX_CARD_FACETS_GET_OVERDUE]
	@ASSIGNEDUSERIDS AS RECORDIDS READONLY,
	@ASSIGNEDTEAMIDS AS RECORDIDS READONLY,
	@OVERDUEDATE AS DATE = NULL,
	@TODAY AS DATE = NULL
AS
BEGIN

SELECT ID = 'Overdue', NAME = 'Overdue', COUNT(*) COUNT
	FROM SYSTEMTASK
	LEFT OUTER JOIN PLSUBMITTAL ON PLSUBMITTAL.PLSUBMITTALID = SYSTEMTASK.UNIQUERECORDID
	WHERE
		(SYSTEMTASK.ASSIGNEDTO IN (SELECT RECORDID FROM @ASSIGNEDUSERIDS) OR 
		(SYSTEMTASK.ASSIGNEDTO IS NULL AND TEAMASSIGNEDTO IN (SELECT RECORDID FROM @ASSIGNEDTEAMIDS))
		) AND COMPLETEDDATE IS NULL
	AND SYSTEMTASK.DUEDATE < @OVERDUEDATE
	AND [reviewcoordinator].[UFN_IS_SNOOZED](SNOOZETYPEID, 
		[reviewcoordinator].[UFN_HAS_INVOICE_BALANCE_DUE](COALESCE(PLSUBMITTAL.PMPERMITID, PLSUBMITTAL.PLPLANID, SYSTEMTASK.UNIQUERECORDID)), 
		SNOOZEUNTILDATE, @TODAY) = 0

END