CREATE PROCEDURE [reviewcoordinator].[USP_ADDRESS_GETBYENTITYIDS]
	@ENTITYIDS AS RECORDIDS READONLY
AS
BEGIN

SET NOCOUNT ON;

SELECT
	PMPERMITADDRESS.PMPERMITID AS PARENTID,
	PMPERMITADDRESS.PMPERMITADDRESSID AS ENTITYID, 
	MAILINGADDRESS.ADDRESSLINE1,
	MAILINGADDRESS.ADDRESSLINE2,
	MAILINGADDRESS.ADDRESSLINE3,
	MAILINGADDRESS.ADDRESSTYPE,
	MAILINGADDRESS.ATTN,
	MAILINGADDRESS.CITY,
	MAILINGADDRESS.COMPSITE,
	MAILINGADDRESS.COUNTRY,
	MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPEID,
	MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPENAME,
	PMPERMITADDRESS.MAIN,
	MAILINGADDRESS.POBOX,
	MAILINGADDRESS.POSTALCODE,
	MAILINGADDRESS.POSTDIRECTION,
	MAILINGADDRESS.PREDIRECTION,
	MAILINGADDRESS.PROVINCE,
	MAILINGADDRESS.RURALROUTE,
	MAILINGADDRESS.STATE,
	MAILINGADDRESS.STATION,
	MAILINGADDRESS.STREETTYPE,
	MAILINGADDRESS.UNITORSUITE,
	MAILINGADDRESS.ADDRESSID	
FROM PMPERMITADDRESS
INNER JOIN MAILINGADDRESS ON MAILINGADDRESS.MAILINGADDRESSID = PMPERMITADDRESS.MAILINGADDRESSID
INNER JOIN MAILINGADDRESSCOUNTRYTYPE ON MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPEID = MAILINGADDRESS.COUNTRYTYPE
WHERE PMPERMITADDRESS.PMPERMITID IN (SELECT RECORDID FROM @ENTITYIDS) AND PMPERMITADDRESS.MAIN = 1
UNION ALL
SELECT
	PLPLANADDRESS.PLPLANID AS PARENTID,
	PLPLANADDRESS.PLPLANADDRESSID AS ENTITYID, 
	MAILINGADDRESS.ADDRESSLINE1,
	MAILINGADDRESS.ADDRESSLINE2,
	MAILINGADDRESS.ADDRESSLINE3,
	MAILINGADDRESS.ADDRESSTYPE,
	MAILINGADDRESS.ATTN,
	MAILINGADDRESS.CITY,
	MAILINGADDRESS.COMPSITE,
	MAILINGADDRESS.COUNTRY,
	MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPEID,
	MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPENAME,
	PLPLANADDRESS.MAIN,
	MAILINGADDRESS.POBOX,
	MAILINGADDRESS.POSTALCODE,
	MAILINGADDRESS.POSTDIRECTION,
	MAILINGADDRESS.PREDIRECTION,
	MAILINGADDRESS.PROVINCE,
	MAILINGADDRESS.RURALROUTE,
	MAILINGADDRESS.STATE,
	MAILINGADDRESS.STATION,
	MAILINGADDRESS.STREETTYPE,
	MAILINGADDRESS.UNITORSUITE,
	MAILINGADDRESS.ADDRESSID
FROM PLPLANADDRESS
INNER JOIN MAILINGADDRESS ON MAILINGADDRESS.MAILINGADDRESSID = PLPLANADDRESS.MAILINGADDRESSID
INNER JOIN MAILINGADDRESSCOUNTRYTYPE ON MAILINGADDRESSCOUNTRYTYPE.MAILINGADDRESSCOUNTRYTYPEID = MAILINGADDRESS.COUNTRYTYPE
WHERE PLPLANADDRESS.PLPLANID IN (SELECT RECORDID FROM @ENTITYIDS) AND PLPLANADDRESS.MAIN = 1
END