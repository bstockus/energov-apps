CREATE FUNCTION [professionallicense].[UFN_GET_PROFFESSIONAL_LICENSE_BALANCE_DUE]
(
	@ENTITYID char(36)
)
RETURNS MONEY
AS
BEGIN
	DECLARE @BALANCEDUE AS MONEY
	SELECT @BALANCEDUE = ISNULL(SUM(CACOMPFEE.COMPUTEDAMOUNT - CACOMPFEE.AMOUNTPAIDTODATE),0)
			FROM ILLICENSEFEE license INNER JOIN CACOMPUTEDFEE CACOMPFEE 
								ON license.CACOMPUTEDFEEID = CACOMPFEE.CACOMPUTEDFEEID AND CACOMPFEE.CASTATUSID NOT IN (10,5) -- DELETED & VOID
			WHERE license.ILLICENSEID = @ENTITYID
	RETURN @BALANCEDUE;
END