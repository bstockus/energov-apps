CREATE PROCEDURE [managebusinesslicense].[USP_BLBATCHRENEWALBLLICENSE_GET_BY_PARENTID]
(
	@BULKRENEWALID AS CHAR(36)
)
AS
BEGIN

	SELECT DISTINCT	[dbo].[BLBATCHRENEWALBLLICENSE].[BLLICENSEID] AS PARENTLICENSEID,
			PARENT.[LICENSENUMBER] AS PARENTLICENSENUMBER,
			CHILD.[BLLICENSEID] AS CHILDLICENSEID,
			CHILD.[LICENSENUMBER] AS CHILDLICENSENUMBER,
			[dbo].[BLBATCHRENEWALBLINVOICE].[CAINVOICEID],
			[dbo].[CAINVOICE].[INVOICENUMBER],		
			[dbo].[BLBATCHRENEWALBLLICENSE].[PROCESSEDDATE],
			[dbo].[BLBATCHRENEWALBLLICENSE].[SUCCESS]
	FROM [dbo].[BLBATCHRENEWALBLLICENSE]
	JOIN [dbo].[BLLICENSE] AS PARENT ON [dbo].[BLBATCHRENEWALBLLICENSE].[BLLICENSEID] = PARENT.[BLLICENSEID]
	LEFT JOIN [dbo].[BLLICENSE] AS CHILD ON CHILD.[BLLICENSEPARENTID] = PARENT.[BLLICENSEID]
	LEFT JOIN [dbo].[BLBATCHRENEWALBLINVOICE] ON [dbo].[BLBATCHRENEWALBLINVOICE].[BLLICENSEID] = PARENT.[BLLICENSEID]
	LEFT JOIN [dbo].[CAINVOICE] ON [dbo].[CAINVOICE].[CAINVOICEID] = [dbo].[BLBATCHRENEWALBLINVOICE].[CAINVOICEID]
	WHERE [dbo].[BLBATCHRENEWALBLLICENSE].[BLBATCHRENEWALID] = @BULKRENEWALID
	ORDER BY [dbo].[BLBATCHRENEWALBLLICENSE].[PROCESSEDDATE]

END