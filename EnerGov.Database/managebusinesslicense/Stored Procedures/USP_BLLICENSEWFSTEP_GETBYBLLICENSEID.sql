CREATE PROCEDURE [managebusinesslicense].[USP_BLLICENSEWFSTEP_GETBYBLLICENSEID]
(
	@ID CHAR(36)
)
AS
BEGIN
	SELECT DISTINCT TOP 15 
		[BLLICENSEWFACTIONSTEP].[LASTCHANGEDON] ,
		[BLLICENSEWFACTIONSTEP].[BLLICENSEWFACTIONSTEPID] ,
		[BLLICENSEWFACTIONSTEP].[NAME] ,
		[BLLICENSEWFACTIONSTEP].[WORKFLOWSTATUSID] ,
		[WORKFLOWSTATUS].[NAME] AS WORKFLOWSTATUSNAME
	FROM  
		[dbo].[BLLICENSEWFSTEP] 
		INNER JOIN [dbo].[BLLICENSEWFACTIONSTEP] ON  [BLLICENSEWFSTEP].[BLLICENSEWFSTEPID] = [BLLICENSEWFACTIONSTEP].[BLLICENSEWFSTEPID]
		INNER JOIN [dbo].[WORKFLOWSTATUS] ON [BLLICENSEWFACTIONSTEP].[WORKFLOWSTATUSID] = [WORKFLOWSTATUS].[WORKFLOWSTATUSID]
	WHERE
			[BLLICENSEWFSTEP].[BLLICENSEID] = @ID  AND
			[BLLICENSEWFACTIONSTEP].[WORKFLOWSTATUSID] NOT IN (0,3) -- NotStarted => 0 | Skipped=> 3 
	ORDER BY 
			[BLLICENSEWFACTIONSTEP].[LASTCHANGEDON] DESC
END