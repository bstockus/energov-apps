CREATE PROCEDURE [managebusinesslicense].[USP_BLLICENSE_RECENT]
(
  @USERID AS CHAR(36),
  @BLLICENSETYPEMODULEID INT
)
AS
BEGIN
	DECLARE @RECENTHISTORYBUSINESSLICENSELIST AS RecordIDs
	INSERT INTO @RECENTHISTORYBUSINESSLICENSELIST (RECORDID)

	SELECT TOP 15 [RECENTHISTORYBUSINESSLICENSE].[LICENSEID]
	FROM [dbo].[RECENTHISTORYBUSINESSLICENSE] 
	INNER JOIN [dbo].[BLLICENSE] 
		ON [dbo].[RECENTHISTORYBUSINESSLICENSE].[LICENSEID] = [dbo].[BLLICENSE].[BLLICENSEID]
	INNER JOIN [dbo].[BLLICENSETYPE] 
		ON [dbo].[BLLICENSE].[BLLICENSETYPEID] = [dbo].[BLLICENSETYPE].[BLLICENSETYPEID]		
	WHERE [RECENTHISTORYBUSINESSLICENSE].[USERID] = @USERID AND [dbo].[BLLICENSETYPE].[BLLICENSETYPEMODULEID] = @BLLICENSETYPEMODULEID
	ORDER BY [RECENTHISTORYBUSINESSLICENSE].LOGGEDDATETIME DESC

	EXEC [managebusinesslicense].[USP_RECENTLICENSES_GETBY_USERIDS] @RECENTHISTORYBUSINESSLICENSELIST, @USERID
END