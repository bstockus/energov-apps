CREATE FUNCTION [managebusinesslicense].[UFN_GET_BUSINESS_BALANCE_DUE]
(
	@LICENSEID char(36)
)
RETURNS MONEY
AS
BEGIN
	DECLARE @BALANCEDUE AS MONEY
	SELECT @BALANCEDUE = ISNULL(SUM(CACOMPUTEDFEE.COMPUTEDAMOUNT - CACOMPUTEDFEE.AMOUNTPAIDTODATE),0)
	FROM BLGLOBALENTITYEXTENSIONFEE 
	INNER JOIN CACOMPUTEDFEE ON BLGLOBALENTITYEXTENSIONFEE.CACOMPUTEDFEEID = CACOMPUTEDFEE.CACOMPUTEDFEEID 
	INNER JOIN [dbo].[BLGLOBALENTITYEXTENSION] ON  [BLGLOBALENTITYEXTENSION].[BLGLOBALENTITYEXTENSIONID] = [BLGLOBALENTITYEXTENSIONFEE].[BLGLOBALENTITYEXTENSIONID]  
	INNER JOIN [dbo].[BLLICENSE] ON [BLLICENSE].[BLGLOBALENTITYEXTENSIONID] = [BLGLOBALENTITYEXTENSION].[BLGLOBALENTITYEXTENSIONID]
	AND CACOMPUTEDFEE.CASTATUSID NOT IN (10,5) -- DELETED & VOID
	WHERE BLLICENSE.BLLICENSEID = @LICENSEID
	RETURN @BALANCEDUE;
END